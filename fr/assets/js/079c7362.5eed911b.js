"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[8015],{3905:function(e,n,a){a.d(n,{Zo:function(){return s},kt:function(){return u}});var t=a(67294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function _(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=t.createContext({}),o=function(e){var n=t.useContext(d),a=n;return e&&(a="function"==typeof e?e(n):_(_({},n),e)),a},s=function(e){var n=o(e.components);return t.createElement(d.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},f=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,i=e.originalType,d=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),f=o(a),u=r,m=f["".concat(d,".").concat(u)]||f[u]||c[u]||i;return a?t.createElement(m,_(_({ref:n},s),{},{components:a})):t.createElement(m,_({ref:n},s))}));function u(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=a.length,_=new Array(i);_[0]=f;var l={};for(var d in n)hasOwnProperty.call(n,d)&&(l[d]=n[d]);l.originalType=e,l.mdxType="string"==typeof e?e:r,_[1]=l;for(var o=2;o<i;o++)_[o]=a[o];return t.createElement.apply(null,_)}return t.createElement.apply(null,a)}f.displayName="MDXCreateElement"},90011:function(e,n,a){a.r(n),a.d(n,{frontMatter:function(){return l},contentTitle:function(){return d},metadata:function(){return o},toc:function(){return s},default:function(){return f}});var t=a(83117),r=a(80102),i=(a(67294),a(3905)),_=["components"],l={title:"TEST] 514_Update_Person_in_SF (private)",sidebar_label:"TEST] 514_Update_Person_in_SF (private)",id:"TEST-514_Update_Person_in_SF-private-2021-09-27",keywords:["library","job","expression","salesforce","alterState","dataPath","dataValue","each","field","fields","join","map","relationship","upsert","Array"]},d=void 0,o={unversionedId:"jobs/auto/TEST-514_Update_Person_in_SF-private-2021-09-27",id:"jobs/auto/TEST-514_Update_Person_in_SF-private-2021-09-27",isDocsHomePage:!1,title:"TEST] 514_Update_Person_in_SF (private)",description:"This job was provided by an OpenFn.org user via the job library API.",source:"@site/library/jobs/auto/TEST-514_Update_Person_in_SF-private-2021-09-27.md",sourceDirName:"jobs/auto",slug:"/jobs/auto/TEST-514_Update_Person_in_SF-private-2021-09-27",permalink:"/fr/library/jobs/auto/TEST-514_Update_Person_in_SF-private-2021-09-27",tags:[],version:"current",frontMatter:{title:"TEST] 514_Update_Person_in_SF (private)",sidebar_label:"TEST] 514_Update_Person_in_SF (private)",id:"TEST-514_Update_Person_in_SF-private-2021-09-27",keywords:["library","job","expression","salesforce","alterState","dataPath","dataValue","each","field","fields","join","map","relationship","upsert","Array"]},sidebar:"library",previous:{title:"\u2728 TEST] 513_Enroll_Household_in_SF",permalink:"/fr/library/jobs/auto/TEST-513_Enroll_Household_in_SF-2021-09-27"},next:{title:"Update Household in SF (Production)",permalink:"/fr/library/jobs/auto/Update-Household-in-SF-Production-2017-05-15"}},s=[{value:"Metadata",id:"metadata",children:[],level:2},{value:"Key Functions",id:"key-functions",children:[],level:2},{value:"Expression",id:"expression",children:[],level:2}],c={toc:s};function f(e){var n=e.components,a=(0,r.Z)(e,_);return(0,i.kt)("wrapper",(0,t.Z)({},c,a,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("em",null,"This job was provided by an OpenFn.org user via the job library API."),(0,i.kt)("h2",{id:"metadata"},"Metadata"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Name: TEST] 514_Update_Person_in_SF (private)"),(0,i.kt)("li",{parentName:"ul"},"Adaptor: ",(0,i.kt)("a",{parentName:"li",href:"https://www.github.com/openfn/language-salesforce"},(0,i.kt)("inlineCode",{parentName:"a"},"@openfn/language-salesforce"))),(0,i.kt)("li",{parentName:"ul"},"Adaptor Version: ",(0,i.kt)("a",{parentName:"li",href:"https://www.github.com/openfn/language-salesforce/releases/tag/v1.3.2"},(0,i.kt)("inlineCode",{parentName:"a"},"v1.3.2"))),(0,i.kt)("li",{parentName:"ul"},"Created 25 days ago"),(0,i.kt)("li",{parentName:"ul"},"Updated 9 days ago"),(0,i.kt)("li",{parentName:"ul"},"Score: ",(0,i.kt)("b",null,"23")," (an ",(0,i.kt)("a",{parentName:"li",href:"/library/#library-scores"},"indicator")," of how useful this job may be)")),(0,i.kt)("h2",{id:"key-functions"},"Key Functions"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"alterState"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"dataPath"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"dataValue"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"each"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"field"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"fields"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"join"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"map"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"relationship"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"upsert"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Array")),(0,i.kt)("h2",{id:"expression"},"Expression"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'// MOH514 - Update Person form\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Clinical_Services")(state) !==\n    undefined\n  ) {\n    const clinical = state.data.form.TT5.Child_Information.Clinical_Services;\n    if (!Array.isArray(clinical)) {\n      state.data.form.TT5.Child_Information.Clinical_Services = [clinical];\n    }\n  }\n\n  if (dataValue("form.HAWI.Clinical_Services_Rendered")(state) !== undefined) {\n    const clinical1 = state.data.form.HAWI.Clinical_Services_Rendered;\n    if (!Array.isArray(clinical1)) {\n      state.data.form.HAWI.Clinical_Services_Rendered = [clinical1];\n    }\n  }\n\n  state.cleanChoice = function (state, choice) {\n    if (choice) {\n      return choice.charAt(0).toUpperCase() + choice.slice(1).replace("_", " ");\n    } else {\n      return "";\n    }\n  };\n\n  state.handleMultiSelect = function (state, multiField) {\n    return multiField\n      ? multiField\n        .replace(/ /gi, ";")\n        .toLowerCase()\n        .split(";")\n        .map((value) => {\n          return (\n            value.charAt(0).toUpperCase() + value.slice(1).replace("_", " ")\n          );\n          //return value;\n        })\n        .join(";")\n      : "";\n  };\n\n  const counselMap = {\n    anc_visits: "ANC Visits",\n    early_initiation_of_anc_less_than_3_months:\n      "Early initiation of ANC (less than 3 months)",\n    completing_recomended_anc_visits: "Completing recomended ANC visits",\n    danger_signs: "Danger signs",\n    skilled_birth: "Skilled birth",\n    immunization: "Immunization",\n    individual_birth_plan: "Individual Birth Plan",\n    emergency_preparedness: "Emergency preparedness",\n    childcare_and_affection: "Childcare and affection",\n    nutrition_counseling: "Nutrition counseling",\n    growth_monitoring: "Growth monitoring",\n    exclusive_breastfeeding: "Exclusive breastfeeding",\n    complementary_feeding: "Sleeping under LLITN",\n    sleeping_under_llitn: "Knowing HIV status",\n    knowing_hiv_status: "Indoor pollution",\n    indoor_pollution: "Personal Hygiene",\n    personal_hygiene: "Safe drinking water",\n    safe_drinking_water: "Safe disposal of human waste",\n    safe_disposal_of_human_waste: "Complementary feeding",\n  };\n\n  const serviceMap = {\n    Scheduled_PSC_Apt: "Scheduled PSC Apt",\n    Adverse_Drug_Reaction_Side_Effect: "Adverse Drug Reaction/Side Effect",\n    Malnutrition: "Malnutrition",\n    Malaria: "Malaria",\n    TB: "TB",\n    Treatment_for_Other_OIs: "Treatment for other Ols",\n    ARI: "ARI",\n    Anemia: "Anemia",\n    Diarrhea: "Diarrhea",\n    Pregnancy_Care: "Pregnancy Care (ANC)",\n    Family_Planning: "Family Planning (FP)",\n    Preconception_Counseling: "Preconception Counseling",\n    Injury: "Injury",\n    Other: "Other",\n  };\n\n  const reasonMapping = {\n    lack_of_access_to_fp_information: "Lack of access to FP information",\n    no_access_to_fp_services_hospitals:\n      "Lack of hospitals or places where FP services can be accessed",\n    not_willing_to_use_fp_due_to_negative_effects_myths_and_misconceptions:\n      "Myths and misconceptions",\n    barriers_at_service_delivery_points: "Barriers at service delivery points",\n    pregnant: "The client is pregnant",\n    intentions_of_getting_pregnant: "Intentions of getting pregnant",\n    not_sexually_active: "The client is not sexually active",\n    other_barriers_culture_male_partners_parents_etc:\n      "Other barriers (culture, male partners, parents, etc)",\n  };\n\n  return {\n    ...state,\n    counselMap,\n    serviceMap,\n    reasonMapping,\n  };\n});\n\n// Evaluates client status and how to upsert Person records\nalterState((state) => {\n  if (\n    dataValue("form.Status.Client_Status")(state) == "Active" &&\n    dataValue("form.Source")(state) == 1 &&\n    dataValue("metadata.username")(state) !== "test.2021"\n  ) {\n    // Deliveries\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field(\n          "deworming_medication__c",\n          dataValue("form.TT5.Child_Information.Deworming")\n        ), // new mapping for deworming\n        field("Source__c", 1),\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        relationship(\n          "Household__r",\n          "CommCare_Code__c",\n          dataValue("form.HH_ID")\n        ),\n        field(\n          "MCH_booklet__c",\n          dataValue("form.TT5.Mother_Information.mch_booklet")\n        ),\n        field("Telephone__c", dataValue("form.Status.updated_phone_number")),\n        field("CommCare_HH_Code__c", dataValue("form.HH_ID")),\n        field("Client_Status__c", dataValue("form.Status.Client_Status")),\n        field("Name", (state) => {\n          var name1 = dataValue("form.Person_Name")(state);\n          var unborn = dataValue(\n            "form.ANCs.pregnancy_danger_signs.Delivery_Information.Person_Name"\n          )(state);\n          var name2 =\n            name1 === undefined || name1 === "" || name1 === null\n              ? unborn\n              : name1.replace(/\\w\\S*/g, function (txt) {\n                return (\n                  txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()\n                );\n              });\n          return name1 !== null ? name2 : "Unborn Child";\n        }),\n        field(\n          "Gender__c",\n          dataValue(\n            "form.ANCs.pregnancy_danger_signs.Delivery_Information.Person_Sex"\n          )\n        ), // new mapping for sex after delivery\n        relationship("RecordType", "Name", (state) => {\n          var rt = dataValue("form.RecordType")(state);\n          return rt === "Unborn" || rt === ""\n            ? "Child"\n            : rt.toString().replace(/_/g, " "); //convert Unborn children to Child RT\n        }),\n        field("Reason_for_a_refferal__c", (state) => {\n          var purpose = dataValue("form.Purpose_of_Referral")(state);\n          var service = dataValue("form.Reason_for_Service")(state);\n          var referral =\n            purpose == null && service == "Malaria Case" ? "Malaria" : purpose;\n          var reason =\n            referral === "HIV_Testing_and_Counseling"\n              ? "HIV counselling or Testing"\n              : referral === "Pregnancy Care"\n                ? "Pregnancy Care (ANC)"\n                : referral;\n          return reason !== undefined\n            ? reason.toString().replace(/_/g, " ")\n            : null;\n        }),\n        field("Purpose_of_referral__c", (state) => {\n          var purpose =\n            dataValue("form.TT5.Child_Information.Clinical_Services.Purpose")(\n              state\n            ) ||\n            dataValue(\n              "form.TT5.Child_Information.Nutrition2.Purpose_of_Referral"\n            )(state) ||\n            dataValue(\n              "form.treatment_and_tracking.Referral.Purpose_of_Referral"\n            )(state) ||\n            //dataValue(\'form.Purpose_of_Referral\')(state) ||\n            // dataValue(\'form.TT5.Child_Information.Danger_Signs.danger_sign_referral.Danger_Signs_Purpose_of_Referral\')(state) ||\n            dataValue("form.treatment_and_tracking.CCMM.Purpose_of_Referral")(\n              state\n            ) ||\n            //dataValue(\'form.ANCs.pregnancy_danger_signs.danger_sign_referral.Purpose_of_Referral\')(state) ||\n            dataValue("form.TT5.Child_Information.Clinical_Services.Purpose")(\n              state\n            );\n\n          var reason =\n            purpose && purpose === "HIV_Testing_and_Counseling"\n              ? "HIV Testing and Counseling"\n              : purpose === "Pregnancy_Care"\n                ? "Pregnancy Care (ANC)"\n                : purpose;\n          return reason !== undefined\n            ? reason.toString().replace(/_/g, " ")\n            : null;\n        }),\n        field("Individual_birth_plan_counselling__c", (state) => {\n          var plan1 = dataValue(\n            "form.TT5.Child_Information.pregnancy_danger_signs.individual_birth_plan"\n          )(state);\n          var plan2 = dataValue(\n            "form.ANCs.pregnancy_danger_signs.individual_birth_plan"\n          )(state);\n          return plan2 ? plan2 : plan1;\n        }),\n        field("Reason_for_not_taking_a_pregnancy_test__c", (state) => {\n          var reason = dataValue("form.TT5.Mother_Information.No_Preg_Test")(\n            state\n          );\n          return reason !== undefined\n            ? reason.toString().replace(/_/g, " ")\n            : null;\n        }),\n        field("Pregnancy_danger_signs__c", (state) => {\n          var signs = dataValue(\n            "form.TT5.Child_Information.pregnancy_danger_signs.pregnancy_danger_signs"\n          )(state);\n          var newSign = "";\n          if (signs !== undefined) {\n            signs = signs\n              .toLowerCase()\n              .split(" ")\n              .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n              .join(";");\n            return (newSign = signs\n              ? signs.toString().replace(/_/g, " ")\n              : signs);\n          } else {\n            return (newSign = null);\n          }\n          return newSign;\n        }),\n        field("Child_Danger_Signs__c", (state) => {\n          var signs = dataValue(\n            "form.TT5.Child_Information.Danger_Signs.Other_Danger_Signs"\n          )(state);\n          var newSign = "";\n          if (signs !== undefined) {\n            signs = signs\n              .toLowerCase()\n              .split(" ")\n              .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n              .join(";");\n            return (newSign = signs.toString().replace(/_/g, " "));\n          } else {\n            return signs;\n          }\n        }),\n        field("Child_Status__c", (state) => {\n          var status = dataValue("form.case.update.child_status")(state);\n          var rt = dataValue("form.RecordType")(state);\n          //if(status!==undefined && rt=="Unborn" && status!=="Yes"){ //Q: child_status not present?\n          if (status !== undefined && rt == "Unborn") {\n            status = "Unborn";\n          } else if (status !== undefined && rt == "Born") {\n            status = "Born";\n          }\n          return status;\n        }),\n        field("Current_Malaria_Status__c", dataValue("form.Malaria_Status")),\n        field(\n          "Counselled_on_Exclusive_Breastfeeding__c",\n          dataValue(\n            "form.TT5.Child_Information.Exclusive_Breastfeeding.counseling"\n          )\n        ), //multiselect?\n        field(\n          "Unique_Patient_Code__c",\n          dataValue("form.case.update.Unique_Patient_Code")\n        ),\n        field(\n          "Active_in_Support_Group__c",\n          dataValue("form.case.update.Active_in_Support_Group")\n        ),\n        field(\n          "Preferred_Care_Facility__c",\n          dataValue("form.HAWI.Preferred_Care_F.Preferred_Care_Facility")\n        ),\n        field("HAWI_Defaulter__c", (state) => {\n          var hawi = dataValue("form.HAWI.Preferred_Care_F.default")(state);\n          return hawi == "Yes" ? true : false;\n        }),\n        field(\n          "Date_of_Default__c",\n          dataValue("form.HAWI.Preferred_Care_F.date_of_default")\n        ),\n        field(\n          "Persons_temperature__c",\n          dataValue("form.treatment_and_tracking.temperature")\n        ),\n        field(\n          "Days_since_illness_start__c",\n          dataValue("form.treatment_and_tracking.duration_of_sickness")\n        ),\n        field(\n          "Newborn_visited_48_hours_of_delivery__c",\n          dataValue(\n            "form.TT5.Child_Information.newborn_visited_48_hours_of_delivery"\n          )\n        ),\n        field(\n          "Last_Malaria_Home_Test__c",\n          dataValue("form.treatment_and_tracking.malaria_test_date")\n        ),\n        field(\n          "Current_Malaria_Status__c",\n          dataValue("form.treatment_and_tracking.malaria_test_results")\n        ),\n        field(\n          "Last_Malaria_Home_Treatment__c",\n          dataValue("form.TT5.Child_Information.CCMM.Home_Treatment")\n        ),\n        field(\n          "Malaria_Follow_Up__c",\n          dataValue("form.TT5.Child_Information.CCMM.Fever-Follow-Up_By_Date")\n        ),\n        field(\n          "Malaria_Facility__c",\n          dataValue("form.TT5.Child_Information.CCMM.malaria_referral_facility")\n        ),\n        field(\n          "Malaria_Referral__c",\n          dataValue("form.TT5.Child_Information.CCMM.Referral_Date")\n        ),\n        field(\n          "Fever_over_7days__c",\n          dataValue("form.treatment_and_tracking.symptoms_check_fever")\n        ),\n        field(\n          "Cough_over_14days__c",\n          dataValue("form.treatment_and_tracking.symptoms_check_cough")\n        ),\n        field(\n          "Diarrhoea_over_14days__c",\n          dataValue("form.treatment_and_tracking.symptoms_check_diarrhea")\n        ),\n        field(\n          "Diarrhoea_less_than_14_days__c",\n          dataValue("form.treatment_and_tracking.mild_symptoms_check_diarrhea")\n        ),\n        field(\n          "TB_patients_therapy_observed__c",\n          dataValue("form.treatment_and_tracking.observed_tb_therapy")\n        ),\n        //field("Injuries_and_wounds_managed__c", dataValue("Injuries_and_wounds_managed")),\n        field(\n          "Injuries_or_wounds__c",\n          dataValue("form.treatment_and_tracking.wounds_or_injuries")\n        ),\n        field("Currently_on_ART_s__c", dataValue("form.HAWI.ART")),\n        field("ART_Regimen__c", dataValue("form.HAWI.ARVs")),\n        field(\n          "Immediate_Breastfeeding__c",\n          dataValue(\n            "form.ANCs.pregnancy_danger_signs.Delivery_Information.Breastfeeding_Delivery"\n          )\n        ),\n        field("Verbal_autopsy__c", dataValue("form.Status.verbal_autopsy")),\n        field("Date_of_Birth__c", dataValue("form.case.update.DOB")),\n        field("Place_of_Delivery__c", (state) => {\n          var facility = dataValue("form.TT5.Child_Information.Delivery_Type")(\n            state\n          );\n          if (facility !== undefined) {\n            return facility == "Skilled" ? "Facility" : "Home";\n          }\n          return facility;\n        }),\n        field("Delivery_Facility__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Delivery_Facility"\n          )(state);\n          return facility !== undefined\n            ? facility.toString().replace(/_/g, " ")\n            : null;\n        }),\n        field(\n          "Delivery_Facility_Other__c",\n          dataValue("form.TT5.Child_Information.Delivery_Facility_Other")\n        ),\n        field(\n          "Exclusive_Breastfeeding__c",\n          dataValue(\n            "form.TT5.Child_Information.Exclusive_Breastfeeding.Exclusive_Breastfeeding"\n          )\n        ),\n        field(\n          "Counselled_on_Exclusive_Breastfeeding__c",\n          dataValue(\n            "form.TT5.Child_Information.Exclusive_Breastfeeding.counseling"\n          )\n        ),\n        field("Family_Planning__c", (state) => {\n          var method1 = dataValue(\n            "form.Basic_Information.family_planning.Currently_on_family_planning"\n          )(state);\n          var method2 = dataValue(\n            "form.TT5.Mother_Information.family_planning"\n          )(state);\n          return method2 ? "Yes" : method1;\n        }),\n        field("Family_Planning_Method__c", (state) => {\n          var method1 = dataValue(\n            "form.Basic_Information.family_planning.Family_Planning_Method"\n          )(state);\n          var method2 = dataValue(\n            "form.TT5.Mother_Information.family_planning_method"\n          )(state);\n          return method2\n            ? method2.toString().replace(/_/g, " ")\n            : method1\n              ? method1.toString().replace(/_/g, " ")\n              : method1;\n        }),\n        field("Reasons_for_not_taking_FP_method__c", (state) => {\n          var reason = dataValue(\n            "form.TT5.Mother_Information.No_FPmethod_reason"\n          )(state);\n          return reason ? state.reasonMapping[reason] : "";\n        }),\n        field("Pregnant__c", (state) => {\n          var preg = dataValue("form.TT5.Mother_Information.Pregnant")(state);\n          return preg == "Yes" ? true : false;\n        }),\n        field(\n          "Counselled_on_FP_Methods__c",\n          dataValue("form.TT5.Mother_Information.CounselledFP_methods")\n        ),\n        field("Client_counselled_on__c", (state) => {\n          var choices = dataValue(\n            "form.treatment_and_tracking.counseling.counsel_topic"\n          )(state);\n          var choiceGroups = choices ? choices.split(" ") : null;\n          var choicesMulti = choiceGroups\n            ? choiceGroups\n              .map((cg) => {\n                return state.counselMap[cg];\n              })\n              .join(";")\n            : choiceGroups;\n          return choicesMulti;\n        }),\n        field("Client_provided_with_FP__c", (state) => {\n          var choice = dataValue(\n            "form.TT5.Mother_Information.was_the_woman_15-49yrs_provided_with_family_planning_commodities_by_chv"\n          )(state);\n          return state.cleanChoice(state, choice);\n        }),\n        field(\n          "Newborn_visited_48_hours_of_delivery__c",\n          dataValue(\n            "form.TT5.Child_Information.newborn_visited_48_hours_of_delivery"\n          )\n        ),\n        field("Newborn_visit_counselling__c", (state) => {\n          var choice = dataValue(\n            "form.TT5.Child_Information.did_you_consel_the_mother_on1"\n          )(state);\n          return state.cleanChoice(state, choice);\n        }),\n        field(\n          "mother_visited_48_hours_of_the_delivery__c",\n          dataValue("form.TT5.Child_Information.visit_mother_48")\n        ),\n        field("Mother_visit_counselling__c", (state) => {\n          var choice = dataValue(\n            "form.TT5.Child_Information.did_you_consel_the_mother_on2"\n          )(state);\n          return state.cleanChoice(state, choice);\n        }),\n        field("Mother_ANC_Referral__c", dataValue("form.ANCs.refer_for_anc")),\n        field("ANC_referral_date__c", dataValue("form.ANCs.refer_anc")),\n        field(\n          "Mother_Skilled_Delivery_Referral__c",\n          dataValue("form.ANCs.pregnancy_danger_signs.refer_skilled_delivery")\n        ),\n        field(\n          "Mother_skilled_Ref_date__c",\n          dataValue("form.ANCs.pregnancy_danger_signs.refer_skilled_delivery1")\n        ),\n        field(\n          "Woman_referred_for_FP_services__c",\n          dataValue(\n            "form.TT5.Mother_Information.was_the_woman_referred_for_family_planning_services"\n          )\n        ),\n        field("Family_planning_services_referral_date__c", (state) => {\n          var referred = dataValue(\n            "form.TT5.Mother_Information.was_the_woman_referred_for_family_planning_services"\n          )(state);\n          return referred == "yes"\n            ? dataValue("form.TT5.Mother_Information.date_today")(state)\n            : null;\n        }),\n        field(\n          "Mother_PNC_referral__c",\n          dataValue(\n            "form.ANCs.pregnancy_danger_signs.Delivery_Information.refer_pnc"\n          )\n        ),\n        field(\n          "Mother_PNC_referral_date__c",\n          dataValue(\n            "form.ANCs.pregnancy_danger_signs.Delivery_Information.refer_the_mother_for_pnc"\n          )\n        ),\n        field(\n          "Immunizations_referral__c",\n          dataValue(\n            "form.TT5.Child_Information.Immunizations.did_you_refer_the_child_0-11_months_for_immunization"\n          )\n        ),\n        field(\n          "Immunizations_referral_date__c",\n          dataValue(\n            "form.TT5.Child_Information.Immunizations.refer_immunization"\n          )\n        ),\n        field(\n          "Vitamin_A_supplement_referral__c",\n          dataValue(\n            "form.TT5.Child_Information.Immunizations.did_you_refer_the_child_6-59_months_for_vitamin_a_supplements"\n          )\n        ),\n        field(\n          "Vitamin_A_supplement_referral_date__c",\n          dataValue(\n            "form.TT5.Child_Information.Immunizations.refer_vitamin_a_supplements"\n          )\n        ),\n        field(\n          "Cough_14_days_referral__c",\n          dataValue(\n            "form.treatment_and_tracking.did_you_refer_the_client_for_cough_14_days"\n          )\n        ),\n        field(\n          "Cough_14_days_referral_date__c",\n          dataValue("form.treatment_and_tracking.refer_14days")\n        ),\n        field("Know_HIV_status__c", dataValue("form.known_hiv_status")),\n        field(\n          "HIV_counselling_and_testing_referral__c",\n          dataValue("form.did_you_refer_for_hiv_counselling_and_testing_htc")\n        ),\n        field(\n          "HIV_counseling_and_testing_referral_date__c",\n          dataValue("form.refer_hiv")\n        ),\n        field("Treatment_Distribution__c", (state) => {\n          var choice = dataValue(\n            "form.treatment_and_tracking.distribution.distributed_treatments"\n          )(state);\n          return state.cleanChoice(state, choice);\n        }),\n        field(\n          "Nutrition_referral_date__c",\n          dataValue("form.TT5.Child_Information.Nutrition2.date_malnutrition")\n        ),\n        field(\n          "Nutrition_referral__c",\n          dataValue("form.TT5.Child_Information.Nutrition2.Referral")\n        ),\n        field(\n          "Current_Height__c",\n          dataValue("form.TT5.Child_Information.Nutrition.current_height")\n        ),\n        field("Cause_of_Death__c", (state) => {\n          var choice = dataValue("form.Status.Cause_of_Death")(state);\n          return state.cleanChoice(state, choice);\n        }),\n        field(\n          "ART_treatment_referral_date__c",\n          dataValue("form.HAWI.when_ART_refer")\n        ),\n        field(\n          "ART_treatment_referral__c",\n          dataValue("form.HAWI.did_you_refer")\n        ),\n        field(\n          "ART_treatment_referral_date__c",\n          dataValue("form.HAWI.when_ART_refer")\n        ),\n        field("ART_treatment_referral__c", dataValue("form.HAWI.default")),\n        field(\n          "Immunizations_referral_date__c",\n          dataValue(\n            "form.TT5.Child_Information.Immunizations.referral_for_immunization"\n          )\n        ),\n        field(\n          "Immunizations_referral__c",\n          dataValue(\n            "form.TT5.Child_Information.Immunizations.refer_immunization_type"\n          )\n        ),\n        field(\n          "Child_missed_immunization_type__c",\n          dataValue(\n            "form.TT5.Child_Information.Immunizations.immunization_type"\n          )\n        ),\n        field(\n          "TB_treatment_referral_date__c",\n          dataValue("form.treatment_and_tracking.refer_clientTB")\n        ),\n        field(\n          "TB_referral__c",\n          dataValue("form.treatment_and_tracking.tb_treatment")\n        ),\n        field("Default_on_TB_treatment__c", (state) => {\n          var choice = dataValue(\n            "form.treatment_and_tracking.default_tb_treatment"\n          )(state);\n          return state.cleanChoice(state, choice);\n        }),\n        field(\n          "Received_pregnancy_test__c",\n          dataValue(\n            "form.TT5.Mother_Information.did_you_adminsiter_a_pregnancy_test"\n          )\n        ),\n        field(\n          "Pregnancy_test_result__c",\n          dataValue("form.TT5.Mother_Information.pregnancy_test_result")\n        ),\n        field(\n          "Pregnancy_referral__c",\n          dataValue("form.TT5.Mother_Information.refer_preg")\n        ),\n        field(\n          "Pregnancy_referral_date__c",\n          dataValue("form.TT5.Mother_Information.referal_pregnancy")\n        ),\n        field("Chronic_illness__c", (state) => {\n          var choice = dataValue(\n            "form.please_specify_which_chronic_illness_the_person_has"\n          )(state);\n          var choice2 = state.handleMultiSelect(state, choice);\n          return choice2 ? choice2.replace(/_/g, " ") : "";\n        }),\n        field(\n          "Chronic_illness_referral__c",\n          dataValue("form.did_you_refer_the_client_for_any_chronic_illness")\n        ),\n        field(\n          "Chronic_illness_referral_date__c",\n          dataValue("form.date_chronic_illness")\n        ),\n        field(\n          "Birth_Certificate__c",\n          dataValue("form.Status.birth_certificate")\n        ),\n        field(\n          "Child_zinc__c",\n          dataValue(\n            "form.TT5.Child_Information.Clinical_Services.diarrhea_clinic_treatment_zinc"\n          )\n        ),\n        field(\n          "Child_ORS__c",\n          dataValue(\n            "form.TT5.Child_Information.Clinical_Services.diarrhea_clinic_treatment_ORS"\n          )\n        ),\n        field(\n          "Childs_breath_per_minute__c",\n          dataValue("form.psbi.breaths_per_minuite")\n        ),\n        field(\n          "Child_fast_breathing_referral_date__c",\n          dataValue("form.psbi.Fast_breathing_followup_date__c")\n        ),\n        field(\n          "Fast_breathing_followup_date__c",\n          dataValue("form.psbi.when_did_you_follow_up_for_fast_breathing")\n        ),\n        field(\n          "Child_chest_in_drawing__c",\n          dataValue("form.psbi.Child_chest_in_drawing_c")\n        ),\n        field(\n          "Child_chest_in_drawing_referral_date__c",\n          dataValue("form.psbi.Child_chest_in_drawing_referral_date_c")\n        ),\n        field("Childs_chest_indrawing_followup__c", (state) => {\n          var choice = dataValue("form.psbi.Childs_chest_indrawing_followup_c")(\n            state\n          );\n          var choice2 = choice ? choice.split(" ").join(";") : choice;\n          return choice2 ? choice2.replace(/_/g, " ") : choice2;\n        })\n      )\n    )(state);\n  }\n  // Transfer Outs\n  else if (dataValue("form.Status.Client_Status")(state) == "Transferred_Out") {\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        field("Source__c", 1),\n        field("Name", (state) => {\n          var name1 = dataValue("form.Person_Name")(state);\n          var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n          });\n          return name2;\n        }),\n        field("Client_Status__c", "Transferred Out"),\n        field("TT5_Mother_Registrant__c", "No"),\n        field("Active_TT5_Mother__c", "No"),\n        field("Active_in_Thrive_Thru_5__c", "No"),\n        field("Thrive_Thru_5_Registrant__c", "No"),\n        field("Inactive_Date__c", dataValue("form.Date")),\n        field("Active_in_HAWI__c", "No"),\n        field("Active_TT5_Mother__c", "No"),\n        field(\n          "Date_of_Transfer_Out__c",\n          dataValue("form.Status.Date_of_Transfer_Out")\n        )\n      )\n    )(state);\n  }\n  // Lost to Follow Up\n  else if (\n    dataValue("form.Status.Client_Status")(state) == "Lost_to_Follow_Up"\n  ) {\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field("Source__c", 1),\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        field("Name", (state) => {\n          var name1 = dataValue("form.Person_Name")(state);\n          var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n          });\n          return name2;\n        }),\n        field("Client_Status__c", "Lost to Follow-Up"),\n        field("Active_in_Thrive_Thru_5__c", "No"),\n        field("Active_TT5_Mother__c", "No"),\n        field("TT5_Mother_Registrant__c", "No"),\n        field("Active_in_HAWI__c", "No"),\n        field("Date_Last_Seen__c", dataValue("form.Status.Date_Last_Seen")),\n        field("Inactive_Date__c", dataValue("form.Date"))\n      )\n    )(state);\n  }\n  // Graduated from Thrive Thru 5\n  else if (\n    dataValue("form.Status.Client_Status")(state) == "Graduated_From_TT5"\n  ) {\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field("Source__c", 1),\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        field("Name", (state) => {\n          var name1 = dataValue("form.Person_Name")(state);\n          var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n          });\n          return name2;\n        }),\n        field("Client_Status__c", "Graduated From TT5"),\n        field("Active_in_Thrive_Thru_5__c", "No"),\n        field("Active_TT5_Mother__c", "No"),\n        field("TT5_Mother_Registrant__c", "No"),\n        field("Active_in_HAWI__c", "No"),\n        field("Active_TT5_Mother__c", "No"),\n        field("Date_Last_Seen__c", dataValue("form.Status.Date_Last_Seen")),\n        field("Inactive_Date__c", dataValue("form.Date"))\n      )\n    )(state);\n  }\n  // Data entry error\n  else if (\n    dataValue("form.Status.Client_Status")(state) == "Data_Entry_Error"\n  ) {\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field("Source__c", 1),\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        field("Name", (state) => {\n          var name1 = dataValue("form.Person_Name")(state);\n          var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n          });\n          return name2;\n        }),\n        field("Client_Status__c", "Data Entry Error"),\n        field("Active_in_Thrive_Thru_5__c", "No"),\n        field("Active_TT5_Mother__c", "No"),\n        field("TT5_Mother_Registrant__c", "No"),\n        field("Active_in_HAWI__c", "No"),\n        field("Inactive_Date__c", dataValue("form.Date"))\n      )\n    )(state);\n  }\n  // Deceased\n  else if (dataValue("form.Status.Client_Status")(state) == "Deceased") {\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field("Source__c", 1),\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        field("Name", (state) => {\n          var name1 = dataValue("form.Person_Name")(state);\n          var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n          });\n          return name2 + "deceased";\n        }),\n        field("Verbal_autopsy__c", dataValue("form.Status.verbal_autopsy")),\n        field("Client_Status__c", "Deceased"),\n        field("Child_Status__c", "Deceased"),\n        field("Active_in_Thrive_Thru_5__c", "No"),\n        field("Thrive_Thru_5_Registrant__c", "No"),\n        field("Active_in_HAWI__c", "No"),\n        field("Active_TT5_Mother__c", "No"),\n        field("TT5_Mother_Registrant__c", "No"),\n        field("Date_of_Death__c", dataValue("form.Status.Date_of_Death")),\n        field("Cause_of_Death__c", (state) => {\n          var death = dataValue("form.Status.Cause_of_Death")(state);\n          return death ? death.toString().replace(/_/g, " ") : death;\n        }),\n        field("Inactive_Date__c", dataValue("form.Date"))\n      )\n    )(state);\n  }\n\n  console.log("None of the ifs matched, skipping upsert and returning state.");\n  return state;\n});\n\n// Person is added to TT5 ?\nalterState((state) => {\n  if (\n    (dataValue("form.case.update.TT5_enrollment_status")(state) ==\n      "Enrolled in TT5" ||\n      dataValue("form.age")(state) < 5 ||\n      dataValue("form.case.update.Active_in_TT5")(state) == "Yes" ||\n      dataValue("form.case.update.Pregnant") == "Yes") &&\n    dataValue("form.Status.Client_Status")(state) == "Active"\n  ) {\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        field("Active_in_Thrive_Thru_5__c", "Yes"),\n        field("Enrollment_Date__c", dataValue("metadata.timeEnd")),\n        field("Thrive_Thru_5_Registrant__c", "Yes"),\n        field("Active_TT5_Mother__c", (state) => {\n          var preg = dataValue("form.case.update.Pregnant")(state);\n          return preg == "Yes" ? "Yes" : null;\n        }),\n        field("TT5_Mother_Registrant__c", (state) => {\n          var preg = dataValue("form.case.update.Pregnant")(state);\n          return preg == "Yes" ? "Yes" : null;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No person was added to TT5, skipping upsert.");\n  return state;\n});\n\n//Person over age 5 / NOT active in TT5\nalterState((state) => {\n  if (\n    (dataValue("form.age")(state) > 5 ||\n      dataValue("form.case.update.Active_in_TT5")(state) == "No") &&\n    dataValue("form.Status.Client_Status")(state) == "Active"\n  ) {\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        field("Active_in_Thrive_Thru_5__c", "No"),\n        field("Thrive_Thru_5_Registrant__c", "No")\n      )\n    )(state);\n  }\n\n  console.log("No person over age 5, skipping upsert.");\n  return state;\n});\n\n//Person is added to HAWI ?\nalterState((state) => {\n  if (\n    (dataValue("form.case.update.HAWI_enrollment_status")(state) ==\n      "Enrolled in HAWI" ||\n      dataValue("form.hiv_status")(state) == "positive" ||\n      dataValue("form.case.update.Active_in_HAWI")(state) == "Yes") &&\n    dataValue("form.Status.Client_Status")(state) == "Active"\n  ) {\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        field("Active_in_HAWI__c", "Yes"),\n        field("HAWI_Enrollment_Date__c", dataValue("metadata.timeEnd")),\n        field("HAWI_Registrant__c", "Yes"),\n        field("HIV_Status__c", "positive")\n      )\n    )(state);\n  }\n\n  console.log("No person added to HAWI, skipping upsert.");\n  return state;\n});\n\n// Person is NOT enrolled in HAWI\nalterState((state) => {\n  if (\n    dataValue("form.case.update.HAWI_enrollment_status")(state) ==\n    "Not enrolled in HAWI" &&\n    dataValue("form.Status.Client_Status")(state) == "Active"\n  ) {\n    return upsert(\n      "Person__c",\n      "CommCare_ID__c",\n      fields(\n        field("CommCare_ID__c", dataValue("form.case.@case_id")),\n        field("Active_in_HAWI__c", "No"),\n        field("HAWI_Registrant__c", "No")\n      )\n    )(state);\n  }\n\n  console.log("No person added to HAWI, skipping upsert.");\n  return state;\n});\n\n//--- UPSERT SERVICE RECORDS ---/\n// ANC1\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.ANCs.ANC_1")(state) ||\n    dataValue("form.ANCs.ANC_1")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue("$.form.TT5.Child_Information.ANCs.ANC_1")(\n            state\n          );\n          const date2 = date ? date : dataValue("form.ANCs.ANC_1")(state);\n          return id + date2 + "ANC1";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "ANC 1"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue("form.TT5.Child_Information.ANCs.ANC_1")(state);\n          return date ? date : state.data.form.case.update.ANC_1;\n        }),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Purpose_of_Referral__c", "ANC 1"),\n        field("Type_of_Service__c", "Ante-Natal Care"),\n        field("RecordTypeID", "01224000000YAuK"),\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue("form.TT5.Child_Information.ANCs.Facility1")(\n            state\n          );\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No ANC1.");\n  return state;\n});\n\n//ANC2\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.ANCs.ANC_2")(state) ||\n    dataValue("form.ANCs.ANC_2")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue("$.form.TT5.Child_Information.ANCs.ANC_2")(\n            state\n          );\n          const date2 = date ? date : dataValue("form.ANCs.ANC_2")(state);\n          return id + date2 + "ANC2";\n        }),\n        field("Source__c", 1),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Reason_for_Service__c", "ANC 2"),\n        field("Date__c", (state) => {\n          var date = dataValue("form.TT5.Child_Information.ANCs.ANC_2")(state);\n          return date ? date : state.data.form.case.update.ANC_2;\n        }),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Purpose_of_Referral__c", "ANC 2"),\n        field("Type_of_Service__c", "Ante-Natal Care"),\n        field("RecordTypeID", "01224000000YAuK"),\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue("form.TT5.Child_Information.ANCs.Facility2")(\n            state\n          );\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No ANC2.");\n  return state;\n});\n\n//ANC3\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.ANCs.ANC_3")(state) ||\n    dataValue("form.ANCs.ANC_3")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue("$.form.TT5.Child_Information.ANCs.ANC_3")(\n            state\n          );\n          const date2 = date ? date : dataValue("form.ANCs.ANC_3")(state);\n          return id + date2 + "ANC3";\n        }),\n        field("Source__c", true),\n        field("Reason_for_Service__c", "ANC 3"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue("form.TT5.Child_Information.ANCs.ANC_3")(state);\n          return date ? date : state.data.form.case.update.ANC_3;\n        }),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Purpose_of_Referral__c", "ANC 3"),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("RecordTypeID", "01224000000YAuK"),\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue("form.TT5.Child_Information.ANCs.Facility3")(\n            state\n          );\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No ANC3.");\n  return state;\n});\n\n//ANC4\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.ANCs.ANC_4")(state) ||\n    dataValue("form.ANCs.ANC_4")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue("$.form.TT5.Child_Information.ANCs.ANC_4")(\n            state\n          );\n          const date2 = date ? date : dataValue("form.ANCs.ANC_4")(state);\n          return id + date2 + "ANC4";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "ANC 4"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue("form.TT5.Child_Information.ANCs.ANC_4")(state);\n          return date ? date : state.data.form.case.update.ANC_4;\n        }),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Purpose_of_Referral__c", "ANC 4"),\n        field("Type_of_Service__c", "Ante-Natal Care"),\n        field("RecordTypeID", "01224000000YAuK"),\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue("form.TT5.Child_Information.ANCs.Facility4")(\n            state\n          );\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No ANC4.");\n  return state;\n});\n\n//ANC5\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.ANCs.ANC_5")(state) ||\n    dataValue("form.ANCs.ANC_5")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue("$.form.TT5.Child_Information.ANCs.ANC_5")(\n            state\n          );\n          const date2 = date ? date : dataValue("form.ANCs.ANC_5")(state);\n          return id + date2 + "ANC5";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "ANC 5"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue("form.TT5.Child_Information.ANCs.ANC_5")(state);\n          return date ? date : state.data.form.case.update.ANC_5;\n        }),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Purpose_of_Referral__c", "ANC 5"),\n        field("Type_of_Service__c", "Ante-Natal Care"),\n        field("RecordTypeID", "01224000000YAuK"),\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue("form.TT5.Child_Information.ANCs.Facility5")(\n            state\n          );\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No ANC5.");\n  return state;\n});\n\n// BCG REVIEWED\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Immunizations.BCG")(state) ||\n    dataValue("form.case.update.BCG")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue(\n            "$.form.TT5.Child_Information.Immunizations.BCG"\n          )(state);\n          const date2 = date ? date : dataValue("form.case.update.BCG")(state);\n          return id + date2 + "BCG";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "BCG"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue("form.TT5.Child_Information.Immunizations.BCG")(\n            state\n          );\n          return date ? date : state.data.form.case.update.BCG;\n        }),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "Immunization"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        field("RecordTypeID", "01224000000YAuK"),\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Immunizations.Facility_BCG"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("Not BCG REVIEWED.");\n  return state;\n});\n\n// OPV0 REVIEWED\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Immunizations.OPV0_h")(state) ||\n    dataValue("form.case.update.OPV0_h")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      //\'CommCare_Code__c\',\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "opv0";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue(\n            "$.form.TT5.Child_Information.Immunizations.OPV0_h"\n          )(state);\n          const date2 = date\n            ? date\n            : dataValue("form.case.update.OPV0_h")(state);\n          return id + date2 + "OPV0";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "OPV0"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue(\n            "form.TT5.Child_Information.Immunizations.OPV0_h"\n          )(state);\n          return date ? date : state.data.form.case.update.OPV0_h;\n        }),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "Immunization"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Immunizations.Facility_OPV_0"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("Not OPV0 reviewed.");\n  return state;\n});\n\n// OPV1 REVIEWED\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Immunizations.OPV1_h")(state) ||\n    dataValue("form.case.update.OPV1_h")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      //\'CommCare_Code__c\',\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "opv1";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue(\n            "$.form.TT5.Child_Information.Immunizations.OPV1_h"\n          )(state);\n          const date2 = date\n            ? date\n            : dataValue("form.case.update.OPV1_h")(state);\n          return id + date2 + "OPV1";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "OPV1"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue(\n            "form.TT5.Child_Information.Immunizations.OPV1_h"\n          )(state);\n          return date ? date : state.data.form.case.update.OPV1_h;\n        }),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "Immunization"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Immunizations.Facility_OPV_1"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("Not OPV1 reviewed.");\n  return state;\n});\n\n// OPV2\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Immunizations.OPV2_h")(state) ||\n    dataValue("form.case.update.OPV2_h")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      //\'CommCare_Code__c\',\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "opv2";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue(\n            "$.form.TT5.Child_Information.Immunizations.OPV2_h"\n          )(state);\n          const date2 = date\n            ? date\n            : dataValue("form.case.update.OPV2_h")(state);\n          return id + date2 + "OPV2";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "OPV2"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue(\n            "form.TT5.Child_Information.Immunizations.OPV2_h"\n          )(state);\n          return date ? date : state.data.form.case.update.OPV2_h;\n        }),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "Immunization"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Immunizations.Facility_OPV_2"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("Not OPV2 reviewed.");\n  return state;\n});\n\n//OPV3\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Immunizations.OPV3_h")(state) ||\n    dataValue("form.case.update.OPV3_h")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      //\'CommCare_Code__c\',\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "opv3";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue(\n            "$.form.TT5.Child_Information.Immunizations.OPV3_h"\n          )(state);\n          const date2 = date\n            ? date\n            : dataValue("form.case.update.OPV3_h")(state);\n          return id + date2 + "OPV3";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "OPV3"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue(\n            "form.TT5.Child_Information.Immunizations.OPV3_h"\n          )(state);\n          return date ? date : state.data.form.case.update.OPV3_h;\n        }),\n        field("Type_of_Service__c", "Immunization"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Immunizations.Facility_OPV_3"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("Not OPV3 reviewed.");\n  return state;\n});\n\n//Measles 6\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Immunizations.Measles6_h")(state) ||\n    dataValue("form.case.update.Measles6_h")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      //\'CommCare_Code__c\',\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "measles6";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue(\n            "$.form.TT5.Child_Information.Immunizations.Measles6_h"\n          )(state);\n          const date2 = date\n            ? date\n            : dataValue("form.case.update.Measles6_h")(state);\n          return id + date2 + "Measles6";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "Measles 6"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue(\n            "form.TT5.Child_Information.Immunizations.Measles6_h"\n          )(state);\n          return date ? date : state.data.form.case.update.Measles6_h;\n        }),\n        field("Type_of_Service__c", "Immunization"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Immunizations.Facility_Measles_6"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No measles 6.");\n  return state;\n});\n\n//Measles 9\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Immunizations.Measles9_h")(state) ||\n    dataValue("form.case.update.Measles9_h")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      //\'CommCare_Code__c\',\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "measles9";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue(\n            "$.form.TT5.Child_Information.Immunizations.Measles9_h"\n          )(state);\n          const date2 = date\n            ? date\n            : dataValue("form.case.update.Measles9_h")(state);\n          return id + date2 + "Measles9";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "Measles 9"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue(\n            "form.TT5.Child_Information.Immunizations.Measles9_h"\n          )(state);\n          return date ? date : state.data.form.case.update.Measles9_h;\n        }),\n        field("Type_of_Service__c", "Immunization"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Immunizations.Facility_Measles_9"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No measles 9.");\n  return state;\n});\n\n//Measles 18\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Immunizations.Measles18_h")(state) ||\n    dataValue("form.case.update.Measles18_h")(state)\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      //\'CommCare_Code__c\',\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "measles18";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          const id = dataValue("$.form.case.@case_id")(state);\n          const date = dataValue(\n            "$.form.TT5.Child_Information.Immunizations.Measles18_h"\n          )(state);\n          const date2 = date\n            ? date\n            : dataValue("form.case.update.Measles18_h")(state);\n          return id + date2 + "Measles18";\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "Measles 18"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", (state) => {\n          var date = dataValue(\n            "form.TT5.Child_Information.Immunizations.Measles18_h"\n          )(state);\n          return date ? date : state.data.form.case.update.Measles18_h;\n        }),\n        field("Type_of_Service__c", "Immunization"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Immunizations.Facility_Measles_18"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No measles 18.");\n  return state;\n});\n\n//Deworming\nalterState((state) => {\n  if (dataValue("form.TT5.Child_Information.Deworming")(state) == "Yes") {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "deworming";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "deworming";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "Deworming"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", dataValue("form.Date")),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "Immunization"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No deworming.");\n  return state;\n});\n\n//Home Based care for HAWI clients\nalterState((state) => {\n  if (\n    dataValue("form.HAWI.Home_Based_Care.Home_Based_Care_Provided")(state) !==\n    undefined &&\n    dataValue("form.HAWI.Home_Based_Care.Home_Based_Care_Provided")(state) !==\n    ""\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "homecare";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "homecare";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Reason_for_Service__c", "Home-Based Care"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Date__c", dataValue("form.Date")),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "HIV"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Home_Based_Care_Rendered__c", (state) => {\n          var care = "";\n          var str = dataValue(\n            "form.HAWI.Home_Based_Care.Home_Based_Care_Provided"\n          )(state);\n          care = str.replace(/ /g, ";");\n          care = care.replace(/_/g, " ");\n          return care;\n        }),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No HAWI HBC.");\n  return state;\n});\n\n//Malaria cases\n//Child\nalterState((state) => {\n  if (dataValue("form.treatment_and_tracking.malaria_test")(state) === "yes") {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "malaria";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "malaria";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.Date")),\n        field("Follow_Up_By_Date__c", (state) => {\n          var date = dataValue("form.Follow-Up_By_Date")(state);\n          return date !== undefined || date !== "" ? date : null;\n        }),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("Referred__c", 1),\n        field("Type_of_Service__c", "Illness"),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", "Malaria"),\n        field(\n          "Malaria_Status__c",\n          dataValue("form.treatment_and_tracking.malaria_test_results")\n        ),\n        field(\n          "Home_Treatment_Date__c",\n          dataValue("form.TT5.Child_Information.CCMM.Home_Treatment_Date")\n        ),\n        field(\n          "Malaria_Home_Test_Date__c",\n          dataValue("form.treatment_and_tracking.malaria_test_date")\n        ),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No malaria test.");\n  return state;\n});\n\n//Malnutrition case\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Nutrition2.Nutrition_Status")(\n      state\n    ) !== undefined\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "malnutrition";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "malnutrition";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.Date")),\n        field("Follow_Up_By_Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Reason_for_Service__c", "Nutrition Screening"),\n        field(\n          "Clinical_Visit_Date__c",\n          dataValue("form.TT5.Child_Information.Nutrition2.Clinical_Date")\n        ),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        ),\n        field(\n          "Height__c",\n          dataValue("form.TT5.Child_Information.Nutrition.Height")\n        ),\n        field(\n          "Weight__c",\n          dataValue("form.TT5.Child_Information.Nutrition.Weight")\n        ),\n        field(\n          "MUAC__c",\n          dataValue("form.TT5.Child_Information.Nutrition.MUAC")\n        ),\n        field("Nutrition_Status__c", (state) => {\n          var status = "";\n          if (\n            dataValue("form.TT5.Child_Information.Nutrition2.Nutrition_Status")(\n              state\n            ) == "normal"\n          ) {\n            status = "Normal";\n          } else if (\n            dataValue("form.TT5.Child_Information.Nutrition2.Nutrition_Status")(\n              state\n            ) == "moderate"\n          ) {\n            status = "Moderately Malnourished";\n          } else if (\n            dataValue("form.TT5.Child_Information.Nutrition2.Nutrition_Status")(\n              state\n            ) == "severe"\n          ) {\n            status = "Severely Malnourished";\n          }\n          return status;\n        }),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Nutrition2.referred_facility_malnutrition"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  console.log("No malnutrition.");\n  return state;\n});\n\n//Referrals ... check on Site__r mappings and PNC service\n//Other Referrals\nalterState((state) => {\n  if (\n    dataValue("form.treatment_and_tracking.symptoms_other_referral")(state) ==\n    "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "other";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "other";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : "a0308000021zm8Z";\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Referred__c", 1),\n        field("Follow_Up_By_Date__c", (state) => {\n          var date = dataValue("form.Follow-Up_By_Date")(state);\n          return date === null || date === "" ? null : date;\n        }),\n        field("Reason_for_Service__c", "Referral"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", (state) => {\n          var purpose = dataValue(\n            "form.treatment_and_tracking.symptoms_check_other"\n          )(state)\n            .toLowerCase()\n            .split(" ")\n            .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n            .join(";");\n          return purpose.toString().replace(/_/g, " ");\n        }),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No other referral.");\n  return state;\n});\n\n//Skilled Delivery Referral\nalterState((state) => {\n  if (\n    dataValue(\n      "form.TT5.Child_Information.pregnancy_danger_signs.refer_skilled_delivery"\n    )(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "skilled_delivery";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "skilled_delivery";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Referred__c", 1),\n        field("Follow_Up_By_Date__c", (state) => {\n          var date = dataValue("form.Follow-Up_By_Date")(state);\n          return date === null || date === "" ? null : date;\n        }),\n        field("Reason_for_Service__c", "Referral"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", "Skilled Delivery"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No skilled delivery.");\n  return state;\n});\n\n//Prenancy danger signs Referral\nalterState((state) => {\n  if (\n    dataValue(\n      "form.TT5.Child_Information.pregnancy_danger_signs.danger_sign_referral.referral"\n    )(state) == "Yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "pregnancy_danger_signs";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "pregnancy_danger_signs";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field(\n          "Date__c",\n          dataValue(\n            "form.TT5.Child_Information.pregnancy_danger_signs.danger_sign_referral.referral_date"\n          )\n        ),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Referred__c", 1),\n        field(\n          "Follow_Up_By_Date__c",\n          dataValue(\n            "form.TT5.Child_Information.pregnancy_danger_signs.danger_sign_referral.Follow-Up_By_Date"\n          )\n        ),\n        field(\n          "Clinician_Comments__c",\n          dataValue(\n            "form.TT5.Child_Information.pregnancy_danger_signs.danger_sign_referral.Clinician_Notes"\n          )\n        ),\n        field("Reason_for_Service__c", "Referral"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", "Pregnancy Danger Signs"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No danger signs.");\n  return state;\n});\n\n//PNC Referral ---\x3e TO UPDATE\nalterState((state) => {\n  if (\n    dataValue(\n      "form.ANCs.pregnancy_danger_signs.Delivery_Information.refer_pnc"\n    )(state) == "yes"\n  ) {\n    //Update when Julia updates group ???\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "pnc";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "pnc";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.Date")),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Referred__c", 1),\n        field("Follow_Up_By_Date__c", (state) => {\n          var date = dataValue("form.Follow-Up_By_Date")(state);\n          return date === null || date === "" ? null : date;\n        }),\n        field("Reason_for_Service__c", "Referral"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", "PNC"),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No PNC.");\n  return state;\n});\n\n//Malnutrition Referral\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Nutrition2.Referral")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "malnutrition";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "malnutrition";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.case.update.Date")),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Referred__c", 1),\n        field("Follow_Up_By_Date__c", (state) => {\n          var date = dataValue("form.Follow-Up_By_Date")(state);\n          return date === null || date === "" ? null : date;\n        }), //UPDATE\n        field("Reason_for_Service__c", "Referral"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", "Malnutrition"),\n        field(\n          "Nutrition_Status__c",\n          dataValue("form.TT5.Child_Information.Nutrition2.Nutrition_Status")\n        ),\n        field(\n          "MUAC__c",\n          dataValue("form.TT5.Child_Information.Nutrition.MUAC")\n        ),\n        field("Clinical_facility__c", (state) => {\n          var facility = dataValue(\n            "form.TT5.Child_Information.Nutrition2.referred_facility_malnutrition"\n          )(state);\n          return facility !== undefined\n            ? //? facility.toString().replace(/_/g, \' \')\n            facility.charAt(0).toUpperCase() +\n            facility.substr(1).toLowerCase().replace(/_/g, " ")\n            : null;\n        }),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No malnutrition referral.");\n  return state;\n});\n\n//Child Danger Sign Referral\nalterState((state) => {\n  if (\n    dataValue(\n      "form.TT5.Child_Information.Danger_Signs.danger_sign_referral.Danger_Signs_Referral"\n    )(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "child_danger_sign";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "child_danger_sign";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.case.update.Date")),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Referred__c", 1),\n        field(\n          "Follow_Up_By_Date__c",\n          dataValue(\n            "form.TT5.Child_Information.Danger_Signs.danger_sign_referral.Danger_Signs_Follow-Up_By_Date"\n          )\n        ),\n        field("Reason_for_Service__c", "Referral"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", "Child Danger Sign"),\n        field(\n          "Clinician_Comments__c",\n          dataValue(\n            "form.TT5.Child_Information.Danger_Signs.danger_sign_referral.Clinician_Notes"\n          )\n        ),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No danger sign referral.");\n  return state;\n});\n\n//TB Referral\nalterState((state) => {\n  if (dataValue("form.treatment_and_tracking.TB_referral")(state) == "yes") {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "tb";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "tb";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.case.update.Date")),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Referred__c", 1),\n        field("Follow_Up_By_Date__c", (state) => {\n          var date = dataValue("form.Follow-Up_By_Date")(state);\n          return date === null || date === "" ? null : date;\n        }),\n        field("Reason_for_Service__c", "Referral"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", "TB"),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.treatment_and_tracking.TB_referral_facility"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        }),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No tb referral.");\n  return state;\n});\n\n//Diarrhea Referral\nalterState((state) => {\n  if (\n    dataValue("form.treatment_and_tracking.diarrhea_referral")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "diarrhea";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "diarrhea";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.case.update.Date")),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Referred__c", 1),\n        field("Follow_Up_By_Date__c", (state) => {\n          var date = dataValue("form.Follow-Up_By_Date")(state);\n          return date === null || date === "" ? null : date;\n        }),\n        field("Reason_for_Service__c", "Referral"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", "Diarrhea"),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.treatment_and_tracking.diarrhea_referral_facility"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        }),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No diarrhea referral.");\n  return state;\n});\n\n//Malaria Referral\nalterState((state) => {\n  if (\n    dataValue("form.treatment_and_tracking.malaria_referral")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "malaria";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "malaria";\n          return serviceId;\n        }),\n        field("Source__c", 1),\n        field("Date__c", dataValue("form.case.update.Date")),\n        field("Type_of_Service__c", "CHW Mobile Survey"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : chw\n              ? chw\n              : undefined;\n        }),\n        field("RecordTypeID", "01224000000YAuK"),\n        field("Referred__c", 1),\n        field("Follow_Up_By_Date__c", (state) => {\n          var date = dataValue("form.Follow-Up_By_Date")(state);\n          return date === null || date === "" ? null : date;\n        }),\n        field("Reason_for_Service__c", "Referral"),\n        field("Open_Case__c", 1),\n        field("Purpose_of_Referral__c", "Malaria"),\n        relationship("Site__r", "Label__c", (state) => {\n          var facility = dataValue(\n            "form.treatment_and_tracking.malaria_referral_facility"\n          )(state);\n          if (facility === "" || facility === undefined) {\n            facility = "unknown";\n          }\n          return facility;\n        }),\n        field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n        relationship(\n          "Person__r",\n          "CommCare_ID__c",\n          dataValue("form.case.@case_id")\n        )\n      )\n    )(state);\n  }\n\n  console.log("No malaria referral.");\n  return state;\n});\n\n//HAWI other clinical services received\nalterState((state) => {\n  const serviceMap = {\n    Scheduled_PSC_Apt: "Scheduled PSC Apt",\n    Adverse_Drug_Reaction_Side_Effect: "Adverse Drug Reaction/Side Effect",\n    Malnutrition: "Malnutrition",\n    Malaria: "Malaria",\n    TB: "TB",\n    Treatment_for_Other_OIs: "Treatment for other Ols",\n    ARI: "ARI",\n    Anemia: "Anemia",\n    Diarrhea: "Diarrhea",\n    Pregnancy_Care: "Pregnancy Care (ANC)",\n    Family_Planning: "Family Planning (FP)",\n    Preconception_Counseling: "Preconception Counseling",\n    Injury: "Injury",\n    Other: "Other",\n  };\n\n  if (dataValue("form.HAWI.Clinical_Service_Q")(state) === "yes") {\n    return beta.each(\n      dataPath("form.HAWI.Clinical_Services_Rendered[*]"), //CHECK IF ARRAY\n      upsert(\n        "Service__c",\n        "Service_UID__c",\n        fields(\n          field("CommCare_Code__c", (state) => {\n            var id = dataValue("Case_ID")(state);\n            var serviceId =\n              id +\n              dataValue("Purpose")(state) +\n              dataValue("Clinical_Date")(state);\n            return serviceId.replace(/\\//g, "");\n          })(state),\n          field("Service_UID__c", (state) => {\n            var id = dataValue("Case_ID")(state);\n            var serviceId =\n              id +\n              dataValue("Purpose")(state) +\n              dataValue("Clinical_Date")(state);\n            return serviceId.replace(/\\//g, "");\n          })(state),\n          field("Source__c", 1),\n          field("Household_CHW__c", dataValue("chw")),\n          field("Reason_for_Service__c", (state) => {\n            var name = dataValue("Clinical_Service")(state);\n            return name ? state.serviceMap[name] : name;\n          }),\n          field("Purpose_of_Referral__c", dataValue("Purpose")),\n          field("Date__c", dataValue("Date_of_Clinical_Service")),\n          field("Type_of_Service__c", "CHW Mobile Survey"),\n          field("RecordTypeID", "01224000000YAuK"),\n          relationship("Site__r", "Label__c", (state) => {\n            var facility = dataValue("Facility_of_Clinical_Service")(state);\n            if (facility === "" || facility === undefined) {\n              facility = "unknown";\n            } else if (facility == "Other_Clinic") {\n              facility = "Other";\n            } else if (facility == "Rongo_Sub-District_Hospital") {\n              facility = "Rongo_SubDistrict_Hospital";\n            }\n            return facility;\n          }),\n          field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n          relationship("Person__r", "CommCare_ID__c", dataValue("Case_ID"))\n        )\n      )\n    )(state);\n  }\n\n  console.log("No other HAWI clinical services.");\n  return state;\n});\n\n//TT5 other clinical services received\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Clinical_Services_Q")(state) === "Yes"\n  ) {\n    return beta.each(\n      dataPath("form.TT5.Child_Information.Clinical_Services[*]"),\n      upsert(\n        "Service__c",\n        "Service_UID__c",\n        fields(\n          field("CommCare_Code__c", (state) => {\n            var id = dataValue("Case_ID")(state);\n            var serviceId =\n              id +\n              dataValue("Purpose")(state) +\n              dataValue("Clinical_Date")(state);\n            return serviceId.replace(/\\//g, "");\n          }),\n          field("Service_UID__c", (state) => {\n            var id = dataValue("Case_ID")(state);\n            var serviceId =\n              id +\n              dataValue("Purpose")(state) +\n              dataValue("Clinical_Date")(state);\n            return serviceId.replace(/\\//g, "");\n          }),\n          field("Source__c", true),\n          field("Household_CHW__c", dataValue("chw")),\n          field("Reason_for_Service__c", (state) => {\n            var reason = "";\n            var name = dataValue("Clinical_Service")(state);\n            if (name == "Adverse_Drug_Reaction_Side_Effect") {\n              reason = "Adverse Drug Reaction/Side Effect";\n            } else if (name == "Pregnancy_Care") {\n              reason = "Pregnancy Care (ANC)";\n            } else if (name == "Family_Planning") {\n              reason = "Family Planning (FP)";\n            } else if (name !== undefined) {\n              reason = name.replace(/_/g, " ");\n            }\n            return reason;\n          }),\n          field("Purpose_of_Referral__c", dataValue("Purpose")),\n          field("Date__c", dataValue("Clinical_Date")),\n          field("Type_of_Service__c", "CHW Mobile Survey"),\n          field("RecordTypeID", "01224000000YAuK"),\n          field("Clinic_Zinc__c", dataValue("diarrhea_clinic_treatment_zinc")),\n          field("Clinic_ORS__c", dataValue("diarrhea_clinic_treatment_ORS")),\n          relationship("Site__r", "Label__c", (state) => {\n            var facility = dataValue("Facility_Clinical")(state);\n            if (facility === "" || facility === undefined) {\n              facility = "unknown";\n            }\n            return facility;\n          }),\n          field("Age_Time_of_Service__c", dataValue("form.age")), //Added by MOTG\n          relationship("Person__r", "CommCare_ID__c", dataValue("Case_ID"))\n        )\n      )\n    )(state);\n  }\n\n  console.log("No other clinical services.");\n  return state;\n});\n\n//Upsert Visit records\nalterState((state) => {\n  if (\n    dataValue("form.Source")(state) == 1 &&\n    dataValue("metadata.username")(state) !== "test.2021"\n  ) {\n    return upsert(\n      "Visit__c",\n      "CommCare_Visit_ID__c",\n      fields(\n        field("CommCare_Visit_ID__c", dataValue("id")),\n        field("Visit_UID__c", (state) => {\n          var hh = dataValue("form.HH_ID")(state);\n          var date = dataValue("metadata.timeEnd")(state);\n          return hh + date;\n        }),\n        relationship(\n          "Household__r",\n          "CommCare_Code__c",\n          dataValue("form.HH_ID")\n        ),\n        field("Name", "CHW Visit"),\n        field("Household_CHW__c", (state) => {\n          var chw = dataValue("form.CHW_ID_Final")(state);\n          return chw === "a030800001zQrk"\n            ? "a030800001zQrk5"\n            : "a031x000004oJe2"\n              ? "a0308000021zm8Z"\n              : chw\n                ? chw\n                : "a0308000021zm8Z";\n        }),\n        field("Supervisor_Visit__c", (state) => {\n          var visit = dataValue("form.supervisor_visit")(state);\n          if (visit !== undefined) {\n            visit = visit.toString().replace(/ /g, ";");\n            return visit.toString().replace(/_/g, " ");\n          }\n          return visit;\n        }),\n        field("Date__c", dataValue("metadata.timeEnd")),\n        field("Location__latitude__s", (state) => {\n          const location = state.data.metadata.location;\n          const locationArr = location !== null ? location.split(" ") : [];\n          return locationArr[0];\n        }),\n        field("Location__longitude__s", (state) => {\n          const location = state.data.metadata.location;\n          const locationArr = location !== null ? location.split(" ") : [];\n          return locationArr[1];\n        })\n      )\n    )(state);\n  }\n\n  console.log("form.Source is not 1, not upserting visit.");\n  return state;\n});\n\n//Map Zinc and ors\nalterState((state) => {\n  if (\n    dataValue("form.TT5.Child_Information.Clinical_Services_Q")(state) === "Yes"\n  ) {\n    return beta.each(\n      dataPath("form.TT5.Child_Information.Clinical_Services[*]"),\n      upsert(\n        "Person__c",\n        "CommCare_ID__c",\n        fields(\n          field("Source__c", 1),\n          field("CommCare_ID__c", dataValue("Case_ID")),\n          field("Child_zinc__c", (state) => {\n            var zinc = dataValue("diarrhea_clinic_treatment_zinc")(state);\n            return zinc === "Yes" ? "Yes" : undefined;\n          }),\n          field("Child_ORS__c", (state) => {\n            var ors = dataValue("diarrhea_clinic_treatment_ORS")(state);\n            return ors === "Yes" ? "Yes" : undefined;\n          })\n        )\n      )\n    )(state);\n  }\n\n  console.log("No zinc and ors.");\n  return state;\n});\n//MOTG\n//Immunization - Defaulter\nalterState((state) => {\n  if (\n    dataValue("form.TT5/Child_Information/Immunizations/refer_immunization_type")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "immunization";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "immunization";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Immunization"),\n          field("Reason_for_Service__c", "Missed immunization type"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No immunization referral.");\n    return state;  \n});\n\n//Immunization - Vitamin A \nalterState((state) => {\n  if (\n    dataValue("form.TT5/Child_Information/Immunizations/did_you_refer_the_child_6-59_months_for_vitamin_a_supplements")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "immunization";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "immunization";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Immunization"),\n          field("Reason_for_Service__c", "Vitamin A supplement"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No Vitamin A referral.");\n    return state;  \n});\n//Immunization \nalterState((state) => {\n  if (\n    dataValue("form.TT5/Child_Information/Immunizations/did_you_refer_the_child_0-11_months_for_immunization")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "immunization";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "immunization";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Immunization"),\n          field("Reason_for_Service__c", "Immunizations"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No Immunization referral.");\n    return state;  \n});\n//Chest Indrawing\nalterState((state) => {\n  if (\n    dataValue(\'form.psbi.Child_chest_in_drawing_c\')(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "illness";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "illness";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Illness"),\n          field("Reason_for_Service__c", "Chest in-drawing"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No chest indrawing referral.");\n    return state;  \n});\n//Fast Breathing\nalterState((state) => {\n  if (\n    dataValue(\'form.psbi.did_you_refer_the_child_for_fast_breathing\')(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "illness";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "illness";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Illness"),\n          field("Reason_for_Service__c", "Fast Breathing"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No fast breathing referral.");\n    return state;  \n});\n//Fever\nalterState((state) => {\n  if (\n    dataValue(\'form.CCMM/Fever_Referral_Status /data/treatment_and_tracking/CCMM/Fever_Referral_Status\')(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "illness";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "illness";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Illness"),\n          field("Reason_for_Service__c", "Fever"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No fever referral.");\n    return state;  \n});\n//Cough\nalterState((state) => {\n  if (\n    dataValue(\'form.treatment_and_tracking/did_you_refer_the_client_for_cough_14_days\')(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "illness";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "illness";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Illness"),\n          field("Reason_for_Service__c", "Cough 14+ days"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No cough referral.");\n    return state;  \n});\n//Pregnancy\nalterState((state) => {\n  if (\n    dataValue("form.Person/Basic_Information/family_planning/refer_preg")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "pregnancy";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "pregnancy";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Ante-Natal Care"),\n          field("Reason_for_Service__c", "Pregnancy Care (ANC)"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No Pregnancy referral.");\n    return state;  \n});\n//Family Plannning\nalterState((state) => {\n  if (\n    dataValue("form.TT5/Mother_Information/referred_for_family_planning_services")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "family_planning";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "family_planning";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Family Planning"),\n          field("Reason_for_Service__c", "Family Planning (FP)"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No Family Planning referral.");\n    return state;  \n});\n//Chronic Illness\nalterState((state) => {\n  if (\n    dataValue("form.Person/Basic_Information/person_info/refer_chronic_illness")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "chronic_illness";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "chronic_illness";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Illness"),\n          field("Reason_for_Service__c", "Chronic Illness"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No chronic illness referral.");\n    return state;  \n});\n//HIV - HTC\nalterState((state) => {\n  if (\n    dataValue("form.Person/Basic_Information/person_info/hiv_counselling_and_testing")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "HIV_HTC";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "HIV_HTC";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "HIV"),\n          field("Reason_for_Service__c", "HIV counseling and testing"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No HIV HTC referral.");\n    return state;  \n});\n//HIV - Clinical\nalterState((state) => {\n  if (\n    dataValue("form.Person/HAWI/did_you_refer")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "HIV_Clinical";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "HIV_Clinical";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "HIV"),\n          field("Reason_for_Service__c", "ART treatment"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No ART Treatment referral.");\n    return state;  \n});\n//TB\nalterState((state) => {\n  if (\n    dataValue("form.treatment_and_tracking/tb_treatment")(state) == "yes"\n  ) {\n    return upsert(\n      "Service__c",\n      "Service_UID__c",\n      fields(\n        field("CommCare_Code__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "TB";\n          return serviceId;\n        }),\n        field("Service_UID__c", (state) => {\n          var id = dataValue("id")(state);\n          var serviceId = id + "TB";\n          return serviceId;\n        }),\n        field("Household_CHW__c", dataValue("form.CHW_ID_Final"),\n          field("Type_of_Service__c", "Illness"),\n          field("Reason_for_Service__c", "TB treatment"),\n          field("Date__c", dataValue("form.case.update.Date"),\n            field("RecordTypeID", "01224000000YAuK"),\n            relationship(\n              "Person__r",\n              "CommCare_ID__c",\n              dataValue("form.case.@case_id")\n            ),\n          )\n        )\n      ))(state);\n    }\n    console.log("No TB referral.");\n    return state;  \n});\n')))}f.isMDXComponent=!0}}]);