"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[936],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(n),c=a,m=d["".concat(l,".").concat(c)]||d[c]||h[c]||r;return n?o.createElement(m,i(i({ref:t},u),{},{components:n})):o.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:a,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},73742:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var o=n(87462),a=(n(67294),n(3905));const r={title:"Lightning Quick-Start (v2)"},i=void 0,s={unversionedId:"build/lightning-quick-start",id:"build/lightning-quick-start",title:"Lightning Quick-Start (v2)",description:"Follow this tutorial to get familiar with OpenFn Lightning. If you get stuck,",source:"@site/docs/build/lightning-quick-start.md",sourceDirName:"build",slug:"/build/lightning-quick-start",permalink:"/documentation/build/lightning-quick-start",draft:!1,editUrl:"https://github.com/openfn/docs/edit/main/docs/build/lightning-quick-start.md",tags:[],version:"current",frontMatter:{title:"Lightning Quick-Start (v2)"},sidebar:"docs",previous:{title:"Platform Quick-Start (v1)",permalink:"/documentation/build/example-build"},next:{title:"OpenFn Concepts",permalink:"/documentation/getting-started/terminology"}},l={},p=[{value:"1. Register",id:"1-register",level:2},{value:"2. Understand the sample workflow",id:"2-understand-the-sample-workflow",level:2},{value:"SETUP TAB",id:"setup-tab",level:3},{value:"EDITOR TAB",id:"editor-tab",level:3},{value:"3. Run the sample workflow",id:"3-run-the-sample-workflow",level:2},{value:"Manually send data to your first job trigger",id:"manually-send-data-to-your-first-job-trigger",level:3},{value:"Send data through a curl request",id:"send-data-through-a-curl-request",level:3},{value:"Send data from your external system",id:"send-data-from-your-external-system",level:3},{value:"4. Check your request got processed correctly",id:"4-check-your-request-got-processed-correctly",level:2},{value:"5. Make a run that fails, then edit the job and retry it to make it succeed",id:"5-make-a-run-that-fails-then-edit-the-job-and-retry-it-to-make-it-succeed",level:2}],u={toc:p},d="wrapper";function h(e){let{components:t,...r}=e;return(0,a.kt)(d,(0,o.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Follow this tutorial to get familiar with OpenFn Lightning. If you get stuck,\npost a question to our ",(0,a.kt)("a",{parentName:"p",href:"https://community.openfn.org/"},"community forum"),"."),(0,a.kt)("h2",{id:"1-register"},"1. Register"),(0,a.kt)("p",null,"Register for an account on\n",(0,a.kt)("a",{parentName:"p",href:"https://app.openfn.org/users/register"},"app.openfn.org")," and follow the link sent\nto your inbox to confirm your email."),(0,a.kt)("p",null,"*","If you already have an account, you can\n",(0,a.kt)("a",{parentName:"p",href:"https://app.openfn.org/users/log_in"},"login"),"."),(0,a.kt)("h2",{id:"2-understand-the-sample-workflow"},"2. Understand the sample workflow"),(0,a.kt)("p",null,"Click on the 'sample workflow' created for you on registration."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning-workflows-page",src:n(18401).Z,width:"1440",height:"814"})),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"A ",(0,a.kt)("strong",{parentName:"p"},"workflow")," is a series of tasks to be carried out ",(0,a.kt)("em",{parentName:"p"},"automatically")," (i.e a\nprocess that has been automated).")),(0,a.kt)("p",null,"The sample workflow pictured below formats and sends data from a source system\n(KoboToolbox, a mobile data-collection app) to a destination system (DHIS2, a\nhealth information management system). It automates patient registration by\ntaking a patient\u2019s name and age and:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"checking if they are over 18 months old;"),(0,a.kt)("li",{parentName:"ol"},"converting it to the same format as DHIS2;"),(0,a.kt)("li",{parentName:"ol"},"uploading it to DHIS2.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning-sample-workflow",src:n(53740).Z,width:"1440",height:"819"})),(0,a.kt)("p",null,"It is made up of 3 ",(0,a.kt)("em",{parentName:"p"},"jobs"),"."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"A ",(0,a.kt)("strong",{parentName:"p"},"job")," is an action to be carried out at a given point in time. It has a\ntrigger, an adaptor, a credential and a job expression which each define ",(0,a.kt)("em",{parentName:"p"},"when,\nwhere, how")," and ",(0,a.kt)("em",{parentName:"p"},"what")," to do.")),(0,a.kt)("p",null,"Click on Job 3 to view more details about it in the setup and editor tab."),(0,a.kt)("h3",{id:"setup-tab"},"[SETUP TAB]"),(0,a.kt)("p",null,"The SETUP TAB is where you define the when, where and how of your job."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning_setup",src:n(19694).Z,width:"624",height:"740"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"When: trigger")),(0,a.kt)("p",null,"The trigger defines when an action should happen. It can be one of the\nfollowing:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"When data is sent to OpenFn Lightning from an external system: ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("em",{parentName:"strong"},"webhook"))),(0,a.kt)("li",{parentName:"ul"},"At a recurring point in time: ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("em",{parentName:"strong"},"cron"))),(0,a.kt)("li",{parentName:"ul"},"When the job which comes before it in the workflow succeeds: ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("em",{parentName:"strong"},"on success"))),(0,a.kt)("li",{parentName:"ul"},"When the job which comes before it in the workflow fails: ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("em",{parentName:"strong"},"on failure")))),(0,a.kt)("p",null,"If you ",(0,a.kt)("strong",{parentName:"p"},"never")," want the job to run, you can disable it by unselecting the\n'Enabled' checkbox."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"The trigger for the first job in a workflow will always be either a 'cron' or\n'webhook' trigger. All the other jobs will have a trigger of 'on success' or 'on\nfailure'.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Where: adaptor")),(0,a.kt)("p",null,"The adaptor is what helps you communicate with and perform actions in a\nparticular system. In OpenFn, you can carry out an action in the following\nsystems:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"In OpenFn: OpenFn or common adaptors"),(0,a.kt)("li",{parentName:"ul"},"In an external system OpenFn has an adaptor for: commcare, DHIS2, google\nsheets, kobotoolbox ..."),(0,a.kt)("li",{parentName:"ul"},"In any other external system which has an API: http adaptor")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"How: credential")),(0,a.kt)("p",null,"Credentials define ",(0,a.kt)("em",{parentName:"p"},"how")," a Job is able to perform an action on your behalf, just\nas you would need to cover logging in if you were explaining how to carry out an\naction manually."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"If you are performing an action in an external system, you'll need to select\n",(0,a.kt)("em",{parentName:"p"},"the same")," credential type as your adaptor.")),(0,a.kt)("h3",{id:"editor-tab"},"[EDITOR TAB]"),(0,a.kt)("p",null,"The EDITOR TAB is where you define ",(0,a.kt)("em",{parentName:"p"},"what")," the job should do and which data to\nuse."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"When you need to use data that comes from your webhook trigger (data sent from\nyour external system), cron trigger, or a previous job you can find it in\n",(0,a.kt)("inlineCode",{parentName:"p"},"state"),". Learn more ",(0,a.kt)("a",{parentName:"p",href:"https://docs.openfn.org/documentation/jobs/state/"},"here"),".")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning_editor_1",src:n(8794).Z,width:"624",height:"741"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"What: Job expression")),(0,a.kt)("p",null,"The job expression defines what action to carry out and which data values to\nuse."),(0,a.kt)("p",null,"It gets added from the adaptor documentation ",(0,a.kt)("em",{parentName:"p"},"below")," the editor as an example\noperation, and is then configured to use specific values from the state input\ndata. (see image below for details)"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning_editor",src:n(45039).Z,width:"624",height:"741"})),(0,a.kt)("h2",{id:"3-run-the-sample-workflow"},"3. Run the sample workflow"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"A workflow will run when the trigger from the first job (represented as the\nfirst node on the canvas) is called.")),(0,a.kt)("p",null,"In the case of the Sample Workflow, this is when data is sent to the webhook\nURL. There are three ways of doing this."),(0,a.kt)("p",null,"Follow the instructions from ",(0,a.kt)("em",{parentName:"p"},"one")," of the options below to run your workflow."),(0,a.kt)("h3",{id:"manually-send-data-to-your-first-job-trigger"},"Manually send data to your first job trigger"),(0,a.kt)("p",null,"Click on the first job in your workflow, then head to the input tab. Paste the\ndata below into the ",(0,a.kt)("inlineCode",{parentName:"p"},"custom input"),", then click ",(0,a.kt)("inlineCode",{parentName:"p"},"run"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "age_in_months": 19,\n    "name": "Wycliffe Gigiwe"\n  }\n}\n')),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning_manual_run",src:n(99291).Z,width:"1440",height:"819"})),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"When a job is run, OpenFn adds the input into state (used to get data values in\nthe job expression), along with the credentials which get added to\nconfiguration.")),(0,a.kt)("h3",{id:"send-data-through-a-curl-request"},"Send data through a curl request"),(0,a.kt)("p",null,"You can also send data to a webhook URL by making a curl request in your\nterminal."),(0,a.kt)("p",null,"Copy your webhook URL by clicking on the first node of your workflow, then use\nit to replace ",(0,a.kt)("inlineCode",{parentName:"p"},"YOUR_WEBHOOK_URL")," in the command below and run it in your CLI."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'curl -H \'Content-Type: application/json\' \\\n      -d \'{"age_in_months": 19, "name": "Wycliffe Gigiwe"}\' \\\n      -X POST \\\n      YOUR_WEBHOOK_URL\n')),(0,a.kt)("h3",{id:"send-data-from-your-external-system"},"Send data from your external system"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"You can trigger a workflow from an external system by configuring it's REST\nservices to send data to your trigger webhook URL.")),(0,a.kt)("p",null,"In the case of our Sample Workflow, we're using KoboToolbox as an external\nsystem."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://kf.kobotoolbox.org/accounts/login/#/"},"Log into")," our KoboToolbox demo\naccount with ",(0,a.kt)("em",{parentName:"p"},"username: openfn_demo and password: openfn_demo"),". Select the form\nyou\u2019d like to connect ('Lightning sample workflow') and go to Settings -> REST\nservices -> Register a new service."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"kobo",src:n(85710).Z,title:"Register a REST service with Kobo",width:"2002",height:"754"})),(0,a.kt)("p",null,"Set the service name to OpenFn and the URL to the webhook URL (you can copy is\nfrom the first node on your workflow)."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"kobo",src:n(73441).Z,title:"Set the REST service URL to your OpenFn inbox URL",width:"1178",height:"1554"})),(0,a.kt)("p",null,"Your form should now be configured to send data to the webhook trigger for your\nfirst job whenever a response is submitted. We can test this out by submitting\nsome form responses at Form -> Open."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"kobo form",src:n(48677).Z,title:"Open a kobo form",width:"2688",height:"1006"})),(0,a.kt)("h2",{id:"4-check-your-request-got-processed-correctly"},"4. Check your request got processed correctly"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"The history page shows you each ",(0,a.kt)("strong",{parentName:"p"},"work order")," or ",(0,a.kt)("em",{parentName:"p"},"request for data to be\nprocessed"),".")),(0,a.kt)("p",null,"Now that you have run your workflow, head to the history page to see the work\norder. You'll see it has a status of 'Success' which means it got processed\ncorrectly."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning_history",src:n(64344).Z,width:"1440",height:"819"})),(0,a.kt)("p",null,"Click on the chevron next to the status to expand it and see each job run."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning-history_expanded",src:n(81154).Z,width:"1440",height:"819"})),(0,a.kt)("h2",{id:"5-make-a-run-that-fails-then-edit-the-job-and-retry-it-to-make-it-succeed"},"5. Make a run that fails, then edit the job and retry it to make it succeed"),(0,a.kt)("p",null,"From your workflow page, run the job manually with a patient that is 18 months\nold using the data below."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "age_in_months": 18,\n    "name": "Njoroge Orao"\n  }\n}\n')),(0,a.kt)("p",null,"Head to the history page and see that the work order has a status of 'Failure'.\nThis is because the patient is ",(0,a.kt)("strong",{parentName:"p"},"not")," older than 18 months."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning_history_failure",src:n(6505).Z,width:"1440",height:"819"})),(0,a.kt)("p",null,"Let's say we made a mistake and ",(0,a.kt)("em",{parentName:"p"},"actually")," wanted to register any patient that\nis ",(0,a.kt)("em",{parentName:"p"},(0,a.kt)("strong",{parentName:"em"},"both"))," 18 months old ",(0,a.kt)("em",{parentName:"p"},(0,a.kt)("strong",{parentName:"em"},"and"))," above. We want to edit the job logic and\nreprocess the request."),(0,a.kt)("p",null,"Head to the Editor tab in Job 1 to update the logic by changing the if statement\nfrom ",(0,a.kt)("inlineCode",{parentName:"p"},"> 18")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"<= 18"),"."),(0,a.kt)("p",null,"Your Job expression should now be the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"fn(state => {\n  if (state.data.age_in_months >= 18) {\n    console.log('Eligible for program.');\n    return state;\n  } else {\n    throw 'Error, patient ineligible.';\n  }\n});\n")),(0,a.kt)("p",null,'Make sure to click save, then head back to your history page and find the work\norder you want to reprocess. You can search for "Njoroge Orao" in the search bar\nto find it.'),(0,a.kt)("p",null,"Expand the work order, and click the 'rerun' button next to the first job run."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning_retry",src:n(87443).Z,width:"1440",height:"815"})),(0,a.kt)("p",null,"You'll see a new ",(0,a.kt)("strong",{parentName:"p"},"attempt")," created in the same work order, which now succeeds.\nThe work order status also gets updated to the status of the last attempt to\nshow 'Success'."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"lightning_new_attempt",src:n(38901).Z,width:"1440",height:"818"})))}h.isMDXComponent=!0},85710:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/2.3_kobo_rest-7c2166adc52578a9bce93e3784d0282c.png"},73441:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/2.4_kobo_rest-45304fa0798cebd2ac207d3d5946246f.png"},48677:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/2.5_open_kobo_form-b999c7d71946868574d92ac7aba2ebaa.png"},53740:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning-sample-workflow-b71f2e247cc7246981c6d9c2d7269c46.png"},18401:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning-workflows-page-fb2209a5bf8214a841af56b035aa6462.png"},45039:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning_editor-2b5c326caf3c2d66f2ebe9437c02c74a.png"},8794:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning_editor_1-8bdbbcfeab7e340e8a88743a34527b50.png"},64344:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning_history-6f03a62dd23949d120cc05888211441b.png"},81154:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning_history_expanded-aee477837c78d431a1f57cccbf71abc1.png"},6505:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning_history_failure-73df250106bcf5e24b6b39a8cd984012.png"},99291:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning_manual_run-72e783ab913313b6160284de4ae77484.png"},38901:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning_new_attempt-fc786d39b0b84dc1707e4dc4f4e54e55.png"},87443:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning_retry-e5d7da36e4e7ffeb9409c10e861f5384.png"},19694:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/lightning_setup-c19e92c0b729f7d79c4ffd7ed8203801.png"}}]);