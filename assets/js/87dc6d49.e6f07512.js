(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{208:function(e,n,a){"use strict";a.r(n),a.d(n,"frontMatter",(function(){return o})),a.d(n,"metadata",(function(){return l})),a.d(n,"toc",(function(){return _})),a.d(n,"default",(function(){return s}));var t=a(3),r=a(8),i=(a(0),a(331)),o={title:"Create Household in SF (Production) with salesforce",sidebar_label:"Create Household in SF (Production)",id:"Create Household in SF Production-2017-05-15",keywords:["library","job","expression","salesforce","alterState","dataPath","dataValue","each","field","fields","upsert"]},l={unversionedId:"jobs/auto/Create Household in SF Production-2017-05-15",id:"jobs/auto/Create Household in SF Production-2017-05-15",isDocsHomePage:!1,title:"Create Household in SF (Production) with salesforce",description:"This job was provided by an OpenFn.org user via the job library API.",source:"@site/library/jobs/auto/Create Household in SF Production-2017-05-15.md",sourceDirName:"jobs/auto",slug:"/jobs/auto/Create Household in SF Production-2017-05-15",permalink:"/library/jobs/auto/Create Household in SF Production-2017-05-15",version:"current",sidebar_label:"Create Household in SF (Production)",frontMatter:{title:"Create Household in SF (Production) with salesforce",sidebar_label:"Create Household in SF (Production)",id:"Create Household in SF Production-2017-05-15",keywords:["library","job","expression","salesforce","alterState","dataPath","dataValue","each","field","fields","upsert"]},sidebar:"library",previous:{title:"Create Distribution & Referral in SF with salesforce",permalink:"/library/jobs/auto/Create Distribution & Referral in SF-2020-06-19"},next:{title:"Create Household in SF (Sandbox) with salesforce",permalink:"/library/jobs/auto/Create Household in SF Sandbox-2016-12-22"}},_=[{value:"Metadata",id:"metadata",children:[]},{value:"Key Functions",id:"key-functions",children:[]},{value:"Expression",id:"expression",children:[]}],d={toc:_};function s(e){var n=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(t.a)({},d,a,{components:n,mdxType:"MDXLayout"}),Object(i.b)("em",null,"This job was provided by an OpenFn.org user via the job library API."),Object(i.b)("h2",{id:"metadata"},"Metadata"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Name: Create Household in SF (Production)"),Object(i.b)("li",{parentName:"ul"},"Adaptor: ",Object(i.b)("inlineCode",{parentName:"li"},"@openfn/language-salesforce")),Object(i.b)("li",{parentName:"ul"},"Adaptor Version: ",Object(i.b)("inlineCode",{parentName:"li"},"v1.3.2")),Object(i.b)("li",{parentName:"ul"},"Created almost 4 years ago"),Object(i.b)("li",{parentName:"ul"},"Updated 6 months ago")),Object(i.b)("h2",{id:"key-functions"},"Key Functions"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"alterState"),", ",Object(i.b)("inlineCode",{parentName:"p"},"dataPath"),", ",Object(i.b)("inlineCode",{parentName:"p"},"dataValue"),", ",Object(i.b)("inlineCode",{parentName:"p"},"each"),", ",Object(i.b)("inlineCode",{parentName:"p"},"field"),", ",Object(i.b)("inlineCode",{parentName:"p"},"fields"),", ",Object(i.b)("inlineCode",{parentName:"p"},"upsert")),Object(i.b)("h2",{id:"expression"},"Expression"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js"},"//Alters CommCare arrays so that they are formatted as arrays instead of just single values.\nalterState(state => {\n  const person = state.data.form.Person;\n  if (!Array.isArray(person)) {\n    state.data.form.Person = [person];\n  }\n  return state;\n});\n\nupsert(\n  'Household__c',\n  'CommCare_Code__c',\n  fields(\n    field('Name', '00000'),\n    //state =>{\n    //  return dataValue('$.form.case.@case_id')(state).substring(0,5); //<- Will, this change we made was causing errors? what does the '0000' do?\n   //  }),\n    field('Catchment__c', state => {\n      if (dataValue('form.catchment')(state) == 'East Kamagambo') {\n        return 'a002400000pAcQt';\n      } else {\n        return 'a002400000pAcOe';\n      }\n    }),\n    field('CommCare_Code__c', dataValue('$.form.case.@case_id')),\n    field('Household_CHW__c', dataValue('$.form.CHW_ID')),\n    field('Area__c', dataValue('$.form.area')),\n    field('Household_Head_No_Program__c', dataValue('form.No_Program_Head')),\n    field(\n      'Treats_Drinking_Water__c',\n      dataValue('$.form.Household_Information.Treats_Drinking_Water')\n    ),\n    field(\n      'WASH_Trained__c',\n      dataValue('$.form.Household_Information.WASH_Trained')\n    ),\n    field(\n      'Rubbish_Pit__c',\n      dataValue('$.form.Household_Information.Rubbish_Pit')\n    ),\n    field(\n      'Kitchen_Garden__c',\n      dataValue('$.form.Household_Information.Kitchen_Garden')\n    ),\n    field(\n      'Cookstove__c',\n      dataValue('$.form.Household_Information.Improved_Cooking_Method')\n    ),\n    field('Uses_ITNs__c', dataValue('$.form.Household_Information.ITNs')),\n    field(\n      'Pit_Latrine__c',\n      dataValue('$.form.Household_Information.Functional_Latrine')\n    ),\n    field('Clothe__c', dataValue('$.form.Household_Information.Clothesline')),\n    field(\n      'Drying_Rack__c',\n      dataValue('$.form.Household_Information.Drying_Rack')\n    ),\n    field(\n      'Tippy_Tap__c',\n      dataValue('$.form.Household_Information.Active_Handwashing_Station')\n    ),\n    field(\n      'Number_of_Over_5_Females__c',\n      dataValue('$.form.Household_Information.Number_of_over_5_Females')\n    ),\n    field(\n      'Number_of_Under_5_Males__c',\n      dataValue('$.form.Household_Information.Number_of_Under_5_Males')\n    ),\n    field(\n      'Number_of_Under_5_Females__c',\n      dataValue('$.form.Household_Information.Number_of_Under_5_Females')\n    ),\n    field(\n      'Number_of_Over_5_Males__c',\n      dataValue('$.form.Household_Information.Number_of_Over_5_Males')\n    ),\n    field('Source__c', true)\n  )\n);\n\nalterState(state => {\n  if (dataValue('$.form.Person[0].Source')(state) == 1) {\n    return beta.each(\n      dataPath('$.form.Person[*]'),\n      upsert(\n        'Person__c',\n        'CommCare_ID__c',\n        fields(\n          field('Name', state => {\n            var name1 = dataValue('Basic_Information.Person_Name')(state);\n            var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n              return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n            });\n            return name2;\n          }),\n          relationship('RecordType', 'Name', state => {\n            return dataValue('Basic_Information.Record_Type')(state)\n              .toString()\n              .replace(/_/g, ' ');\n          }),\n          field('Catchment__c', state => {\n            if (dataValue('catchment')(state) == 'East Kamagambo') {\n              return 'a002400000pAcQt';\n            } else {\n              return 'a002400000pAcOe';\n            }\n          }),\n          field('HAWI_Registrant__c', state => {\n            if (dataValue('Basic_Information.HAWI_Status')(state) == 'Yes') {\n              return 'Yes';\n            }\n          }),\n          field('Active_in_HAWI__c', state => {\n            if (dataValue('Basic_Information.HAWI_Status')(state) == 'Yes') {\n              return 'Yes';\n            }\n          }),\n          field('Active_in_Thrive_Thru_5__c', state => {\n            if (\n              dataValue('Basic_Information.Record_Type')(state)\n                .toString()\n                .replace(/_/g, ' ') == 'Child' &&\n              dataValue('Basic_Information.TT5_Status')(state) == 'Yes'\n            ) {\n              return 'Yes';\n            }\n          }),\n          field('Thrive_Thru_5_Registrant__c', state => {\n            if (\n              dataValue('Basic_Information.Record_Type')(state)\n                .toString()\n                .replace(/_/g, ' ') == 'Child' &&\n              dataValue('Basic_Information.TT5_Status')(state) == 'Yes'\n            ) {\n              return 'Yes';\n            }\n          }),\n          field('Active_TT5_Mother__c', state => {\n            if (\n              dataValue('Basic_Information.Record_Type')(state)\n                .toString()\n                .replace(/_/g, ' ') == 'Female Adult' &&\n              dataValue('Basic_Information.TT5_Status')(state) == 'Yes'\n            ) {\n              return 'Yes';\n            }\n          }),\n          field('TT5_Mother_Registrant__c', state => {\n            if (\n              dataValue('Basic_Information.Record_Type')(state)\n                .toString()\n                .replace(/_/g, ' ') == 'Female Adult' &&\n              dataValue('Basic_Information.TT5_Status')(state) == 'Yes'\n            ) {\n              return 'Yes';\n            }\n          }),\n          field('Enrollment_Date__c', state => {\n            if (dataValue('Basic_Information.TT5_Status')(state) == 'Yes') {\n              return dataValue('case.@date_modified')(state);\n            }\n          }),\n          field('HAWI_Enrollment_Date__c', state => {\n            if (dataValue('Basic_Information.HAWI_Status')(state) == 'Yes') {\n              return dataValue('case.@date_modified')(state);\n            }\n          }),\n          field('LMP__c', dataValue('TT5.Child_Information.ANCs.LMP')),\n          field('Source__c', true),\n          field('CommCare_ID__c', dataValue('case.@case_id')),\n          field('Date_of_Birth__c', dataValue('Basic_Information.DOB')),\n          field(\n            'Exclusive_Breastfeeding__c',\n            dataValue(\n              'TT5.Child_Information.Exclusive_Breastfeeding.Exclusive_Breastfeeding'\n            )\n          ),\n          field('Gender__c', dataValue('Basic_Information.Final_Gender')),\n          field(\n            'Marital_Status__c',\n            dataValue('Basic_Information.Marital_Status')\n          ),\n          field(\n            'Telephone__c',\n            dataValue('Basic_Information.Contact_Info.contact_phone_number')\n          ),\n          field(\n            'Next_of_Kin__c',\n            dataValue('Basic_Information.Contact_Info.Next_of_Kin')\n          ),\n          field(\n            'Next_of_Kin_Phone__c',\n            dataValue('Basic_Information.Contact_Info.next_of_kin_phone')\n          ),\n          field('Client_Status__c', 'Active'),\n          field(\n            'Ever_on_Family_Planning__c',\n            dataValue('Basic_Information.Ever_on_Family_Planning')\n          ),\n          field(\n            'Family_Planning__c',\n            dataValue('Basic_Information.Currently_on_family_planning')\n          ),\n          field(\n            'Family_Planning_Method__c',\n            dataValue('Basic_Information.Family_Planning_Method')\n          ),\n          field('ANC_1__c', dataValue('TT5.Child_Information.ANCs.ANC_1')),\n          field('ANC_2__c', dataValue('TT5.Child_Information.ANCs.ANC_2')),\n          field('ANC_3__c', dataValue('TT5.Child_Information.ANCs.ANC_3')),\n          field('ANC_4__c', dataValue('TT5.Child_Information.ANCs.ANC_4')),\n          field('ANC_5__c', dataValue('TT5.Child_Information.ANCs.ANC_5')),\n          field('BCG__c', dataValue('TT5.Child_Information.Immunizations.BCG')),\n          field(\n            'OPV_0__c',\n            dataValue('TT5.Child_Information.Immunizations.OPV_0')\n          ),\n          field(\n            'OPV_1__c',\n            dataValue('TT5.Child_Information.Immunizations.OPV_PCV_Penta_1')\n          ),\n          field(\n            'OPV_2__c',\n            dataValue('TT5.Child_Information.Immunizations.OPV_PCV_Penta_2')\n          ),\n          field(\n            'OPV_3__c',\n            dataValue('TT5.Child_Information.Immunizations.OPV_PCV_Penta_3')\n          ),\n          field(\n            'Measles_6__c',\n            dataValue('TT5.Child_Information.Immunizations.Measles_6')\n          ),\n          field(\n            'Measles_9__c',\n            dataValue('TT5.Child_Information.Immunizations.Measles_9')\n          ),\n          field(\n            'Measles_18__c',\n            dataValue('TT5.Child_Information.Immunizations.Measles_18')\n          ),\n          field('Pregnant__c', state => {\n            if (dataValue('TT5.Mother_Information.Pregnant')(state) == 'Yes')\n              return 1;\n          }),\n          field('Education_Level__c', state => {\n            if (\n              dataValue('Basic_Information.Record_Type')(state) !== 'Child' &&\n              dataValue('Basic_Information.Record_Type')(state) !== 'Youth'\n            ) {\n              return dataValue('Basic_Information.Education_Level')(state)\n                .toString()\n                .replace(/_/g, ' ');\n            }\n          }),\n          field(\n            'Gravida__c',\n            dataValue('TT5.Mother_Information.Pregnancy_Information.Gravida')\n          ),\n          field(\n            'Parity__c',\n            dataValue('TT5.Mother_Information.Pregnancy_Information.Parity')\n          ),\n          field(\n            'Unique_Patient_Code__c',\n            dataValue('HAWI.Unique_Patient_Code')\n          ),\n          field(\n            'Active_in_Support_Group__c',\n            dataValue('HAWI.Active_in_Support_Group')\n          ),\n\n          field('Currently_on_ART_s__c', dataValue('HAWI.ART')),\n          field('ART_Regimen__c', state => {\n            var art = '';\n            var str = dataValue('HAWI.ARVs')(state);\n            if (str !== undefined) {\n              art = str.replace(/ /g, '; ');\n            }\n            return art;\n          }),\n          field('Preferred_Care_Facility__c', state => {\n            var val = '';\n            if (\n              dataValue('HAWI.Preferred_Care_Facility')(state) !== undefined\n            ) {\n              val = dataValue('HAWI.Preferred_Care_Facility')(state)\n                .toString()\n                .replace(/_/g, ' ');\n            }\n            return val;\n          }),\n          field('CommCare_HH_Code__c', dataValue('case.index.parent.#text')),\n          field('Child_Status__c', dataValue('Basic_Information.Child_Status')),\n          field('Place_of_Delivery__c', state => {\n            var val = '';\n            var placeholder = '';\n            if (\n              dataValue(\n                'TT5.Child_Information.Delivery_Information.Skilled_Unskilled'\n              )(state) !== undefined\n            ) {\n              placeholder = dataValue(\n                'TT5.Child_Information.Delivery_Information.Skilled_Unskilled'\n              )(state);\n              if (placeholder == 'Skilled') {\n                val = 'Facility';\n              } else if (placeholder == 'Unskilled') {\n                val = 'Home';\n              }\n            }\n            return val;\n          }),\n          field('Delivery_Facility__c', state => {\n            var val = '';\n            var placeholder = '';\n            if (\n              dataValue(\n                'TT5.Child_Information.Delivery_Information.Birth_Facility'\n              )(state) !== undefined\n            ) {\n              placeholder = dataValue(\n                'TT5.Child_Information.Delivery_Information.Birth_Facility'\n              )(state);\n              val = placeholder.toString().replace(/_/g, ' ');\n            }\n            return val;\n          })\n        )\n      )\n    )(state);\n  }\n\n  return state;\n});\n\n")))}s.isMDXComponent=!0},331:function(e,n,a){"use strict";a.d(n,"a",(function(){return u})),a.d(n,"b",(function(){return m}));var t=a(0),r=a.n(t);function i(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){i(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function _(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=r.a.createContext({}),s=function(e){var n=r.a.useContext(d),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},u=function(e){var n=s(e.components);return r.a.createElement(d.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},f=r.a.forwardRef((function(e,n){var a=e.components,t=e.mdxType,i=e.originalType,o=e.parentName,d=_(e,["components","mdxType","originalType","parentName"]),u=s(a),f=t,m=u["".concat(o,".").concat(f)]||u[f]||c[f]||i;return a?r.a.createElement(m,l(l({ref:n},d),{},{components:a})):r.a.createElement(m,l({ref:n},d))}));function m(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var i=a.length,o=new Array(i);o[0]=f;var l={};for(var _ in n)hasOwnProperty.call(n,_)&&(l[_]=n[_]);l.originalType=e,l.mdxType="string"==typeof e?e:t,o[1]=l;for(var d=2;d<i;d++)o[d]=a[d];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}f.displayName="MDXCreateElement"}}]);