(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{290:function(e,n,a){"use strict";a.r(n),a.d(n,"frontMatter",(function(){return _})),a.d(n,"metadata",(function(){return o})),a.d(n,"toc",(function(){return l})),a.d(n,"default",(function(){return s}));var t=a(3),i=a(8),r=(a(0),a(336)),_={title:"Update Person in SF (Production) with salesforce",sidebar_label:"Update Person in SF (Production)",id:"Update Person in SF Production-2017-05-15",keywords:["library","job","expression","salesforce","alterState","dataPath","dataValue","each","field","fields","upsert"]},o={unversionedId:"jobs/auto/Update Person in SF Production-2017-05-15",id:"jobs/auto/Update Person in SF Production-2017-05-15",isDocsHomePage:!1,title:"Update Person in SF (Production) with salesforce",description:"This job was provided by an OpenFn.org user via the job library API.",source:"@site/library/jobs/auto/Update Person in SF Production-2017-05-15.md",sourceDirName:"jobs/auto",slug:"/jobs/auto/Update Person in SF Production-2017-05-15",permalink:"/library/jobs/auto/Update Person in SF Production-2017-05-15",version:"current",sidebar_label:"Update Person in SF (Production)",frontMatter:{title:"Update Person in SF (Production) with salesforce",sidebar_label:"Update Person in SF (Production)",id:"Update Person in SF Production-2017-05-15",keywords:["library","job","expression","salesforce","alterState","dataPath","dataValue","each","field","fields","upsert"]},sidebar:"library",previous:{title:"Update Household in SF (Sandbox) with salesforce",permalink:"/library/jobs/auto/Update Household in SF Sandbox-2016-12-01"},next:{title:"Update Person in SF (Sandbox) with salesforce",permalink:"/library/jobs/auto/Update Person in SF Sandbox-2017-01-06"}},l=[{value:"Metadata",id:"metadata",children:[]},{value:"Key Functions",id:"key-functions",children:[]},{value:"Expression",id:"expression",children:[]}],d={toc:l};function s(e){var n=e.components,a=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(t.a)({},d,a,{components:n,mdxType:"MDXLayout"}),Object(r.b)("em",null,"This job was provided by an OpenFn.org user via the job library API."),Object(r.b)("h2",{id:"metadata"},"Metadata"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Name: Update Person in SF (Production)"),Object(r.b)("li",{parentName:"ul"},"Adaptor: ",Object(r.b)("inlineCode",{parentName:"li"},"@openfn/language-salesforce")),Object(r.b)("li",{parentName:"ul"},"Adaptor Version: ",Object(r.b)("inlineCode",{parentName:"li"},"v1.3.2")),Object(r.b)("li",{parentName:"ul"},"Created almost 4 years ago"),Object(r.b)("li",{parentName:"ul"},"Updated 5 months ago")),Object(r.b)("h2",{id:"key-functions"},"Key Functions"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"alterState"),", ",Object(r.b)("inlineCode",{parentName:"p"},"dataPath"),", ",Object(r.b)("inlineCode",{parentName:"p"},"dataValue"),", ",Object(r.b)("inlineCode",{parentName:"p"},"each"),", ",Object(r.b)("inlineCode",{parentName:"p"},"field"),", ",Object(r.b)("inlineCode",{parentName:"p"},"fields"),", ",Object(r.b)("inlineCode",{parentName:"p"},"upsert")),Object(r.b)("h2",{id:"expression"},"Expression"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},"alterState(state => {\n  //Alters CommCare arrays so that they are formatted as arrays instead of just single values.\n  if (\n    dataValue('$.form.TT5.Child_Information.Clinical_Services')(state) !==\n    undefined\n  ) {\n    const clinical = state.data.form.TT5.Child_Information.Clinical_Services;\n    if (!Array.isArray(clinical)) {\n      state.data.form.TT5.Child_Information.Clinical_Services = [clinical];\n    }\n  }\n\n  if (\n    dataValue('$.form.HAWI.Clinical_Services_Rendered')(state) !== undefined\n  ) {\n    const clinical1 = state.data.form.HAWI.Clinical_Services_Rendered;\n    if (!Array.isArray(clinical1)) {\n      state.data.form.HAWI.Clinical_Services_Rendered = [clinical1];\n    }\n  }\n\n  const supervisorMap = {\n    community_health_nurse: 'Community Health Nurse',\n    chw_supervisor: 'CHW Supervisor',\n    chewschas: 'CHEWs/CHAs',\n    other: 'Other',\n    none: 'None',\n  };\n\n  return { ...state, supervisorMap };\n});\n\n//Deliveries\n\nalterState(state => {\n  if (\n    dataValue('$.form.Status.Client_Status')(state) == 'Active' &&\n    state.data.form.TT5\n  ) {\n    //Deliveries\n    if (\n      dataValue('$.form.TT5.Child_Information.Delivery_Information.Delivery')(\n        state\n      ) == 'Yes'\n    ) {\n      //Unskilled delivery: upsert person with delivery information, but no service provided\n      if (\n        dataValue(\n          '$.form.TT5.Child_Information.Delivery_Information.Delivery_Type'\n        )(state) == 'Unskilled'\n      ) {\n        return upsert(\n          'Person__c',\n          'CommCare_ID__c',\n          fields(\n            field('Source__c', 1),\n            field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n            field('Name', state => {\n              var name1 = dataValue('$.form.final_name')(state);\n              var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n                return (\n                  txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()\n                );\n              });\n              return name2;\n            }),\n            field('Place_of_Delivery__c', 'Home'),\n            field(\n              'Date_of_Birth__c',\n              dataValue('$.form.TT5.Child_Information.Delivery_Information.DOB')\n            ),\n            field(\n              'Child_Status__c',\n              dataValue('form.case.update.Child_Status')\n            ),\n            field('Immediate_Breastfeeding__c', state => {\n              var var1 = dataValue(\n                'form.TT5.Child_Information.Delivery_Information.Breastfeeding_Delivery'\n              )(state);\n              if (var1 == '---') {\n                var1 = undefined;\n              } else if (var1 == 'yes') {\n                var1 = 'Yes';\n              }\n              return var1;\n            }),\n            field(\n              'Counselled_on_Exclusive_Breastfeeding__c',\n              dataValue(\n                '$.form.TT5.Child_Information.Exclusive_Breastfeeding.counseling'\n              )\n            ),\n            field(\n              'Telephone__c',\n              dataValue('form.case.update.contact_phone_number')\n            ),\n            field(\n              'Exclusive_Breastfeeding__c',\n              dataValue(\n                'form.TT5.Child_Information.Exclusive_Breastfeeding.Exclusive_Breastfeeding'\n              )\n            )\n          )\n        )(state);\n      } else {\n        //Skilled delivery: service provided, and upsert remaining information for person\n        //update: no longer providing service because of Salesforce lock row issue, person upsert here will now run parallel to person upesert for\n        //unskilled delivery\n        return upsert(\n          'Person__c',\n          'CommCare_ID__c',\n          fields(\n            field('Source__c', 1),\n            field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n            field('Name', state => {\n              var name1 = dataValue('$.form.final_name')(state);\n              var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n                return (\n                  txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()\n                );\n              });\n              return name2;\n            }),\n            field('Place_of_Delivery__c', 'Facility'),\n            field('Delivery_Facility__c', state => {\n              return dataValue(\n                '$.form.TT5.Child_Information.Delivery_Information.Delivery_Facility'\n              )(state)\n                .toString()\n                .replace(/_/g, ' ');\n            }),\n            field(\n              'Date_of_Birth__c',\n              dataValue('$.form.TT5.Child_Information.Delivery_Information.DOB')\n            ),\n            field(\n              'Child_Status__c',\n              dataValue('form.case.update.Child_Status')\n            ),\n            field('Immediate_Breastfeeding__c', state => {\n              var var1 = dataValue(\n                'form.TT5.Child_Information.Delivery_Information.Breastfeeding_Delivery'\n              )(state);\n              if (var1 == '---') {\n                var1 = undefined;\n              } else if (var1 == 'yes') {\n                var1 = 'Yes';\n              }\n              return var1;\n            }),\n            field(\n              'Counselled_on_Exclusive_Breastfeeding__c',\n              dataValue(\n                '$.form.TT5.Child_Information.Exclusive_Breastfeeding.counseling'\n              )\n            ),\n            field(\n              'Exclusive_Breastfeeding__c',\n              dataValue(\n                'form.TT5.Child_Information.Exclusive_Breastfeeding.Exclusive_Breastfeeding'\n              )\n            )\n          )\n        )(state);\n      }\n    }\n  }\n  //Transfer Outs\n  else if (\n    dataValue('$.form.Status.Client_Status')(state) == 'Transferred_Out'\n  ) {\n    return upsert(\n      'Person__c',\n      'CommCare_ID__c',\n      fields(\n        field('Source__c', 1),\n        field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n        field('Client_Status__c', 'Transferred Out'),\n        field('Active_in_Thrive_Thru_5__c', 'No'),\n        field('Inactive_Date__c', dataValue('$.form.Date')),\n        field('Active_in_HAWI__c', 'No'),\n        field('Active_TT5_Mother__c', 'No'),\n        field(\n          'Date_of_Transfer_Out__c',\n          dataValue('$.form.Status.Date_of_Transfer_Out')\n        )\n      )\n    )(state);\n  }\n  //Lost to Follow Up\n  else if (\n    dataValue('$.form.Status.Client_Status')(state) == 'Lost_to_Follow_Up'\n  ) {\n    return upsert(\n      'Person__c',\n      'CommCare_ID__c',\n      fields(\n        field('Source__c', 1),\n        field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n        field('Client_Status__c', 'Lost to Follow-Up'),\n        field('Active_in_Thrive_Thru_5__c', 'No'),\n        field('Active_in_HAWI__c', 'No'),\n        field('Active_TT5_Mother__c', 'No'),\n        field('Date_Last_Seen__c', dataValue('$.form.Status.Date_Last_Seen')),\n        field('Inactive_Date__c', dataValue('$.form.Date'))\n      )\n    )(state);\n  }\n  //Graduated from Thrive Thru 5\n  else if (\n    dataValue('$.form.Status.Client_Status')(state) == 'Graduated_From_TT5'\n  ) {\n    return upsert(\n      'Person__c',\n      'CommCare_ID__c',\n      fields(\n        field('Source__c', 1),\n        field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n        field('Client_Status__c', 'Graduated From TT5'),\n        field('Active_in_Thrive_Thru_5__c', 'No'),\n        field('Active_in_HAWI__c', 'No'),\n        field('Active_TT5_Mother__c', 'No'),\n        field('Date_Last_Seen__c', dataValue('$.form.Status.Date_Last_Seen')),\n        field('Inactive_Date__c', dataValue('$.form.Date'))\n      )\n    )(state);\n  }\n  //Data entry error\n  else if (\n    dataValue('$.form.Status.Client_Status')(state) == 'Data_Entry_Error'\n  ) {\n    return upsert(\n      'Person__c',\n      'CommCare_ID__c',\n      fields(\n        field('Source__c', 1),\n        field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n        field('Client_Status__c', 'Data Entry Error'),\n        field('Active_in_Thrive_Thru_5__c', 'No'),\n        field('Active_TT5_Mother__c', 'No'),\n        field('Active_in_HAWI__c', 'No'),\n        field('Inactive_Date__c', dataValue('$.form.Date'))\n      )\n    )(state);\n  }\n  //client deceased\n  else if (dataValue('$.form.Status.Client_Status')(state) == 'Deceased') {\n    return upsert(\n      'Person__c',\n      'CommCare_ID__c',\n      fields(\n        field('Source__c', 1),\n        field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n        field('Client_Status__c', 'Deceased'),\n        field('Active_in_Thrive_Thru_5__c', 'No'),\n        field('Active_in_HAWI__c', 'No'),\n        field('Active_TT5_Mother__c', 'No'),\n        field('Date_of_Death__c', dataValue('$.form.Status.Date_of_Death')),\n        field('Cause_of_Death__c', state => {\n          return dataValue('$.form.Status.Cause_of_Death')(state)\n            .toString()\n            .replace(/_/g, ' ');\n        }),\n        field('Inactive_Date__c', dataValue('$.form.Date'))\n      )\n    )(state);\n  }\n  return state;\n});\n\n//Need to update CHWs\nalterState(state => {\n  //Person is added to TT5 (this can only happen to a mother, a child wouldn't be in HAWI before joining TT5)\n  if (\n    dataValue('$.form.Basic_Information.Basic_Information.Add_to_TT5')(state) ==\n    'Yes'\n  ) {\n    return upsert(\n      'Person__c',\n      'CommCare_ID__c',\n      fields(\n        field('Source__c', 1),\n        field('Name', state => {\n          var name1 = dataValue('$.form.final_name')(state);\n          var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n          });\n          return name2;\n        }),\n        field('Active_TT5_Mother__c', 'Yes'),\n        field('TT5_Mother_Registrant__c', 'Yes'),\n        field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n        field(\n          'Active_in_Support_Group__c',\n          dataValue('$.form.HAWI.Support_Group')\n        ),\n        field(\n          'Preferred_Care_Facility__c',\n          dataValue('$.form.HAWI.Preferred_Care_F.Preferred_Care_Facility')\n        )\n      )\n    )(state);\n  } else {\n    //Person is added to HAWI\n    if (\n      dataValue('$.form.Basic_Information.Basic_Information.Add_to_HAWI')(\n        state\n      ) == 'Yes'\n    ) {\n      return upsert(\n        'Person__c',\n        'CommCare_ID__c',\n        fields(\n          field('Source__c', 1),\n          field('Name', state => {\n            var name1 = dataValue('$.form.final_name')(state);\n            var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n              return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n            });\n            return name2;\n          }),\n          field('Active_in_HAWI__c', 'Yes'),\n          field('HAWI_Registrant__c', 'Yes'),\n          field('HAWI_Enrollment_Date__c', dataValue('metadata.timeEnd')),\n          field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n          field(\n            'Active_in_Support_Group__c',\n            dataValue('$.form.HAWI.Support_Group')\n          ),\n          field(\n            'Preferred_Care_Facility__c',\n            dataValue('$.form.HAWI.Preferred_Care_F.Preferred_Care_Facility')\n          ),\n          field('Immediate_Breastfeeding__c', state => {\n            var var1 = state.data.formTT5\n              ? dataValue(\n                  'form.TT5.Child_Information.Delivery_Information.Breastfeeding_Delivery'\n                )(state)\n              : null;\n            if (var1 == '---') {\n              var1 = undefined;\n            } else if (var1 == 'yes') {\n              var1 = 'Yes';\n            }\n            return var1;\n          }),\n          field(\n            'Exclusive_Breastfeeding__c',\n            state.data.form.TT5\n              ? dataValue(\n                  'form.TT5.Child_Information.Exclusive_Breastfeeding.Exclusive_Breastfeeding'\n                )\n              : null\n          )\n        )\n      )(state);\n    } else {\n      if (\n        dataValue('form.@xmlns')(state) !=\n        'http://openrosa.org/formdesigner/60AF0A3E-A8A1-425B-B86B-35E0C65C8BC4'\n      ) {\n        return upsert(\n          'Person__c',\n          'CommCare_ID__c',\n          fields(\n            field('Name', state => {\n              var name1 = dataValue('$.form.final_name')(state);\n              var name2 = name1.replace(/\\w\\S*/g, function (txt) {\n                return (\n                  txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()\n                );\n              });\n              return name2;\n            }),\n            field('Source__c', 1),\n            field('CommCare_ID__c', dataValue('$.form.case.@case_id')),\n            field(\n              'Active_in_Support_Group__c',\n              dataValue('$.form.HAWI.Support_Group')\n            ),\n            field(\n              'Preferred_Care_Facility__c',\n              dataValue('$.form.HAWI.Preferred_Care_F.Preferred_Care_Facility')\n            ),\n            field('Immediate_Breastfeeding__c', state => {\n              var var1 = state.data.form.TT5\n                ? dataValue(\n                    'form.TT5.Child_Information.Delivery_Information.Breastfeeding_Delivery'\n                  )(state)\n                : null;\n              if (var1 == '---') {\n                var1 = undefined;\n              } else if (var1 == 'yes') {\n                var1 = 'Yes';\n              }\n              return var1;\n            }),\n            field(\n              'Exclusive_Breastfeeding__c',\n              state.data.form.TT5\n                ? dataValue(\n                    'form.TT5.Child_Information.Exclusive_Breastfeeding.Exclusive_Breastfeeding'\n                  )\n                : null\n            )\n          )\n        )(state);\n      }\n    }\n  }\n  return state;\n});\n\n//** ANC Services ************************************************//\n//ANC1\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.ANCs.ANC_1')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.TT5.Child_Information.ANCs.ANC_1')(\n            state\n          );\n          return id + date + 'ANC1';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'ANC 1'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('Date__c', dataValue('$.form.TT5.Child_Information.ANCs.ANC_1')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.ANCs.Facility1'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//ANC2\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.ANCs.ANC_2')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.TT5.Child_Information.ANCs.ANC_2')(\n            state\n          );\n          return id + date + 'ANC2';\n        }),\n        field('Source__c', 1),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('Reason_for_Service__c', 'ANC 2'),\n        field('Date__c', dataValue('$.form.TT5.Child_Information.ANCs.ANC_2')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.ANCs.Facility2'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n\n  return state;\n});\n\n//ANC3\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.ANCs.ANC_3')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.TT5.Child_Information.ANCs.ANC_3')(\n            state\n          );\n          return id + date + 'ANC3';\n        }),\n        field('Source__c', true),\n        field('Reason_for_Service__c', 'ANC 3'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('Date__c', dataValue('$.form.TT5.Child_Information.ANCs.ANC_3')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.ANCs.Facility3'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//ANC4\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.ANCs.ANC_4')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.TT5.Child_Information.ANCs.ANC_4')(\n            state\n          );\n          return id + date + 'ANC4';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'ANC 4'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('Date__c', dataValue('$.form.TT5.Child_Information.ANCs.ANC_4')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.ANCs.Facility4'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//ANC5\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.ANCs.ANC_5')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.TT5.Child_Information.ANCs.ANC_5')(\n            state\n          );\n          return id + date + 'ANC5';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'ANC 5'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('Date__c', dataValue('$.form.TT5.Child_Information.ANCs.ANC_5')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.ANCs.Facility5'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//** END ANC ************************************************//\n//** Immunization Services ************************************************//\n//BCG REVIEWED\nalterState(state => {\n  // const { TT5 } = state.data.form;\n  // const { Immunizations } = TT5 ? TT5.Child_Information : '';\n  // if (Immunizations && Immunizations.BCG_h) {\n  if (dataValue('form.TT5.Child_Information.Immunizations.BCG_h')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.BCG'\n          )(state);\n          return id + date + 'BCG';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'BCG'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field(\n          'Date__c',\n          dataValue('$.form.TT5.Child_Information.Immunizations.BCG_h')\n        ),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Facility_BCG'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//OPV0 REVIEWED\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.Immunizations.OPV0_h')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.OPV0_h'\n          )(state);\n          return id + date + 'OPV0';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'OPV0'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field(\n          'Date__c',\n          dataValue('$.form.TT5.Child_Information.Immunizations.OPV_0')\n        ),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Facility_OPV_0'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//OPV1 REVIEWED\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.Immunizations.OPV1_h')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.OPV1_h'\n          )(state);\n          return id + date + 'OPV1';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'OPV1'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field(\n          'Date__c',\n          dataValue('$.form.TT5.Child_Information.Immunizations.OPV1_h')\n        ),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Facility_OPV_1'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//OPV2\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.Immunizations.OPV2_h')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Source__c', 1),\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.OPV2_h'\n          )(state);\n          return id + date + 'OPV2';\n        }),\n        field('Reason_for_Service__c', 'OPV2'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field(\n          'Date__c',\n          dataValue('$.form.TT5.Child_Information.Immunizations.OPV2_h')\n        ),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Facility_OPV_2'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//OPV3\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.Immunizations.OPV3_h')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Source__c', 1),\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.OPV3_h'\n          )(state);\n          return id + date + 'OPV3';\n        }),\n        field('Reason_for_Service__c', 'OPV3'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field(\n          'Date__c',\n          dataValue('$.form.TT5.Child_Information.Immunizations.OPV3_h')\n        ),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Facility_OPV_3'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//Measles 6\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.Immunizations.Measles6_h')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Measles6_h'\n          )(state);\n          return id + date + 'Measles6';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'Measles 6'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field(\n          'Date__c',\n          dataValue('$.form.TT5.Child_Information.Immunizations.Measles6_h')\n        ),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Facility_Measles_6'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//Measles 9\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.Immunizations.Measles9_h')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Measles9_h'\n          )(state);\n          return id + date + 'Measles9';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'Measles 9'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field(\n          'Date__c',\n          dataValue('$.form.TT5.Child_Information.Immunizations.Measles9_h')\n        ),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Facility_Measles_9'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//Measles 18\nalterState(state => {\n  if (dataValue('form.TT5.Child_Information.Immunizations.Measles18_h')(state)) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Measles18_h'\n          )(state);\n          return id + date + 'Measles18';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'Measles 18'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field(\n          'Date__c',\n          dataValue('$.form.TT5.Child_Information.Immunizations.Measles18_h')\n        ),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        relationship('Site__r', 'Label__c', state => {\n          var facility = dataValue(\n            '$.form.TT5.Child_Information.Immunizations.Facility_Measles_18'\n          )(state);\n          if (facility === '' || facility === undefined) {\n            facility = 'unknown';\n          }\n          return facility;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//** END IMMUNIZATIONS ************************************************//\n//Deworming\nalterState(state => {\n  if (dataValue('$.form.TT5.Child_Information.Deworming')(state) == 'Yes') {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.Date')(state);\n          return id + date + 'Deworming';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'Deworming'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('Date__c', dataValue('$.form.Date')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        )\n      )\n    )(state);\n  }\n  return state;\n});\n\n//Home Based care for HAWI clients\nalterState(state => {\n  if (\n    dataValue('$.form.HAWI.Home_Based_Care.Home_Based_Care_Provided')(state) !==\n      undefined &&\n    dataValue('$.form.HAWI.Home_Based_Care.Home_Based_Care_Provided')(state) !==\n      ''\n  ) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.Date')(state);\n          return id + date + 'Home-Based-Care';\n        }),\n        field('Source__c', 1),\n        field('Reason_for_Service__c', 'Home-Based Care'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('Date__c', dataValue('$.form.Date')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('RecordTypeID', '01224000000YAuK'),\n        field('Home_Based_Care_Rendered__c', state => {\n          var care = '';\n          var str = dataValue(\n            '$.form.HAWI.Home_Based_Care.Home_Based_Care_Provided'\n          )(state);\n          care = str.replace(/ /g, ';');\n          care = care.replace(/_/g, ' ');\n\n          return care;\n        }),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        )\n      )\n    )(state);\n  }\n  return state;\n});\n\n//Malaria cases\n//Child\nalterState(state => {\n  if (\n    dataValue('$.form.TT5.Child_Information.CCMM.Home_Test_Result')(state) ==\n    'Positive'\n  ) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.Date')(state);\n          return id + date + 'Malaria-Home-Treatment';\n        }),\n        field('Source__c', 1),\n        field('Date__c', dataValue('$.form.Date')),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('Reason_for_Service__c', 'Malaria (Home Treatment)'),\n        field(\n          'Home_Treatment__c',\n          dataValue('$.form.TT5.Child_Information.CCMM.Home_Treatment')\n        ),\n        field('RecordTypeID', '01224000000kOto'),\n        field('Open_Case__c', 1),\n        field('Malaria_Status__c', 'Positive'),\n        field(\n          'AL_Tablets__c',\n          dataValue('$.form.TT5.Child_Information.CCMM.AL')\n        ),\n        field(\n          'Paracetamol_Tablets__c',\n          dataValue('$.form.TT5.Child_Information.CCMM.Paracetamol')\n        ),\n        field('Follow_Up_By_Date__c', dataValue('$.form.Follow-Up_By_Date')),\n        field(\n          'Home_Treatment_Date__c',\n          dataValue('$.form.TT5.Child_Information.CCMM.test_date')\n        ),\n        field(\n          'Malaria_Home_Test_Date__c',\n          dataValue('$.form.TT5.Child_Information.CCMM.test_date')\n        ),\n        field('CommCare_Code__c', dataValue('form.subcase_0.case.@case_id')),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        )\n      )\n    )(state);\n  }\n  return state;\n});\n\n//Malaria cases\n//HAWI Client\nalterState(state => {\n  if (dataValue('$.form.HAWI.CCMM.Home_Test_Result')(state) == 'Positive') {\n    //Malaria home treatment case\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Source__c', 1),\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.Date')(state);\n          return id + date + 'Malaria-Home-Treatment';\n        }),\n        field('Date__c', dataValue('$.form.Date')),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('Reason_for_Service__c', 'Malaria (Home Treatment)'),\n        field(\n          'Home_Treatment__c',\n          dataValue('$.form.HAWI.CCMM.Home_Treatment')\n        ),\n        field('RecordTypeID', '01224000000kOto'),\n        field('Open_Case__c', 1),\n        field('Malaria_Status__c', 'Positive'),\n        field('AL_Tablets__c', dataValue('$.form.HAWI.CCMM.AL')),\n        field(\n          'Paracetamol_Tablets__c',\n          dataValue('$.form.HAWI.CCMM.Paracetamol')\n        ),\n        field('Follow_Up_By_Date__c', dataValue('$.form.Follow-Up_By_Date')),\n        field(\n          'Home_Treatment_Date__c',\n          dataValue('$.form.HAWI.CCMM.test_date')\n        ),\n        field(\n          'Malaria_Home_Test_Date__c',\n          dataValue('$.form.HAWI.CCMM.test_date')\n        ),\n        field('CommCare_Code__c', dataValue('form.subcase_0.case.@case_id')),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        )\n      )\n    )(state);\n  }\n  return state;\n});\n\n//Malnutrition case\nalterState(state => {\n  if (\n    dataValue('$.form.TT5.Child_Information.Nutrition2.Nutrition_Status')(state)\n  ) {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Source__c', 1),\n        field('Service_UID__c', state => {\n          const id = dataValue('$.form.case.@case_id')(state);\n          const date = dataValue('$.form.Date')(state);\n          return id + date + 'Nutrition-Screening';\n        }),\n        field('Date__c', dataValue('$.form.Date')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('RecordTypeID', '01224000000YAuK'),\n        field('Reason_for_Service__c', 'Nutrition Screening'),\n        field(\n          'Clinical_Visit_Date__c',\n          dataValue('$.form.TT5.Child_Information.Nutrition2.Clinical_Date')\n        ),\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        ),\n        field(\n          'Height__c',\n          dataValue('$.form.TT5.Child_Information.Nutrition.Height')\n        ),\n        field(\n          'Weight__c',\n          dataValue('$.form.TT5.Child_Information.Nutrition.Weight')\n        ),\n        field(\n          'MUAC__c',\n          dataValue('$.form.TT5.Child_Information.Nutrition.MUAC')\n        ),\n        field('Nutrition_Status__c', state => {\n          var status = '';\n          if (\n            dataValue(\n              '$.form.TT5.Child_Information.Nutrition2.Nutrition_Status'\n            )(state) == 'normal'\n          ) {\n            status = 'Normal';\n          } else if (\n            dataValue(\n              '$.form.TT5.Child_Information.Nutrition2.Nutrition_Status'\n            )(state) == 'moderate'\n          ) {\n            status = 'Moderately Malnourished';\n          } else if (\n            dataValue(\n              '$.form.TT5.Child_Information.Nutrition2.Nutrition_Status'\n            )(state) == 'severe'\n          ) {\n            status = 'Severely Malnourished';\n          }\n          return status;\n        })\n      )\n    )(state);\n  }\n  return state;\n});\n\n//All referrals are sent here (danger sign, malaria, malnutrition, other referral)\nalterState(state => {\n  if (dataValue('$.form.Referral')(state) == 'Yes') {\n    return upsert(\n      'Service__c',\n      'Service_UID__c',\n      fields(\n        field('Source__c', 1),\n        field('Service_UID__c', state => {\n          var id = dataValue('$.form.case.@case_id')(state);state.data.id;\n          var date = dataValue('$.form.Date')(state);\n          return id + date + 'Referral';\n        }),\n        field('Date__c', dataValue('$.form.Date')),\n        field('Type_of_Service__c', 'CHW Mobile Survey'),\n        field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n        field('RecordTypeID', '01224000000kOto'),\n        field('Referred__c', 1),\n        field('Follow_Up_By_Date__c', dataValue('$.form.Follow-Up_By_Date')),\n        field('Reason_for_Service__c', 'Referral'),\n        field(\n          'Clinic_Zinc__c',\n          dataValue(\n            '$.form.TT5.Child_Information.Clinical_Services.diarrhea_clinic_treatment_zinc'\n          )\n        ),\n        field(\n          'Clinic_ORS__c',\n          dataValue(\n            '$.form.TT5.Child_Information.Clinical_Services.diarrhea_clinic_treatment_ORS'\n          )\n        ),\n        field(\n          'Home_Zinc__c',\n          dataValue(\n            '$.form.TT5.Child_Information.Referrals.diarrhea_home_treatment_zinc'\n          )\n        ),\n        field(\n          'Home_ORS__c',\n          dataValue(\n            '$.form.TT5.Child_Information.Referrals.diarrhea_home_treatment_ORS'\n          )\n        ),\n        field('Open_Case__c', 1),\n        field('Malaria_Status__c', dataValue('$.form.Malaria_Status')),\n        field(\n          'Home_Treatment__c',\n          dataValue('$.form.TT5.Child_Information.CCMM.Home_Treatment')\n        ),\n        field(\n          'Malaria_Home_Test_Date__c',\n          dataValue('$.form.TT5.Child_Information.CCMM.test_date')\n        ),\n        field('CommCare_Code__c', state => {\n          var id = dataValue('$.form.case.@case_id')(state);state.data.id;\n          var date = dataValue('$.form.Date')(state);\n          return id + date + 'Referral';\n        }),\n        //field(\n        //  'CommCare_Code__c',\n        //  dataValue('$.form.subcase_0.case.@case_id')(state)\n        //),\n        field('Purpose_of_Referral__c', state => {\n          var purpose = '';\n          var name = dataValue('$.form.Purpose_of_Referral')(state);\n          if (name == 'Adverse_Drug_Reaction_Side_Effect') {\n            purpose = 'Adverse Drug Reaction/Side Effect';\n          } else if (name == 'Pregnancy_Care') {\n            purpose = 'Pregnancy Care (ANC)';\n          } else if (name == 'Family_Planning') {\n            purpose = 'Family Planning (FP)';\n          } else {\n            purpose = name.replace(/_/g, ' ');\n          }\n          return purpose;\n        }),\n\n        relationship(\n          'Person__r',\n          'CommCare_ID__c',\n          dataValue('$.form.case.@case_id')\n        )\n      )\n    )(state);\n  }\n  return state;\n});\n\n//TO-DO fix array problem\n//HAWI other clinical services received,\nalterState(state => {\n  if (dataValue('$.form.HAWI.Clinical_Services_Rendered[0]')(state)) {\n    return beta.each(\n      dataPath('$.form.HAWI.Clinical_Services_Rendered[*]'),\n      upsert(\n        'Service__c',\n        'Service_UID__c',\n        fields(\n          field('Service_UID__c', state => {\n            var id = dataValue('$.form.case.@case_id')(state);\n            var date = dataValue('$.form.Date')(state);\n            return id + date + 'HAWI-Other-Services';\n          }),\n          field('Source__c', 1),\n          field('Household_CHW__c', dataValue('chw')),\n          field('Reason_for_Service__c', state => {\n            var reason = '';\n            var name = dataValue('Purpose')(state);\n            if (name == 'Adverse_Drug_Reaction_Side_Effect') {\n              reason = 'Adverse Drug Reaction/Side Effect';\n            } else if (name == 'Pregnancy_Care') {\n              reason = 'Pregnancy Care (ANC)';\n            } else if (name == 'Family_Planning') {\n              reason = 'Family Planning (FP)';\n            } else {\n              reason = name.replace(/_/g, ' ');\n            }\n            return reason;\n          }),\n          field('Date__c', dataValue('Date_of_Clinical_Service')),\n          field('Type_of_Service__c', 'CHW Mobile Survey'),\n          field('RecordTypeID', '01224000000YAuK'),\n          relationship('Site__r', 'Label__c', state => {\n            var facility = dataValue('Facility_of_Clinical_Service')(state);\n            if (facility === '' || facility === undefined) {\n              facility = 'unknown';\n            } else if (facility == 'Other_Clinic') {\n              facility = 'Other'; }\n            return facility;\n          }),\n          relationship('Person__r', 'CommCare_ID__c', dataValue('Case_ID'))\n        )\n      )\n    )(state);\n  }\n  return state;\n});\n\n//TO-DO: fix array problem\n// TT5 other clinical services received\nalterState(state => {\n  if (dataValue('$.form.TT5.Child_Information.Clinical_Services[0]')(state)) {\n    return beta.each(\n      dataPath('$.form.TT5.Child_Information.Clinical_Services[*]'),\n      upsert(\n        'Service__c',\n        'Service_UID__c',\n        fields(\n          field('Source__c', true),\n          field('Service_UID__c', state => {\n            var id = dataValue('$.form.case.@case_id')(state);\n            var date = dataValue('$.form.Date')(state);\n            return id + date + 'TT5-Other-Services';\n          }),\n          field('Household_CHW__c', dataValue('chw')),\n          field('Reason_for_Service__c', state => {\n            var reason = '';\n            var name = dataValue('Purpose')(state);\n            if (name == 'Adverse_Drug_Reaction_Side_Effect') {\n              reason = 'Adverse Drug Reaction/Side Effect';\n            } else if (name == 'Pregnancy_Care') {\n              reason = 'Pregnancy Care (ANC)';\n            } else if (name == 'Family_Planning') {\n              reason = 'Family Planning (FP)';\n            } else {\n              reason = name.replace(/_/g, ' ');\n            }\n            return reason;\n          }),\n          field('Date__c', dataValue('Clinical_Date')),\n          field('Type_of_Service__c', 'CHW Mobile Survey'),\n          field('RecordTypeID', '01224000000YAuK'),\n          relationship('Site__r', 'Label__c', state => {\n            var facility = dataValue('Clinical_Facility')(state);\n            if (facility === '' || facility === undefined) {\n              facility = 'unknown';\n            }\n            return facility;\n          }),\n          relationship('Person__r', 'CommCare_ID__c', dataValue('Case_ID'))\n        )\n      )\n    )(state);\n  }\n  return state;\n});\n\nupsert(\n  'Visit__c',\n  'CommCare_Visit_ID__c',\n  fields(\n    field('CommCare_Visit_ID__c', dataValue('id')),\n    relationship('Household__r', 'CommCare_Code__c', dataValue('$.form.HH_ID')),\n    field('Visit_UID__c', state=>{\n      var hh = dataValue('form.HH_ID')(state); \n      var date = dataValue('metadata.timeEnd')(state);\n      return hh+date; \n    }),\n    field('Name', 'CHW Visit'),\n    field('CommCare_Visit_ID__c', dataValue('id')),\n    field('Household_CHW__c', dataValue('$.form.CHW_ID_Final')),\n    field(\n      'Supervisor_Visit__c',\n      state => state.supervisorMap[state.data.form.supervisor_visit]\n    ),\n    field('Date__c', dataValue('$.metadata.timeEnd'))\n  )\n);\n\n")))}s.isMDXComponent=!0},336:function(e,n,a){"use strict";a.d(n,"a",(function(){return c})),a.d(n,"b",(function(){return m}));var t=a(0),i=a.n(t);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function _(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?_(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,t,i=function(e,n){if(null==e)return{};var a,t,i={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(i[a]=e[a]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var d=i.a.createContext({}),s=function(e){var n=i.a.useContext(d),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},c=function(e){var n=s(e.components);return i.a.createElement(d.Provider,{value:n},e.children)},f={inlineCode:"code",wrapper:function(e){var n=e.children;return i.a.createElement(i.a.Fragment,{},n)}},u=i.a.forwardRef((function(e,n){var a=e.components,t=e.mdxType,r=e.originalType,_=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(a),u=t,m=c["".concat(_,".").concat(u)]||c[u]||f[u]||r;return a?i.a.createElement(m,o(o({ref:n},d),{},{components:a})):i.a.createElement(m,o({ref:n},d))}));function m(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var r=a.length,_=new Array(r);_[0]=u;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:t,_[1]=o;for(var d=2;d<r;d++)_[d]=a[d];return i.a.createElement.apply(null,_)}return i.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);