



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="README, Getting Started, Documentation, and Release Notes for OpenFn">
      
      
        <link rel="canonical" href="https://openfn.github.io/docs/appendix.html">
      
      
        <meta name="author" content="OpenFn">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Snippets & Sample Code - OpenFn Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#03a9f4">
      
    
    
      <script src="assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-57118569-4", "openfn.org")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="light-blue" data-md-color-accent="deep-purple">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#snippets-sample-code" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://openfn.github.io/docs" title="OpenFn Documentation" class="md-header-nav__button md-logo">
          
            <img src="images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              OpenFn Documentation
            </span>
            <span class="md-header-nav__topic">
              Snippets & Sample Code
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/openfn/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://openfn.github.io/docs" title="OpenFn Documentation" class="md-nav__button md-logo">
      
        <img src="images/logo.svg" width="48" height="48">
      
    </a>
    OpenFn Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/openfn/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="quick-start.html" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="faqs.html" title="FAQs" class="md-nav__link">
      FAQs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="about.html" title="About us" class="md-nav__link">
      About us
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      The OpenFn.org Platform
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        The OpenFn.org Platform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="documentation.html" title="Basic Documentation" class="md-nav__link">
      Basic Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="trouble-shooting.html" title="Troubleshooting Data Errors" class="md-nav__link">
      Troubleshooting Data Errors
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Snippets & Sample Code
      </label>
    
    <a href="appendix.html" title="Snippets & Sample Code" class="md-nav__link md-nav__link--active">
      Snippets & Sample Code
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#filters" title="Filters" class="md-nav__link">
    Filters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#match-messages-where-the-formid-is-robot_photo_21042015" title="Match messages WHERE the formId is "Robot_Photo_21.04.2015":" class="md-nav__link">
    Match messages WHERE the formId is "Robot_Photo_21.04.2015":
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-where-this-and-that-are-both-included" title="Match a message WHERE this AND that are both included:" class="md-nav__link">
    Match a message WHERE this AND that are both included:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-with-two-fragments-inside-an-array-called-data" title="Match a message with two fragments inside an array called data:" class="md-nav__link">
    Match a message with two fragments inside an array called data:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-with-a-fragment-inside-another-object-called-form" title="Match a message with a fragment inside another object called form:" class="md-nav__link">
    Match a message with a fragment inside another object called form:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-expressions" title="Job Expressions" class="md-nav__link">
    Job Expressions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-expression-for-commcare-to-sf" title="Job expression (for CommCare to SF)" class="md-nav__link">
    Job expression (for CommCare to SF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-the-data-array-in-open-data-kit-submissions" title="Accessing the "data array" in Open Data Kit submissions" class="md-nav__link">
    Accessing the "data array" in Open Data Kit submissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odk-to-salesforce-create-parent-record-with-many-children-from-parent-data" title="ODK to Salesforce: create parent record with many children from parent data" class="md-nav__link">
    ODK to Salesforce: create parent record with many children from parent data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-many-child-records-without-a-repeat-group-in-odk" title="Create many child records WITHOUT a repeat group in ODK" class="md-nav__link">
    Create many child records WITHOUT a repeat group in ODK
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-perform-an-update" title="Salesforce: perform an update" class="md-nav__link">
    Salesforce: perform an update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-set-record-type-using-relationship" title="Salesforce: Set record type using 'relationship(...)'" class="md-nav__link">
    Salesforce: Set record type using 'relationship(...)'
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-set-record-type-using-record-type-id" title="Salesforce: Set record type using record Type ID" class="md-nav__link">
    Salesforce: Set record type using record Type ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telerivet-send-sms-based-on-salesforce-workflow-alert" title="Telerivet: Send SMS based on Salesforce workflow alert" class="md-nav__link">
    Telerivet: Send SMS based on Salesforce workflow alert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-fetch-but-dont-fail" title="HTTP: fetch but don't fail!" class="md-nav__link">
    HTTP: fetch but don't fail!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-dhis2-events-api-job" title="Sample DHIS2 events API job:" class="md-nav__link">
    Sample DHIS2 events API job:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-dhis2-data-value-sets-api-job" title="Sample DHIS2 data value sets API job:" class="md-nav__link">
    Sample DHIS2 data value sets API job:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-openmrs-expression-creates-a-person-and-then-a-patient" title="sample openMRS expression, creates a person and then a patient" class="md-nav__link">
    sample openMRS expression, creates a person and then a patient
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge-many-values-into-a-child-path" title="merge many values into a child path" class="md-nav__link">
    merge many values into a child path
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arraytostring" title="arrayToString" class="md-nav__link">
    arrayToString
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-an-image-url-from-an-odk-submission" title="access an image URL from an ODK submission" class="md-nav__link">
    access an image URL from an ODK submission
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alterstate-alter-state-to-make-sure-data-is-in-an-array" title="alterState (alter state) to make sure data is in an array" class="md-nav__link">
    alterState (alter state) to make sure data is in an array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anonymous-functions" title="Anonymous Functions" class="md-nav__link">
    Anonymous Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-replacer" title="Custom replacer" class="md-nav__link">
    Custom replacer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-arraytostring" title="Custom arrayToString" class="md-nav__link">
    Custom arrayToString
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-concatenation" title="Custom concatenation" class="md-nav__link">
    Custom concatenation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concatenation-of-null-values" title="Concatenation of null values" class="md-nav__link">
    Concatenation of null values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-nth-reference-id" title="Custom Nth reference ID" class="md-nav__link">
    Custom Nth reference ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-date-string-to-standard-iso-date-for-salesforce" title="Convert date string to standard ISO date for Salesforce" class="md-nav__link">
    Convert date string to standard ISO date for Salesforce
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-external-id-fields-for-relationships-during-a-bulk-load-in-salesforce" title="Use external ID fields for relationships during a bulk load in Salesforce" class="md-nav__link">
    Use external ID fields for relationships during a bulk load in Salesforce
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bulk-upsert-with-an-external-id-in-salesforce" title="Bulk upsert with an external ID in salesforce" class="md-nav__link">
    Bulk upsert with an external ID in salesforce
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="release-notes.html" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="diy.html" title="DIY" class="md-nav__link">
      DIY
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Writing Jobs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Writing Jobs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="core.html" title="Job Execution" class="md-nav__link">
      Job Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="job-library.html" title="The Job Library" class="md-nav__link">
      The Job Library
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Connecting Data Sources
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Connecting Data Sources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="source-apps.html" title="Source Apps" class="md-nav__link">
      Source Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="for-devs.html" title="Application Developers" class="md-nav__link">
      Application Developers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#filters" title="Filters" class="md-nav__link">
    Filters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#match-messages-where-the-formid-is-robot_photo_21042015" title="Match messages WHERE the formId is "Robot_Photo_21.04.2015":" class="md-nav__link">
    Match messages WHERE the formId is "Robot_Photo_21.04.2015":
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-where-this-and-that-are-both-included" title="Match a message WHERE this AND that are both included:" class="md-nav__link">
    Match a message WHERE this AND that are both included:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-with-two-fragments-inside-an-array-called-data" title="Match a message with two fragments inside an array called data:" class="md-nav__link">
    Match a message with two fragments inside an array called data:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-with-a-fragment-inside-another-object-called-form" title="Match a message with a fragment inside another object called form:" class="md-nav__link">
    Match a message with a fragment inside another object called form:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-expressions" title="Job Expressions" class="md-nav__link">
    Job Expressions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-expression-for-commcare-to-sf" title="Job expression (for CommCare to SF)" class="md-nav__link">
    Job expression (for CommCare to SF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-the-data-array-in-open-data-kit-submissions" title="Accessing the "data array" in Open Data Kit submissions" class="md-nav__link">
    Accessing the "data array" in Open Data Kit submissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odk-to-salesforce-create-parent-record-with-many-children-from-parent-data" title="ODK to Salesforce: create parent record with many children from parent data" class="md-nav__link">
    ODK to Salesforce: create parent record with many children from parent data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-many-child-records-without-a-repeat-group-in-odk" title="Create many child records WITHOUT a repeat group in ODK" class="md-nav__link">
    Create many child records WITHOUT a repeat group in ODK
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-perform-an-update" title="Salesforce: perform an update" class="md-nav__link">
    Salesforce: perform an update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-set-record-type-using-relationship" title="Salesforce: Set record type using 'relationship(...)'" class="md-nav__link">
    Salesforce: Set record type using 'relationship(...)'
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-set-record-type-using-record-type-id" title="Salesforce: Set record type using record Type ID" class="md-nav__link">
    Salesforce: Set record type using record Type ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telerivet-send-sms-based-on-salesforce-workflow-alert" title="Telerivet: Send SMS based on Salesforce workflow alert" class="md-nav__link">
    Telerivet: Send SMS based on Salesforce workflow alert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-fetch-but-dont-fail" title="HTTP: fetch but don't fail!" class="md-nav__link">
    HTTP: fetch but don't fail!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-dhis2-events-api-job" title="Sample DHIS2 events API job:" class="md-nav__link">
    Sample DHIS2 events API job:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-dhis2-data-value-sets-api-job" title="Sample DHIS2 data value sets API job:" class="md-nav__link">
    Sample DHIS2 data value sets API job:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-openmrs-expression-creates-a-person-and-then-a-patient" title="sample openMRS expression, creates a person and then a patient" class="md-nav__link">
    sample openMRS expression, creates a person and then a patient
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge-many-values-into-a-child-path" title="merge many values into a child path" class="md-nav__link">
    merge many values into a child path
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arraytostring" title="arrayToString" class="md-nav__link">
    arrayToString
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-an-image-url-from-an-odk-submission" title="access an image URL from an ODK submission" class="md-nav__link">
    access an image URL from an ODK submission
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alterstate-alter-state-to-make-sure-data-is-in-an-array" title="alterState (alter state) to make sure data is in an array" class="md-nav__link">
    alterState (alter state) to make sure data is in an array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anonymous-functions" title="Anonymous Functions" class="md-nav__link">
    Anonymous Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-replacer" title="Custom replacer" class="md-nav__link">
    Custom replacer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-arraytostring" title="Custom arrayToString" class="md-nav__link">
    Custom arrayToString
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-concatenation" title="Custom concatenation" class="md-nav__link">
    Custom concatenation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concatenation-of-null-values" title="Concatenation of null values" class="md-nav__link">
    Concatenation of null values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-nth-reference-id" title="Custom Nth reference ID" class="md-nav__link">
    Custom Nth reference ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-date-string-to-standard-iso-date-for-salesforce" title="Convert date string to standard ISO date for Salesforce" class="md-nav__link">
    Convert date string to standard ISO date for Salesforce
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-external-id-fields-for-relationships-during-a-bulk-load-in-salesforce" title="Use external ID fields for relationships during a bulk load in Salesforce" class="md-nav__link">
    Use external ID fields for relationships during a bulk load in Salesforce
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bulk-upsert-with-an-external-id-in-salesforce" title="Bulk upsert with an external ID in salesforce" class="md-nav__link">
    Bulk upsert with an external ID in salesforce
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/openfn/docs/edit/master/docs/appendix.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="snippets-sample-code">Snippets &amp; Sample Code<a class="headerlink" href="#snippets-sample-code" title="Permanent link">#</a></h1>
<h2 id="filters">Filters<a class="headerlink" href="#filters" title="Permanent link">#</a></h2>
<h3 id="match-messages-where-the-formid-is-robot_photo_21042015">Match messages <code>WHERE</code> the <code>formId</code> is <code>"Robot_Photo_21.04.2015"</code>:<a class="headerlink" href="#match-messages-where-the-formid-is-robot_photo_21042015" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span> <span class="nt">&quot;formId&quot;</span><span class="p">:</span> <span class="s2">&quot;Robot_Photo_21.04.2015&quot;</span> <span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="match-a-message-where-this-and-that-are-both-included">Match a message <code>WHERE</code> this <code>AND</code> that are both included:<a class="headerlink" href="#match-a-message-where-this-and-that-are-both-included" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span> <span class="nt">&quot;formId&quot;</span><span class="p">:</span> <span class="s2">&quot;Robot_Photo_21.04.2015&quot;</span><span class="p">,</span> <span class="nt">&quot;secret_number&quot;</span><span class="p">:</span> <span class="mi">8</span> <span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="match-a-message-with-two-fragments-inside-an-array-called-data">Match a message with two fragments inside an array called <code>data</code>:<a class="headerlink" href="#match-a-message-with-two-fragments-inside-an-array-called-data" title="Permanent link">#</a></h3>
<p>(This is useful when gathering data via ODK)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span> <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span> <span class="nt">&quot;outlet_call&quot;</span><span class="p">:</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">,</span> <span class="nt">&quot;new_existing&quot;</span><span class="p">:</span> <span class="s2">&quot;Existing&quot;</span> <span class="p">}]</span> <span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="match-a-message-with-a-fragment-inside-another-object-called-form">Match a message with a fragment inside another object called <code>form</code>:<a class="headerlink" href="#match-a-message-with-a-fragment-inside-another-object-called-form" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;form&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;@xmlns&quot;</span><span class="p">:</span> <span class="s2">&quot;http://openrosa.org/formdesigner/F732194-3278-nota-ReAL-one&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="job-expressions">Job Expressions<a class="headerlink" href="#job-expressions" title="Permanent link">#</a></h2>
<p>Below you can find some examples of block code for different functions and data handling contexts.</p>
<h3 id="job-expression-for-commcare-to-sf">Job expression (for CommCare to SF)<a class="headerlink" href="#job-expression-for-commcare-to-sf" title="Permanent link">#</a></h3>
<p>The following job expression will take a matching receipt and use data from that receipt to upsert a <code>Patient__c</code> record in Salesforce and create multiple new <code>Patient_Visit__c</code> (child to Patient) records.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">upsert</span><span class="p">(</span>
  <span class="s1">&#39;Patient__c&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Patient_Id__c&#39;</span><span class="p">,</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Patient_Id__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.patient_ID&#39;</span><span class="p">)),</span>
    <span class="nx">relationship</span><span class="p">(</span><span class="s1">&#39;Nurse__r&#39;</span><span class="p">,</span> <span class="s1">&#39;Nurse_ID_code__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.staff_id&#39;</span><span class="p">)),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Phone_Number__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.mobile_phone&#39;</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">),</span>
  <span class="nx">each</span><span class="p">(</span>
    <span class="nx">join</span><span class="p">(</span><span class="s1">&#39;$.data.form.visits[*]&#39;</span><span class="p">,</span> <span class="s1">&#39;$.references[0].id&#39;</span><span class="p">,</span> <span class="s1">&#39;Id&#39;</span><span class="p">),</span>
    <span class="nx">create</span><span class="p">(</span>
      <span class="s1">&#39;Visit__c&#39;</span><span class="p">,</span>
      <span class="nx">fields</span><span class="p">(</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Patient__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">)),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Date__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Reason__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;why_did_they_see_doctor&#39;</span><span class="p">))</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="accessing-the-data-array-in-open-data-kit-submissions">Accessing the "data array" in Open Data Kit submissions<a class="headerlink" href="#accessing-the-data-array-in-open-data-kit-submissions" title="Permanent link">#</a></h3>
<p>Notice how we use "each" to get data from each item inside the "data array" in ODK.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">each</span><span class="p">(</span>
  <span class="s1">&#39;$.data.data[*]&#39;</span><span class="p">,</span>
  <span class="nx">create</span><span class="p">(</span>
    <span class="s1">&#39;ODK_Submission__c&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Site_School_ID_Number__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;school&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Date_Completed__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;comments__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;ODK_Key__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;*meta-instance-id*&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="odk-to-salesforce-create-parent-record-with-many-children-from-parent-data">ODK to Salesforce: create parent record with many children from parent data<a class="headerlink" href="#odk-to-salesforce-create-parent-record-with-many-children-from-parent-data" title="Permanent link">#</a></h3>
<p>Here, the user brings <code>time_end</code> and <code>parentId</code> onto the line items from the parent object.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">each</span><span class="p">(</span>
  <span class="nx">dataPath</span><span class="p">(</span><span class="s1">&#39;data[*]&#39;</span><span class="p">),</span>
  <span class="nx">combine</span><span class="p">(</span>
    <span class="nx">create</span><span class="p">(</span>
      <span class="s1">&#39;transaction__c&#39;</span><span class="p">,</span>
      <span class="nx">fields</span><span class="p">(</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Transaction_Date__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;today&#39;</span><span class="p">)),</span>
        <span class="nx">relationship</span><span class="p">(</span>
          <span class="s1">&#39;Person_Responsible__r&#39;</span><span class="p">,</span>
          <span class="s1">&#39;Staff_ID_Code__c&#39;</span><span class="p">,</span>
          <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;person_code&#39;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;metainstanceid__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;*meta-instance-id*&#39;</span><span class="p">))</span>
      <span class="p">)</span>
    <span class="p">),</span>
    <span class="nx">each</span><span class="p">(</span>
      <span class="nx">merge</span><span class="p">(</span>
        <span class="nx">dataPath</span><span class="p">(</span><span class="s1">&#39;line_items[*]&#39;</span><span class="p">),</span>
        <span class="nx">fields</span><span class="p">(</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;time_end&#39;</span><span class="p">)),</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;parentId&#39;</span><span class="p">,</span> <span class="nx">lastReferenceValue</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>
        <span class="p">)</span>
      <span class="p">),</span>
      <span class="nx">create</span><span class="p">(</span>
        <span class="s1">&#39;line_item__c&#39;</span><span class="p">,</span>
        <span class="nx">fields</span><span class="p">(</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;transaction__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;parentId&#39;</span><span class="p">)),</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Barcode__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;product_barcode&#39;</span><span class="p">)),</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;ODK_Form_Completed__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">))</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>

<blockquote>
<p><strong>NB - there was a known bug with the <code>combine</code> function which has been resolved. <code>combine</code> can be used to combine two operations into one and is commonly used to run multiple <code>create</code>'s inside an <code>each(path, operation)</code>. The source code for combine can be found here: <a href="https://github.com/OpenFn/language-common/blob/master/src/index.js#L204-L222">language-common: combine</a></strong></p>
</blockquote>
<h3 id="create-many-child-records-without-a-repeat-group-in-odk">Create many child records WITHOUT a repeat group in ODK<a class="headerlink" href="#create-many-child-records-without-a-repeat-group-in-odk" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">beta</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span>
  <span class="s1">&#39;$.data.data[*]&#39;</span><span class="p">,</span>
  <span class="nx">upsert</span><span class="p">(</span>
    <span class="s1">&#39;Outlet__c&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Outlet_Code__c&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Outlet_Code__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;outlet_code&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Location__Latitude__s&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;gps:Latitude&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Location__Longitude__s&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;gps:Longitude&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">),</span>
  <span class="nx">beta</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span>
    <span class="s1">&#39;$.data.data[*]&#39;</span><span class="p">,</span>
    <span class="nx">upsert</span><span class="p">(</span>
      <span class="s1">&#39;Outlet_Call__c&#39;</span><span class="p">,</span>
      <span class="s1">&#39;Invoice_Number__c&#39;</span><span class="p">,</span>
      <span class="nx">fields</span><span class="p">(</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Invoice_Number__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;invoice_number&#39;</span><span class="p">)),</span>
        <span class="nx">relationship</span><span class="p">(</span><span class="s1">&#39;Outlet__r&#39;</span><span class="p">,</span> <span class="s1">&#39;Outlet_Code__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;outlet_code&#39;</span><span class="p">)),</span>
        <span class="nx">relationship</span><span class="p">(</span><span class="s1">&#39;RecordType&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;No Call Card&#39;</span><span class="p">),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Trip__c&#39;</span><span class="p">,</span> <span class="s1">&#39;a0FN0000008jPue&#39;</span><span class="p">),</span>
        <span class="nx">relationship</span><span class="p">(</span>
          <span class="s1">&#39;Sales_Person__r&#39;</span><span class="p">,</span>
          <span class="s1">&#39;Sales_Rep_Code__c&#39;</span><span class="p">,</span>
          <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;sales_rep_code&#39;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Date__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Comments__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">))</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="salesforce-perform-an-update">Salesforce: perform an update<a class="headerlink" href="#salesforce-perform-an-update" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">update</span><span class="p">(</span><span class="s2">&quot;Patient__c&quot;</span><span class="p">,</span> <span class="nx">fields</span><span class="p">(</span>
  <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;pathToSalesforceId&quot;</span><span class="p">)),</span>
  <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;Name__c&quot;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;patient.first_name&quot;</span><span class="p">)),</span>
  <span class="nx">field</span><span class="p">(...)</span>
<span class="p">));</span>
</pre></div>
</td></tr></table>

<h3 id="salesforce-set-record-type-using-relationship">Salesforce: Set record type using 'relationship(...)'<a class="headerlink" href="#salesforce-set-record-type-using-relationship" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">create</span><span class="p">(</span>
  <span class="s1">&#39;custom_obj__c&#39;</span><span class="p">,</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">relationship</span><span class="p">(</span>
      <span class="s1">&#39;RecordType&#39;</span><span class="p">,</span>
      <span class="s1">&#39;name&#39;</span><span class="p">,</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;submission_type&#39;</span><span class="p">),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="salesforce-set-record-type-using-record-type-id">Salesforce: Set record type using record Type ID<a class="headerlink" href="#salesforce-set-record-type-using-record-type-id" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">each</span><span class="p">(</span>
  <span class="s1">&#39;$.data.data[*]&#39;</span><span class="p">,</span>
  <span class="nx">create</span><span class="p">(</span>
    <span class="s1">&#39;fancy_object__c&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;RecordTypeId&#39;</span><span class="p">,</span> <span class="s1">&#39;012110000008s19&#39;</span><span class="p">),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;site_size&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="telerivet-send-sms-based-on-salesforce-workflow-alert">Telerivet: Send SMS based on Salesforce workflow alert<a class="headerlink" href="#telerivet-send-sms-based-on-salesforce-workflow-alert" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">send</span><span class="p">(</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span>
      <span class="s1">&#39;to_number&#39;</span><span class="p">,</span>
      <span class="nx">dataValue</span><span class="p">(</span>
        <span class="s1">&#39;Envelope.Body.notifications.Notification.sObject.phone_number__c&#39;</span>
      <span class="p">)</span>
    <span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;message_type&#39;</span><span class="p">,</span> <span class="s1">&#39;sms&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;route_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;Hey there. Your name is &#39;</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span>
        <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;Envelope.Body.notifications.Notification.sObject.name__c&#39;</span><span class="p">)(</span>
          <span class="nx">state</span>
        <span class="p">),</span>
        <span class="s1">&#39;.&#39;</span>
      <span class="p">);</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="http-fetch-but-dont-fail">HTTP: fetch but don't fail!<a class="headerlink" href="#http-fetch-but-dont-fail" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// =============</span>
<span class="c1">// We use &quot;fetchWithErrors(...)&quot; so that when the</span>
<span class="c1">// SMS gateway returns an error the run does not &quot;fail&quot;.</span>
<span class="c1">// It &quot;succeeds&quot; and then delivers that error message</span>
<span class="c1">// back to Salesforce with the &quot;Update SMS Status&quot; job.</span>
<span class="c1">// =============</span>
<span class="nx">fetchWithErrors</span><span class="p">({</span>
  <span class="nx">getEndpoint</span><span class="o">:</span> <span class="s1">&#39;send_to_contact&#39;</span><span class="p">,</span>
  <span class="nx">query</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">msisdn</span><span class="o">:</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Envelope</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Notification</span><span class="p">.</span><span class="nx">sObject</span>
          <span class="p">.</span><span class="nx">SMS__Phone_Number__c</span><span class="p">,</span>
      <span class="nx">message</span><span class="o">:</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Envelope</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Notification</span><span class="p">.</span><span class="nx">sObject</span>
          <span class="p">.</span><span class="nx">SMS__Message__c</span><span class="p">,</span>
      <span class="nx">api_key</span><span class="o">:</span> <span class="s1">&#39;some-secret-key&#39;</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="nx">externalId</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Envelope</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Notification</span><span class="p">.</span><span class="nx">sObject</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span>
  <span class="nx">postUrl</span><span class="o">:</span> <span class="s1">&#39;https://www.openfn.org/inbox/another-secret-key&#39;</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<h3 id="sample-dhis2-events-api-job">Sample DHIS2 events API job:<a class="headerlink" href="#sample-dhis2-events-api-job" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">event</span><span class="p">(</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;program&#39;</span><span class="p">,</span> <span class="s1">&#39;eBAyeGv0exc&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;orgUnit&#39;</span><span class="p">,</span> <span class="s1">&#39;DiszpKrYNg8&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;eventDate&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;properties.date&#39;</span><span class="p">)),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;storedBy&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;coordinate&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">latitude</span><span class="o">:</span> <span class="s1">&#39;59.8&#39;</span><span class="p">,</span>
      <span class="nx">longitude</span><span class="o">:</span> <span class="s1">&#39;10.9&#39;</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;dataValues&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;qrur9Dvnyt5&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;properties.prop_a&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;oZg33kd9taw&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;properties.prop_b&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;msodh3rEMJa&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;properties.prop_c&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
        <span class="p">},</span>
      <span class="p">];</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="sample-dhis2-data-value-sets-api-job">Sample DHIS2 data value sets API job:<a class="headerlink" href="#sample-dhis2-data-value-sets-api-job" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">dataValueSet</span><span class="p">(</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;dataSet&#39;</span><span class="p">,</span> <span class="s1">&#39;pBOMPrpg1QX&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;orgUnit&#39;</span><span class="p">,</span> <span class="s1">&#39;DiszpKrYNg8&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;201401&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;completeData&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;dataValues&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;f7n9E0hX8qk&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;prop_a&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;Ix2HsbDMLea&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;prop_b&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;eY5ehpbEsB7&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;prop_c&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="p">},</span>
      <span class="p">];</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="sample-openmrs-expression-creates-a-person-and-then-a-patient">sample openMRS expression, creates a person and then a patient<a class="headerlink" href="#sample-openmrs-expression-creates-a-person-and-then-a-patient" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">person</span><span class="p">(</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nx">givenName</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.first_name&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
          <span class="nx">familyName</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.last_name&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
        <span class="p">},</span>
      <span class="p">];</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">),</span>
  <span class="nx">patient</span><span class="p">(</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="nx">lastReferenceValue</span><span class="p">(</span><span class="s1">&#39;uuid&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;identifiers&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nx">identifier</span><span class="o">:</span> <span class="s1">&#39;1234&#39;</span><span class="p">,</span>
            <span class="nx">identifierType</span><span class="o">:</span> <span class="s1">&#39;8d79403a-c2cc-11de-8d13-0010c6dffd0f&#39;</span><span class="p">,</span>
            <span class="nx">location</span><span class="o">:</span> <span class="s1">&#39;8d6c993e-c2cc-11de-8d13-0010c6dffd0f&#39;</span><span class="p">,</span>
            <span class="nx">preferred</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="p">},</span>
        <span class="p">];</span>
      <span class="p">})</span>
    <span class="p">)</span>
  <span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="merge-many-values-into-a-child-path">merge many values into a child path<a class="headerlink" href="#merge-many-values-into-a-child-path" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">each</span><span class="p">(</span>
  <span class="nx">merge</span><span class="p">(</span>
    <span class="nx">dataPath</span><span class="p">(</span><span class="s2">&quot;CHILD_ARRAY[*]&quot;</span><span class="p">),</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;metaId&quot;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;*meta-instance-id*&quot;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;parentId&quot;</span><span class="p">,</span> <span class="nx">lastReferenceValue</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="nx">create</span><span class="p">(...)</span>
<span class="p">)</span>
</pre></div>
</td></tr></table>

<h3 id="arraytostring">arrayToString<a class="headerlink" href="#arraytostring" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">arrayToString</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">separator_string</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="access-an-image-url-from-an-odk-submission">access an image URL from an ODK submission<a class="headerlink" href="#access-an-image-url-from-an-odk-submission" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// In ODK the image URL is inside an image object...</span>
<span class="nx">field</span><span class="p">(</span><span class="s2">&quot;Photo_URL_text__c&quot;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;image.url&quot;</span><span class="p">)),</span>
</pre></div>
</td></tr></table>

<h3 id="alterstate-alter-state-to-make-sure-data-is-in-an-array">alterState (alter state) to make sure data is in an array<a class="headerlink" href="#alterstate-alter-state-to-make-sure-data-is-in-an-array" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Here, we make sure CommCare gives us an array to use in each(merge(...), ...)</span>
<span class="nx">alterState</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">idCards</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">ID_cards_given_to_vendor</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">idCards</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">ID_cards_given_to_vendor</span> <span class="o">=</span> <span class="p">[</span><span class="nx">idCards</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Now state has been changed, and we carry on...</span>
<span class="nx">each</span><span class="p">(</span>
  <span class="nx">merge</span><span class="p">(</span>
    <span class="nx">dataPath</span><span class="p">(</span><span class="s1">&#39;form.ID_cards_given_to_vendor[*]&#39;</span><span class="p">),</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Vendor_Id&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.ID_vendor&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;form_finished_time&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.meta.timeEnd&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="nx">upsert</span><span class="p">(</span>
    <span class="s1">&#39;Small_Packet__c&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sp_id__c&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;sp_id__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;ID_cards_given_to_vendor&#39;</span><span class="p">)),</span>
      <span class="nx">relationship</span><span class="p">(</span><span class="s1">&#39;Vendor__r&#39;</span><span class="p">,</span> <span class="s1">&#39;Badge_Code__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;Vendor_Id&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span>
        <span class="s1">&#39;Small_Packet_Distribution_Date__c&#39;</span><span class="p">,</span>
        <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form_finished_time&#39;</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>

<h2 id="anonymous-functions">Anonymous Functions<a class="headerlink" href="#anonymous-functions" title="Permanent link">#</a></h2>
<p>Different to <a href="documentation.html#named-functions">Named Functions</a>, Anoynmous functions are generic pieces of javascript which you can write to suit your needs. Here are some examples of these custom functions:</p>
<h3 id="custom-replacer">Custom replacer<a class="headerlink" href="#custom-replacer" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">field</span><span class="p">(</span><span class="s1">&#39;destination__c&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;path_to_data&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;cats&#39;</span><span class="p">,</span> <span class="s1">&#39;dogs&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>This will replace all "cats" with "dogs" in the string that lives at <code>path_to_data</code>.</p>
<blockquote>
<p><strong>NOTE:</strong> The JavaScript <code>replace()</code> function only replaces the first instance of whatever argument you specify.
If you're looking for a way to replace all instances, we suggest you use a regex like we did in the <a href="#custom-concatenation-of-null-values">example</a> below.</p>
</blockquote>
<h3 id="custom-arraytostring">Custom arrayToString<a class="headerlink" href="#custom-arraytostring" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">field</span><span class="p">(</span><span class="s2">&quot;target_specie_list__c&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span>
    <span class="kc">null</span><span class="p">,</span> <span class="nx">sourceValue</span><span class="p">(</span><span class="s2">&quot;$.data.target_specie_list&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span>
  <span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
<span class="p">}),</span>
</pre></div>
</td></tr></table>

<p>It will take an array, and concatenate each item into a string with a ", " separator.</p>
<h3 id="custom-concatenation">Custom concatenation<a class="headerlink" href="#custom-concatenation" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">field</span><span class="p">(</span><span class="s1">&#39;ODK_Key__c&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;metaId&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span> <span class="s1">&#39;)&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>This will concatenate two values.</p>
<h3 id="concatenation-of-null-values">Concatenation of null values<a class="headerlink" href="#concatenation-of-null-values" title="Permanent link">#</a></h3>
<p>This will concatenate many values, even if one or more are null, writing them to a field called Main_Office_City_c.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">...</span>
  <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;Main_Office_City__c&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">arrayToString</span><span class="p">([</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_a&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_a&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_b&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_b&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_c&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_c&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_d&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_d&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
    <span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">),</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
  <span class="p">})</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Notice how this custom function makes use of the <strong>regex</strong> <code>/-/g</code> to ensure that all instances are accounted for (g = global search).</p>
</blockquote>
<h3 id="custom-nth-reference-id">Custom Nth reference ID<a class="headerlink" href="#custom-nth-reference-id" title="Permanent link">#</a></h3>
<p>If you ever want to retrieve the FIRST object you created, or the SECOND, or the Nth, for that matter, a function like this will do the trick.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">field</span><span class="p">(</span><span class="s1">&#39;parent__c&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">references</span><span class="p">[</span><span class="nx">state</span><span class="p">.</span><span class="nx">references</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>See how instead of taking the id of the "last" thing that was created in Salesforce, you're taking the id of the 1st thing, or 2nd thing if you replace "length-1" with "length-2".</p>
<h3 id="convert-date-string-to-standard-iso-date-for-salesforce">Convert date string to standard ISO date for Salesforce<a class="headerlink" href="#convert-date-string-to-standard-iso-date-for-salesforce" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Payment_Date__c&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;payment_date&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)).</span><span class="nx">toISOString</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<blockquote>
<p><strong>NOTE</strong>: The output of this function will always be formatted according to GMT time-zone.</p>
</blockquote>
<h3 id="use-external-id-fields-for-relationships-during-a-bulk-load-in-salesforce">Use external ID fields for relationships during a bulk load in Salesforce<a class="headerlink" href="#use-external-id-fields-for-relationships-during-a-bulk-load-in-salesforce" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">array</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">Patient_Name__c</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">fullName</span><span class="p">,</span>
    <span class="s1">&#39;Clinic__r.Unique_Clinic_Identifier__c&#39;</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">clinicId</span><span class="p">,</span>
    <span class="s1">&#39;RecordType.Name&#39;</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<h3 id="bulk-upsert-with-an-external-id-in-salesforce">Bulk upsert with an external ID in salesforce<a class="headerlink" href="#bulk-upsert-with-an-external-id-in-salesforce" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">bulk</span><span class="p">(</span>
  <span class="s1">&#39;Visit_new__c&#39;</span><span class="p">,</span>
  <span class="s1">&#39;upsert&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">extIdField</span><span class="o">:</span> <span class="s1">&#39;commcare_case_id__c&#39;</span><span class="p">,</span>
    <span class="nx">failOnError</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">allowNoOp</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;patients&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="trouble-shooting.html" title="Troubleshooting Data Errors" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Troubleshooting Data Errors
              </span>
            </div>
          </a>
        
        
          <a href="release-notes.html" title="Release Notes" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Release Notes
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright (c) 2019 Open Function Group LLC
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="assets/fonts/font-awesome.css">
    
      <a href="https://github.com/openfn" class="md-footer-social__link fa fa-"></a>
    
      <a href="https://facebook.com/openfn" class="md-footer-social__link fa fa-"></a>
    
      <a href="https://twitter.com/openfn" class="md-footer-social__link fa fa-"></a>
    
      <a href="https://linkedin.com/in/openfn" class="md-footer-social__link fa fa-"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
        <script src="freshChat.js"></script>
      
    
  </body>
</html>