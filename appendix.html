
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="README, Getting Started, Documentation, and Release Notes for OpenFn">
      
      
        <link rel="canonical" href="https://openfn.github.io/docs/appendix.html">
      
      
        <meta name="author" content="OpenFn">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.0">
    
    
      
        <title>Snippets & Sample Code - OpenFn Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.bc7e593a.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab28b872.min.css">
        
          
          
          <meta name="theme-color" content="#02a6f2">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-57118569-4","openfn.org"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="deep-purple">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#snippets-sample-code" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://openfn.github.io/docs" title="OpenFn Documentation" class="md-header-nav__button md-logo" aria-label="OpenFn Documentation">
      
  <img src="images/logo.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            OpenFn Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Snippets & Sample Code
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/openfn/docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://openfn.github.io/docs" title="OpenFn Documentation" class="md-nav__button md-logo" aria-label="OpenFn Documentation">
      
  <img src="images/logo.svg" alt="logo">

    </a>
    OpenFn Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/openfn/docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="quick-start.html" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://community.openfn.org" class="md-nav__link">
      Community Forum
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="faqs.html" class="md-nav__link">
      FAQs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="about.html" class="md-nav__link">
      About us
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      The OpenFn.org Platform
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="The OpenFn.org Platform" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        The OpenFn.org Platform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="documentation.html" class="md-nav__link">
      Basic Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="trouble-shooting.html" class="md-nav__link">
      Troubleshooting Data Errors
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Snippets & Sample Code
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="appendix.html" class="md-nav__link md-nav__link--active">
      Snippets & Sample Code
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    Filters
  </a>
  
    <nav class="md-nav" aria-label="Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#match-messages-where-the-formid-is-robot_photo_21042015" class="md-nav__link">
    Match messages WHERE the formId is "Robot_Photo_21.04.2015":
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-where-this-and-that-are-both-included" class="md-nav__link">
    Match a message WHERE this AND that are both included:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-with-two-fragments-inside-an-array-called-data" class="md-nav__link">
    Match a message with two fragments inside an array called data:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-with-a-fragment-inside-another-object-called-form" class="md-nav__link">
    Match a message with a fragment inside another object called form:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-expressions" class="md-nav__link">
    Job Expressions
  </a>
  
    <nav class="md-nav" aria-label="Job Expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-expression-for-commcare-to-sf" class="md-nav__link">
    Job expression (for CommCare to SF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-the-data-array-in-open-data-kit-submissions" class="md-nav__link">
    Accessing the "data array" in Open Data Kit submissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odk-to-salesforce-create-parent-record-with-many-children-from-parent-data" class="md-nav__link">
    ODK to Salesforce: create parent record with many children from parent data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-many-child-records-without-a-repeat-group-in-odk" class="md-nav__link">
    Create many child records WITHOUT a repeat group in ODK
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-perform-an-update" class="md-nav__link">
    Salesforce: perform an update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-set-record-type-using-relationship" class="md-nav__link">
    Salesforce: Set record type using 'relationship(...)'
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-set-record-type-using-record-type-id" class="md-nav__link">
    Salesforce: Set record type using record Type ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telerivet-send-sms-based-on-salesforce-workflow-alert" class="md-nav__link">
    Telerivet: Send SMS based on Salesforce workflow alert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-fetch-but-dont-fail" class="md-nav__link">
    HTTP: fetch but don't fail!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-dhis2-events-api-job" class="md-nav__link">
    Sample DHIS2 events API job:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-dhis2-data-value-sets-api-job" class="md-nav__link">
    Sample DHIS2 data value sets API job:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-openmrs-expression-creates-a-person-and-then-a-patient" class="md-nav__link">
    sample openMRS expression, creates a person and then a patient
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge-many-values-into-a-child-path" class="md-nav__link">
    merge many values into a child path
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arraytostring" class="md-nav__link">
    arrayToString
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-an-image-url-from-an-odk-submission" class="md-nav__link">
    access an image URL from an ODK submission
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alterstate-alter-state-to-make-sure-data-is-in-an-array" class="md-nav__link">
    alterState (alter state) to make sure data is in an array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anonymous-functions" class="md-nav__link">
    Anonymous Functions
  </a>
  
    <nav class="md-nav" aria-label="Anonymous Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-replacer" class="md-nav__link">
    Custom replacer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-arraytostring" class="md-nav__link">
    Custom arrayToString
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-concatenation" class="md-nav__link">
    Custom concatenation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concatenation-of-null-values" class="md-nav__link">
    Concatenation of null values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-nth-reference-id" class="md-nav__link">
    Custom Nth reference ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-date-string-to-standard-iso-date-for-salesforce" class="md-nav__link">
    Convert date string to standard ISO date for Salesforce
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-external-id-fields-for-relationships-during-a-bulk-load-in-salesforce" class="md-nav__link">
    Use external ID fields for relationships during a bulk load in Salesforce
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bulk-upsert-with-an-external-id-in-salesforce" class="md-nav__link">
    Bulk upsert with an external ID in salesforce
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="release-notes.html" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="diy.html" class="md-nav__link">
      DIY
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Writing Jobs
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Writing Jobs" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Writing Jobs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="core.html" class="md-nav__link">
      Job Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="job-library.html" class="md-nav__link">
      The Job Library
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Connecting Data Sources
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Connecting Data Sources" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Connecting Data Sources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="source-apps.html" class="md-nav__link">
      Source Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="for-devs.html" class="md-nav__link">
      Application Developers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    Filters
  </a>
  
    <nav class="md-nav" aria-label="Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#match-messages-where-the-formid-is-robot_photo_21042015" class="md-nav__link">
    Match messages WHERE the formId is "Robot_Photo_21.04.2015":
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-where-this-and-that-are-both-included" class="md-nav__link">
    Match a message WHERE this AND that are both included:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-with-two-fragments-inside-an-array-called-data" class="md-nav__link">
    Match a message with two fragments inside an array called data:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-a-message-with-a-fragment-inside-another-object-called-form" class="md-nav__link">
    Match a message with a fragment inside another object called form:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-expressions" class="md-nav__link">
    Job Expressions
  </a>
  
    <nav class="md-nav" aria-label="Job Expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-expression-for-commcare-to-sf" class="md-nav__link">
    Job expression (for CommCare to SF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-the-data-array-in-open-data-kit-submissions" class="md-nav__link">
    Accessing the "data array" in Open Data Kit submissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odk-to-salesforce-create-parent-record-with-many-children-from-parent-data" class="md-nav__link">
    ODK to Salesforce: create parent record with many children from parent data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-many-child-records-without-a-repeat-group-in-odk" class="md-nav__link">
    Create many child records WITHOUT a repeat group in ODK
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-perform-an-update" class="md-nav__link">
    Salesforce: perform an update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-set-record-type-using-relationship" class="md-nav__link">
    Salesforce: Set record type using 'relationship(...)'
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salesforce-set-record-type-using-record-type-id" class="md-nav__link">
    Salesforce: Set record type using record Type ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telerivet-send-sms-based-on-salesforce-workflow-alert" class="md-nav__link">
    Telerivet: Send SMS based on Salesforce workflow alert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-fetch-but-dont-fail" class="md-nav__link">
    HTTP: fetch but don't fail!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-dhis2-events-api-job" class="md-nav__link">
    Sample DHIS2 events API job:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-dhis2-data-value-sets-api-job" class="md-nav__link">
    Sample DHIS2 data value sets API job:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-openmrs-expression-creates-a-person-and-then-a-patient" class="md-nav__link">
    sample openMRS expression, creates a person and then a patient
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge-many-values-into-a-child-path" class="md-nav__link">
    merge many values into a child path
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arraytostring" class="md-nav__link">
    arrayToString
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-an-image-url-from-an-odk-submission" class="md-nav__link">
    access an image URL from an ODK submission
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alterstate-alter-state-to-make-sure-data-is-in-an-array" class="md-nav__link">
    alterState (alter state) to make sure data is in an array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anonymous-functions" class="md-nav__link">
    Anonymous Functions
  </a>
  
    <nav class="md-nav" aria-label="Anonymous Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-replacer" class="md-nav__link">
    Custom replacer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-arraytostring" class="md-nav__link">
    Custom arrayToString
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-concatenation" class="md-nav__link">
    Custom concatenation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concatenation-of-null-values" class="md-nav__link">
    Concatenation of null values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-nth-reference-id" class="md-nav__link">
    Custom Nth reference ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-date-string-to-standard-iso-date-for-salesforce" class="md-nav__link">
    Convert date string to standard ISO date for Salesforce
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-external-id-fields-for-relationships-during-a-bulk-load-in-salesforce" class="md-nav__link">
    Use external ID fields for relationships during a bulk load in Salesforce
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bulk-upsert-with-an-external-id-in-salesforce" class="md-nav__link">
    Bulk upsert with an external ID in salesforce
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/openfn/docs/edit/master/docs/appendix.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="snippets-sample-code">Snippets &amp; Sample Code<a class="headerlink" href="#snippets-sample-code" title="Permanent link">#</a></h1>
<h2 id="filters">Filters<a class="headerlink" href="#filters" title="Permanent link">#</a></h2>
<h3 id="match-messages-where-the-formid-is-robot_photo_21042015">Match messages <code>WHERE</code> the <code>formId</code> is <code>"Robot_Photo_21.04.2015"</code>:<a class="headerlink" href="#match-messages-where-the-formid-is-robot_photo_21042015" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="p">{</span> <span class="nt">&quot;formId&quot;</span><span class="p">:</span> <span class="s2">&quot;Robot_Photo_21.04.2015&quot;</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<h3 id="match-a-message-where-this-and-that-are-both-included">Match a message <code>WHERE</code> this <code>AND</code> that are both included:<a class="headerlink" href="#match-a-message-where-this-and-that-are-both-included" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="p">{</span> <span class="nt">&quot;formId&quot;</span><span class="p">:</span> <span class="s2">&quot;Robot_Photo_21.04.2015&quot;</span><span class="p">,</span> <span class="nt">&quot;secret_number&quot;</span><span class="p">:</span> <span class="mi">8</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<h3 id="match-a-message-with-two-fragments-inside-an-array-called-data">Match a message with two fragments inside an array called <code>data</code>:<a class="headerlink" href="#match-a-message-with-two-fragments-inside-an-array-called-data" title="Permanent link">#</a></h3>
<p>(This is useful when gathering data via ODK)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="p">{</span> <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span> <span class="nt">&quot;outlet_call&quot;</span><span class="p">:</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">,</span> <span class="nt">&quot;new_existing&quot;</span><span class="p">:</span> <span class="s2">&quot;Existing&quot;</span> <span class="p">}]</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<h3 id="match-a-message-with-a-fragment-inside-another-object-called-form">Match a message with a fragment inside another object called <code>form</code>:<a class="headerlink" href="#match-a-message-with-a-fragment-inside-another-object-called-form" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;form&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;@xmlns&quot;</span><span class="p">:</span> <span class="s2">&quot;http://openrosa.org/formdesigner/F732194-3278-nota-ReAL-one&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<h2 id="job-expressions">Job Expressions<a class="headerlink" href="#job-expressions" title="Permanent link">#</a></h2>
<p>Below you can find some examples of block code for different functions and data handling contexts.</p>
<h3 id="job-expression-for-commcare-to-sf">Job expression (for CommCare to SF)<a class="headerlink" href="#job-expression-for-commcare-to-sf" title="Permanent link">#</a></h3>
<p>The following job expression will take a matching receipt and use data from that receipt to upsert a <code>Patient__c</code> record in Salesforce and create multiple new <code>Patient_Visit__c</code> (child to Patient) records.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">upsert</span><span class="p">(</span>
  <span class="s1">&#39;Patient__c&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Patient_Id__c&#39;</span><span class="p">,</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Patient_Id__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.patient_ID&#39;</span><span class="p">)),</span>
    <span class="nx">relationship</span><span class="p">(</span><span class="s1">&#39;Nurse__r&#39;</span><span class="p">,</span> <span class="s1">&#39;Nurse_ID_code__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.staff_id&#39;</span><span class="p">)),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Phone_Number__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.mobile_phone&#39;</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">),</span>
  <span class="nx">each</span><span class="p">(</span>
    <span class="nx">join</span><span class="p">(</span><span class="s1">&#39;$.data.form.visits[*]&#39;</span><span class="p">,</span> <span class="s1">&#39;$.references[0].id&#39;</span><span class="p">,</span> <span class="s1">&#39;Id&#39;</span><span class="p">),</span>
    <span class="nx">create</span><span class="p">(</span>
      <span class="s1">&#39;Visit__c&#39;</span><span class="p">,</span>
      <span class="nx">fields</span><span class="p">(</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Patient__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">)),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Date__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Reason__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;why_did_they_see_doctor&#39;</span><span class="p">))</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="accessing-the-data-array-in-open-data-kit-submissions">Accessing the "data array" in Open Data Kit submissions<a class="headerlink" href="#accessing-the-data-array-in-open-data-kit-submissions" title="Permanent link">#</a></h3>
<p>Notice how we use "each" to get data from each item inside the "data array" in ODK.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">each</span><span class="p">(</span>
  <span class="s1">&#39;$.data.data[*]&#39;</span><span class="p">,</span>
  <span class="nx">create</span><span class="p">(</span>
    <span class="s1">&#39;ODK_Submission__c&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Site_School_ID_Number__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;school&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Date_Completed__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;comments__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;ODK_Key__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;*meta-instance-id*&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="odk-to-salesforce-create-parent-record-with-many-children-from-parent-data">ODK to Salesforce: create parent record with many children from parent data<a class="headerlink" href="#odk-to-salesforce-create-parent-record-with-many-children-from-parent-data" title="Permanent link">#</a></h3>
<p>Here, the user brings <code>time_end</code> and <code>parentId</code> onto the line items from the parent object.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">each</span><span class="p">(</span>
  <span class="nx">dataPath</span><span class="p">(</span><span class="s1">&#39;data[*]&#39;</span><span class="p">),</span>
  <span class="nx">combine</span><span class="p">(</span>
    <span class="nx">create</span><span class="p">(</span>
      <span class="s1">&#39;transaction__c&#39;</span><span class="p">,</span>
      <span class="nx">fields</span><span class="p">(</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Transaction_Date__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;today&#39;</span><span class="p">)),</span>
        <span class="nx">relationship</span><span class="p">(</span>
          <span class="s1">&#39;Person_Responsible__r&#39;</span><span class="p">,</span>
          <span class="s1">&#39;Staff_ID_Code__c&#39;</span><span class="p">,</span>
          <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;person_code&#39;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;metainstanceid__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;*meta-instance-id*&#39;</span><span class="p">))</span>
      <span class="p">)</span>
    <span class="p">),</span>
    <span class="nx">each</span><span class="p">(</span>
      <span class="nx">merge</span><span class="p">(</span>
        <span class="nx">dataPath</span><span class="p">(</span><span class="s1">&#39;line_items[*]&#39;</span><span class="p">),</span>
        <span class="nx">fields</span><span class="p">(</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;time_end&#39;</span><span class="p">)),</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;parentId&#39;</span><span class="p">,</span> <span class="nx">lastReferenceValue</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>
        <span class="p">)</span>
      <span class="p">),</span>
      <span class="nx">create</span><span class="p">(</span>
        <span class="s1">&#39;line_item__c&#39;</span><span class="p">,</span>
        <span class="nx">fields</span><span class="p">(</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;transaction__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;parentId&#39;</span><span class="p">)),</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Barcode__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;product_barcode&#39;</span><span class="p">)),</span>
          <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;ODK_Form_Completed__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">))</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p><strong>NB - there was a known bug with the <code>combine</code> function which has been resolved. <code>combine</code> can be used to combine two operations into one and is commonly used to run multiple <code>create</code>'s inside an <code>each(path, operation)</code>. The source code for combine can be found here: <a href="https://github.com/OpenFn/language-common/blob/master/src/index.js#L204-L222">language-common: combine</a></strong></p>
</blockquote>
<h3 id="create-many-child-records-without-a-repeat-group-in-odk">Create many child records WITHOUT a repeat group in ODK<a class="headerlink" href="#create-many-child-records-without-a-repeat-group-in-odk" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">beta</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span>
  <span class="s1">&#39;$.data.data[*]&#39;</span><span class="p">,</span>
  <span class="nx">upsert</span><span class="p">(</span>
    <span class="s1">&#39;Outlet__c&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Outlet_Code__c&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Outlet_Code__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;outlet_code&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Location__Latitude__s&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;gps:Latitude&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Location__Longitude__s&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;gps:Longitude&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">),</span>
  <span class="nx">beta</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span>
    <span class="s1">&#39;$.data.data[*]&#39;</span><span class="p">,</span>
    <span class="nx">upsert</span><span class="p">(</span>
      <span class="s1">&#39;Outlet_Call__c&#39;</span><span class="p">,</span>
      <span class="s1">&#39;Invoice_Number__c&#39;</span><span class="p">,</span>
      <span class="nx">fields</span><span class="p">(</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Invoice_Number__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;invoice_number&#39;</span><span class="p">)),</span>
        <span class="nx">relationship</span><span class="p">(</span><span class="s1">&#39;Outlet__r&#39;</span><span class="p">,</span> <span class="s1">&#39;Outlet_Code__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;outlet_code&#39;</span><span class="p">)),</span>
        <span class="nx">relationship</span><span class="p">(</span><span class="s1">&#39;RecordType&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;No Call Card&#39;</span><span class="p">),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Trip__c&#39;</span><span class="p">,</span> <span class="s1">&#39;a0FN0000008jPue&#39;</span><span class="p">),</span>
        <span class="nx">relationship</span><span class="p">(</span>
          <span class="s1">&#39;Sales_Person__r&#39;</span><span class="p">,</span>
          <span class="s1">&#39;Sales_Rep_Code__c&#39;</span><span class="p">,</span>
          <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;sales_rep_code&#39;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Date__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)),</span>
        <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Comments__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">))</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="salesforce-perform-an-update">Salesforce: perform an update<a class="headerlink" href="#salesforce-perform-an-update" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">update</span><span class="p">(</span><span class="s2">&quot;Patient__c&quot;</span><span class="p">,</span> <span class="nx">fields</span><span class="p">(</span>
  <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;pathToSalesforceId&quot;</span><span class="p">)),</span>
  <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;Name__c&quot;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;patient.first_name&quot;</span><span class="p">)),</span>
  <span class="nx">field</span><span class="p">(...)</span>
<span class="p">));</span>
</code></pre></div>
</td></tr></table>
<h3 id="salesforce-set-record-type-using-relationship">Salesforce: Set record type using 'relationship(...)'<a class="headerlink" href="#salesforce-set-record-type-using-relationship" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">create</span><span class="p">(</span>
  <span class="s1">&#39;custom_obj__c&#39;</span><span class="p">,</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">relationship</span><span class="p">(</span>
      <span class="s1">&#39;RecordType&#39;</span><span class="p">,</span>
      <span class="s1">&#39;name&#39;</span><span class="p">,</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;submission_type&#39;</span><span class="p">),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="salesforce-set-record-type-using-record-type-id">Salesforce: Set record type using record Type ID<a class="headerlink" href="#salesforce-set-record-type-using-record-type-id" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">each</span><span class="p">(</span>
  <span class="s1">&#39;$.data.data[*]&#39;</span><span class="p">,</span>
  <span class="nx">create</span><span class="p">(</span>
    <span class="s1">&#39;fancy_object__c&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;RecordTypeId&#39;</span><span class="p">,</span> <span class="s1">&#39;012110000008s19&#39;</span><span class="p">),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;site_size&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="telerivet-send-sms-based-on-salesforce-workflow-alert">Telerivet: Send SMS based on Salesforce workflow alert<a class="headerlink" href="#telerivet-send-sms-based-on-salesforce-workflow-alert" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">send</span><span class="p">(</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span>
      <span class="s1">&#39;to_number&#39;</span><span class="p">,</span>
      <span class="nx">dataValue</span><span class="p">(</span>
        <span class="s1">&#39;Envelope.Body.notifications.Notification.sObject.phone_number__c&#39;</span>
      <span class="p">)</span>
    <span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;message_type&#39;</span><span class="p">,</span> <span class="s1">&#39;sms&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;route_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;Hey there. Your name is &#39;</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span>
        <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;Envelope.Body.notifications.Notification.sObject.name__c&#39;</span><span class="p">)(</span>
          <span class="nx">state</span>
        <span class="p">),</span>
        <span class="s1">&#39;.&#39;</span>
      <span class="p">);</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="http-fetch-but-dont-fail">HTTP: fetch but don't fail!<a class="headerlink" href="#http-fetch-but-dont-fail" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// =============</span>
<span class="c1">// We use &quot;fetchWithErrors(...)&quot; so that when the</span>
<span class="c1">// SMS gateway returns an error the run does not &quot;fail&quot;.</span>
<span class="c1">// It &quot;succeeds&quot; and then delivers that error message</span>
<span class="c1">// back to Salesforce with the &quot;Update SMS Status&quot; job.</span>
<span class="c1">// =============</span>
<span class="nx">fetchWithErrors</span><span class="p">({</span>
  <span class="nx">getEndpoint</span><span class="o">:</span> <span class="s1">&#39;send_to_contact&#39;</span><span class="p">,</span>
  <span class="nx">query</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">msisdn</span><span class="o">:</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Envelope</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Notification</span><span class="p">.</span><span class="nx">sObject</span>
          <span class="p">.</span><span class="nx">SMS__Phone_Number__c</span><span class="p">,</span>
      <span class="nx">message</span><span class="o">:</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Envelope</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Notification</span><span class="p">.</span><span class="nx">sObject</span>
          <span class="p">.</span><span class="nx">SMS__Message__c</span><span class="p">,</span>
      <span class="nx">api_key</span><span class="o">:</span> <span class="s1">&#39;some-secret-key&#39;</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="nx">externalId</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Envelope</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Notification</span><span class="p">.</span><span class="nx">sObject</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span>
  <span class="nx">postUrl</span><span class="o">:</span> <span class="s1">&#39;https://www.openfn.org/inbox/another-secret-key&#39;</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
<h3 id="sample-dhis2-events-api-job">Sample DHIS2 events API job:<a class="headerlink" href="#sample-dhis2-events-api-job" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">event</span><span class="p">(</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;program&#39;</span><span class="p">,</span> <span class="s1">&#39;eBAyeGv0exc&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;orgUnit&#39;</span><span class="p">,</span> <span class="s1">&#39;DiszpKrYNg8&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;eventDate&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;properties.date&#39;</span><span class="p">)),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPLETED&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;storedBy&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;coordinate&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">latitude</span><span class="o">:</span> <span class="s1">&#39;59.8&#39;</span><span class="p">,</span>
      <span class="nx">longitude</span><span class="o">:</span> <span class="s1">&#39;10.9&#39;</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;dataValues&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;qrur9Dvnyt5&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;properties.prop_a&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;oZg33kd9taw&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;properties.prop_b&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;msodh3rEMJa&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;properties.prop_c&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
        <span class="p">},</span>
      <span class="p">];</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="sample-dhis2-data-value-sets-api-job">Sample DHIS2 data value sets API job:<a class="headerlink" href="#sample-dhis2-data-value-sets-api-job" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">dataValueSet</span><span class="p">(</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;dataSet&#39;</span><span class="p">,</span> <span class="s1">&#39;pBOMPrpg1QX&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;orgUnit&#39;</span><span class="p">,</span> <span class="s1">&#39;DiszpKrYNg8&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;201401&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;completeData&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;dataValues&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;f7n9E0hX8qk&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;prop_a&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;Ix2HsbDMLea&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;prop_b&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">dataElement</span><span class="o">:</span> <span class="s1">&#39;eY5ehpbEsB7&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;prop_c&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="p">},</span>
      <span class="p">];</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="sample-openmrs-expression-creates-a-person-and-then-a-patient">sample openMRS expression, creates a person and then a patient<a class="headerlink" href="#sample-openmrs-expression-creates-a-person-and-then-a-patient" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">person</span><span class="p">(</span>
  <span class="nx">fields</span><span class="p">(</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">),</span>
    <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nx">givenName</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.first_name&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
          <span class="nx">familyName</span><span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.last_name&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span>
        <span class="p">},</span>
      <span class="p">];</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">),</span>
  <span class="nx">patient</span><span class="p">(</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="nx">lastReferenceValue</span><span class="p">(</span><span class="s1">&#39;uuid&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;identifiers&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nx">identifier</span><span class="o">:</span> <span class="s1">&#39;1234&#39;</span><span class="p">,</span>
            <span class="nx">identifierType</span><span class="o">:</span> <span class="s1">&#39;8d79403a-c2cc-11de-8d13-0010c6dffd0f&#39;</span><span class="p">,</span>
            <span class="nx">location</span><span class="o">:</span> <span class="s1">&#39;8d6c993e-c2cc-11de-8d13-0010c6dffd0f&#39;</span><span class="p">,</span>
            <span class="nx">preferred</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="p">},</span>
        <span class="p">];</span>
      <span class="p">})</span>
    <span class="p">)</span>
  <span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="merge-many-values-into-a-child-path">merge many values into a child path<a class="headerlink" href="#merge-many-values-into-a-child-path" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">each</span><span class="p">(</span>
  <span class="nx">merge</span><span class="p">(</span>
    <span class="nx">dataPath</span><span class="p">(</span><span class="s2">&quot;CHILD_ARRAY[*]&quot;</span><span class="p">),</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;metaId&quot;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;*meta-instance-id*&quot;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;parentId&quot;</span><span class="p">,</span> <span class="nx">lastReferenceValue</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="nx">create</span><span class="p">(...)</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<h3 id="arraytostring">arrayToString<a class="headerlink" href="#arraytostring" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">arrayToString</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">separator_string</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h3 id="access-an-image-url-from-an-odk-submission">access an image URL from an ODK submission<a class="headerlink" href="#access-an-image-url-from-an-odk-submission" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// In ODK the image URL is inside an image object...</span>
<span class="nx">field</span><span class="p">(</span><span class="s2">&quot;Photo_URL_text__c&quot;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;image.url&quot;</span><span class="p">)),</span>
</code></pre></div>
</td></tr></table>
<h3 id="alterstate-alter-state-to-make-sure-data-is-in-an-array">alterState (alter state) to make sure data is in an array<a class="headerlink" href="#alterstate-alter-state-to-make-sure-data-is-in-an-array" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// Here, we make sure CommCare gives us an array to use in each(merge(...), ...)</span>
<span class="nx">alterState</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">idCards</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">ID_cards_given_to_vendor</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">idCards</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">ID_cards_given_to_vendor</span> <span class="o">=</span> <span class="p">[</span><span class="nx">idCards</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Now state has been changed, and we carry on...</span>
<span class="nx">each</span><span class="p">(</span>
  <span class="nx">merge</span><span class="p">(</span>
    <span class="nx">dataPath</span><span class="p">(</span><span class="s1">&#39;form.ID_cards_given_to_vendor[*]&#39;</span><span class="p">),</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Vendor_Id&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.ID_vendor&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;form_finished_time&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form.meta.timeEnd&#39;</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="nx">upsert</span><span class="p">(</span>
    <span class="s1">&#39;Small_Packet__c&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sp_id__c&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="p">(</span>
      <span class="nx">field</span><span class="p">(</span><span class="s1">&#39;sp_id__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;ID_cards_given_to_vendor&#39;</span><span class="p">)),</span>
      <span class="nx">relationship</span><span class="p">(</span><span class="s1">&#39;Vendor__r&#39;</span><span class="p">,</span> <span class="s1">&#39;Badge_Code__c&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;Vendor_Id&#39;</span><span class="p">)),</span>
      <span class="nx">field</span><span class="p">(</span>
        <span class="s1">&#39;Small_Packet_Distribution_Date__c&#39;</span><span class="p">,</span>
        <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;form_finished_time&#39;</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</td></tr></table>
<h2 id="anonymous-functions">Anonymous Functions<a class="headerlink" href="#anonymous-functions" title="Permanent link">#</a></h2>
<p>Different to <a href="documentation.html#named-functions">Named Functions</a>, Anoynmous functions are generic pieces of javascript which you can write to suit your needs. Here are some examples of these custom functions:</p>
<h3 id="custom-replacer">Custom replacer<a class="headerlink" href="#custom-replacer" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">field</span><span class="p">(</span><span class="s1">&#39;destination__c&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;path_to_data&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;cats&#39;</span><span class="p">,</span> <span class="s1">&#39;dogs&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
<p>This will replace all "cats" with "dogs" in the string that lives at <code>path_to_data</code>.</p>
<blockquote>
<p><strong>NOTE:</strong> The JavaScript <code>replace()</code> function only replaces the first instance of whatever argument you specify.
If you're looking for a way to replace all instances, we suggest you use a regex like we did in the <a href="#custom-concatenation-of-null-values">example</a> below.</p>
</blockquote>
<h3 id="custom-arraytostring">Custom arrayToString<a class="headerlink" href="#custom-arraytostring" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">field</span><span class="p">(</span><span class="s2">&quot;target_specie_list__c&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span>
    <span class="kc">null</span><span class="p">,</span> <span class="nx">sourceValue</span><span class="p">(</span><span class="s2">&quot;$.data.target_specie_list&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span>
  <span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
<span class="p">}),</span>
</code></pre></div>
</td></tr></table>
<p>It will take an array, and concatenate each item into a string with a ", " separator.</p>
<h3 id="custom-concatenation">Custom concatenation<a class="headerlink" href="#custom-concatenation" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">field</span><span class="p">(</span><span class="s1">&#39;ODK_Key__c&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;metaId&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">),</span> <span class="s1">&#39;)&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
<p>This will concatenate two values.</p>
<h3 id="concatenation-of-null-values">Concatenation of null values<a class="headerlink" href="#concatenation-of-null-values" title="Permanent link">#</a></h3>
<p>This will concatenate many values, even if one or more are null, writing them to a field called Main_Office_City_c.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="p">...</span>
  <span class="nx">field</span><span class="p">(</span><span class="s2">&quot;Main_Office_City__c&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">arrayToString</span><span class="p">([</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_a&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_a&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_b&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_b&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_c&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_c&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
      <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_d&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">dataValue</span><span class="p">(</span><span class="s2">&quot;Main_Office_City_d&quot;</span><span class="p">)(</span><span class="nx">state</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
    <span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">),</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
  <span class="p">})</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p>Notice how this custom function makes use of the <strong>regex</strong> <code>/-/g</code> to ensure that all instances are accounted for (g = global search).</p>
</blockquote>
<h3 id="custom-nth-reference-id">Custom Nth reference ID<a class="headerlink" href="#custom-nth-reference-id" title="Permanent link">#</a></h3>
<p>If you ever want to retrieve the FIRST object you created, or the SECOND, or the Nth, for that matter, a function like this will do the trick.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">field</span><span class="p">(</span><span class="s1">&#39;parent__c&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">references</span><span class="p">[</span><span class="nx">state</span><span class="p">.</span><span class="nx">references</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mf">1</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
<p>See how instead of taking the id of the "last" thing that was created in Salesforce, you're taking the id of the 1st thing, or 2nd thing if you replace "length-1" with "length-2".</p>
<h3 id="convert-date-string-to-standard-iso-date-for-salesforce">Convert date string to standard ISO date for Salesforce<a class="headerlink" href="#convert-date-string-to-standard-iso-date-for-salesforce" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">field</span><span class="p">(</span><span class="s1">&#39;Payment_Date__c&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;payment_date&#39;</span><span class="p">)(</span><span class="nx">state</span><span class="p">)).</span><span class="nx">toISOString</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
<blockquote>
<p><strong>NOTE</strong>: The output of this function will always be formatted according to GMT time-zone.</p>
</blockquote>
<h3 id="use-external-id-fields-for-relationships-during-a-bulk-load-in-salesforce">Use external ID fields for relationships during a bulk load in Salesforce<a class="headerlink" href="#use-external-id-fields-for-relationships-during-a-bulk-load-in-salesforce" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">array</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">Patient_Name__c</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">fullName</span><span class="p">,</span>
    <span class="s1">&#39;Clinic__r.Unique_Clinic_Identifier__c&#39;</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">clinicId</span><span class="p">,</span>
    <span class="s1">&#39;RecordType.Name&#39;</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
<h3 id="bulk-upsert-with-an-external-id-in-salesforce">Bulk upsert with an external ID in salesforce<a class="headerlink" href="#bulk-upsert-with-an-external-id-in-salesforce" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nx">bulk</span><span class="p">(</span>
  <span class="s1">&#39;Visit_new__c&#39;</span><span class="p">,</span>
  <span class="s1">&#39;upsert&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">extIdField</span><span class="o">:</span> <span class="s1">&#39;commcare_case_id__c&#39;</span><span class="p">,</span>
    <span class="nx">failOnError</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">allowNoOp</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">dataValue</span><span class="p">(</span><span class="s1">&#39;patients&#39;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
</td></tr></table>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="trouble-shooting.html" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Troubleshooting Data Errors
              </div>
            </div>
          </a>
        
        
          <a href="release-notes.html" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Release Notes
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright (c) 2019 Open Function Group LLC
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/openfn" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://facebook.com/openfn" target="_blank" rel="noopener" title="facebook.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/openfn" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://linkedin.com/in/openfn" target="_blank" rel="noopener" title="linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.6a3d08fc.min.js"></script>
      <script src="assets/javascripts/bundle.71201edf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: ['tabs', 'instant'],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="freshChat.js"></script>
      
    
  </body>
</html>