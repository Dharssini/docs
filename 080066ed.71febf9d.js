(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{130:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),o=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createContext({}),p=function(e){var t=o.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=p(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,r=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=p(n),d=a,m=b["".concat(r,".").concat(d)]||b[d]||u[d]||i;return n?o.a.createElement(m,l(l({ref:t},s),{},{components:n})):o.a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var s=2;s<i;s++)r[s]=n[s];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},73:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n(3),o=n(7),i=(n(0),n(130)),r={title:"Connecting Source Applications to OpenFn"},l={unversionedId:"source-apps",id:"source-apps",isDocsHomePage:!1,title:"Connecting Source Applications to OpenFn",description:"Standard webhook configuration",source:"@site/docs/source-apps.md",slug:"/source-apps",permalink:"/docs/source-apps",editUrl:"https://github.com/openfn/docs/edit/master/docs/source-apps.md",version:"current",sidebar:"docs",previous:{title:"CommCare HQ",permalink:"/docs/commcare"},next:{title:"for-devs",permalink:"/docs/for-devs"}},c=[{value:"Standard webhook configuration",id:"standard-webhook-configuration",children:[]},{value:"Magpi",id:"magpi",children:[]},{value:"SurveyCTO",id:"surveycto",children:[]},{value:"Open Data Kit (ODK) Collect",id:"open-data-kit-odk-collect",children:[]},{value:"Open Data Kit (ODK) Aggregate",id:"open-data-kit-odk-aggregate",children:[]},{value:"Ona.io",id:"onaio",children:[]},{value:"Community Health Toolkit",id:"community-health-toolkit",children:[]},{value:"Google Forms/Google Sheets",id:"google-formsgoogle-sheets",children:[]}],s={toc:c};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"standard-webhook-configuration"},"Standard webhook configuration"),Object(i.b)("p",null,"This section describes how to enable push notifications from selected source\napplications or how to configure pull jobs to fetch data from those sources. If\nyou don't see yours in the alphabetical list below feel free to add it with a\npull request."),Object(i.b)("p",null,"Every OpenFn project has a unique ",Object(i.b)("strong",{parentName:"p"},"Inbox URL")," address that can be used as an\nendpoint for any JSON webhook. To set up a data source, configure that source to\nmake a POST over HTTPS to your Inbox URL. See\n",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.openfn.org/documentation.html#connecting-source-applications"}),"Connecting Source Applications"),"."),Object(i.b)("p",null,'To connect an application with standard JSON webhooks, copy your inbox URL from\nthe "Inbox" page or your "Project Settings" screen and use it as the destination\nURL on your source application. Unless you have specifically configured it on\nthe "Access & Security" page, no authentication is required.'),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},Object(i.b)("em",{parentName:"strong"},"N.B.: This is by no means an exhaustive list."))," It is merely a list of\ncommon sources that external contributors have added. Remember that anything\nwith a REST api or a JSON-based notification service can be used with OpenFn."),Object(i.b)("h2",{id:"magpi"},"Magpi"),Object(i.b)("p",null,"Magpi is not able to push data to external URLs. In order to fetch data from\nMagpi, you must run a scheduled job with a cron trigger using ",Object(i.b)("inlineCode",{parentName:"p"},"langugage-magpi"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"fetchSurveyData({\n  surveyId: 37479, // the survey id\n  afterDate: '2016-05-31', // the initial \"after\" date\n  // after the first run, OpenFn will only fetch new submissions\n  postUrl: 'https://www.openfn.org/inbox/secret-5c25-inbox-ba2c-url', // the inbox to post form data to.\n});\n")),Object(i.b)("p",null,"Every time this job runs it will only fetch new data, by default."),Object(i.b)("h2",{id:"surveycto"},"SurveyCTO"),Object(i.b)("p",null,"SurveyCTO is not able to push data to external URLs. In order to fetch data from\nSurveyCTO, you must run a job on a using ",Object(i.b)("inlineCode",{parentName:"p"},"language-surveycto"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"fetchSubmissions(\n  'form_id', // the form id\n  'Sep 1, 2016 3:56:02 PM', // the initial \"after\" date\n  // after the first run, OpenFn will only fetch new submissions\n  'https://www.openfn.org/inbox/something-secret' // the inbox to post form data to.\n);\n")),Object(i.b)("p",null,"Every time this job runs it will only fetch new data, by default."),Object(i.b)("h2",{id:"open-data-kit-odk-collect"},"Open Data Kit (ODK) Collect"),Object(i.b)("p",null,"To bypass ODK Aggregate and submit forms directly to OpenFn make the following\nchanges in your ODK Collect app."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Select ",Object(i.b)("inlineCode",{parentName:"li"},"General Settings"),"."),Object(i.b)("li",{parentName:"ol"},"Select ",Object(i.b)("inlineCode",{parentName:"li"},"Server Settings"),"."),Object(i.b)("li",{parentName:"ol"},"Under ",Object(i.b)("inlineCode",{parentName:"li"},"Type"),", select ",Object(i.b)("inlineCode",{parentName:"li"},"Other"),"."),Object(i.b)("li",{parentName:"ol"},"Under ",Object(i.b)("inlineCode",{parentName:"li"},"URL"),", enter `",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.openfn.org"}),"https://www.openfn.org")),Object(i.b)("li",{parentName:"ol"},"Under ",Object(i.b)("inlineCode",{parentName:"li"},"Submission path"),", enter ",Object(i.b)("inlineCode",{parentName:"li"},"/inbox/your-unique-inbox-url")," (you can copy\nthis from your OpenFn Inbox)."),Object(i.b)("li",{parentName:"ol"},"Optional: If you have enabled auth methods on your inbox, enter your\n",Object(i.b)("inlineCode",{parentName:"li"},"username")," and ",Object(i.b)("inlineCode",{parentName:"li"},"password")," on this same screen.")),Object(i.b)("p",null,"Note that you cannot load forms from OpenFn. Forms must be loaded directly via\n",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.opendatakit.org/collect-forms/#loading-forms-directly"}),"ODK's direct method"),",\nwhich allows you to send forms as files via email/Whatsapp. Users can then\nchoose to download the files and save them in the ",Object(i.b)("inlineCode",{parentName:"p"},"odk/ forms")," folder on their\nmobile."),Object(i.b)("p",null,"Note that if you want to reverse this setup and configure ODK Collect to\nre-connect to your Aggregate instance again:`"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Go back to ",Object(i.b)("inlineCode",{parentName:"li"},"General Settings"),"."),Object(i.b)("li",{parentName:"ol"},"Select ",Object(i.b)("inlineCode",{parentName:"li"},"Server Settings"),"."),Object(i.b)("li",{parentName:"ol"},"Under ",Object(i.b)("inlineCode",{parentName:"li"},"Type"),", select ",Object(i.b)("inlineCode",{parentName:"li"},"ODK Aggregate"),"."),Object(i.b)("li",{parentName:"ol"},"Under ",Object(i.b)("inlineCode",{parentName:"li"},"URL"),", enter ",Object(i.b)("inlineCode",{parentName:"li"},"Your Aggregate URL")),Object(i.b)("li",{parentName:"ol"},"Under ",Object(i.b)("inlineCode",{parentName:"li"},"Submission path"),", enter ",Object(i.b)("inlineCode",{parentName:"li"},"/submissions"),"."),Object(i.b)("li",{parentName:"ol"},"Enter your ODK Aggregate ",Object(i.b)("inlineCode",{parentName:"li"},"username")," and ",Object(i.b)("inlineCode",{parentName:"li"},"password")," on this same screen.")),Object(i.b)("h2",{id:"open-data-kit-odk-aggregate"},"Open Data Kit (ODK) Aggregate"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},'To new submissions from ODK in real-time, click the "Form Management" tab at\nthe top of your Aggregate interface.'),Object(i.b)("li",{parentName:"ol"},'Click "Publish" next to the form you\'d like to publish to OpenFn.'),Object(i.b)("li",{parentName:"ol"},"A dialogue box will open."),Object(i.b)("li",{parentName:"ol"},'In the "Publish To:" picklist, select ',Object(i.b)("inlineCode",{parentName:"li"},"Z-ALPHA JSON Server"),"."),Object(i.b)("li",{parentName:"ol"},'Choose which data to publish in the "Data to Publish:" picklist. You may:\n',Object(i.b)("strong",{parentName:"li"},'"Upload Existing Data ONLY"')," (ideal for migrations of finished data sets),\n",Object(i.b)("strong",{parentName:"li"},'"Stream New Submission Data ONLY"')," (ideal for new projects), or ",Object(i.b)("strong",{parentName:"li"},'"BOTH\nUpload Existing & Stream New Submission Data"')," (ideal for connecting ongoing\nprojects which are already running)."),Object(i.b)("li",{parentName:"ol"},'In the "URL to publish to:" text box, enter your OpenFn Inbox UUID. (e.g.,\n',Object(i.b)("inlineCode",{parentName:"li"},"https://www.openfn.org/inbox/8ad63a29-mUCh-sEcRET-cODes-wOW"),")"),Object(i.b)("li",{parentName:"ol"},'Leave "Authorization token:" blank.'),Object(i.b)("li",{parentName:"ol"},'Leave "Include Media as:" set to "Links(URLs) to Media".'),Object(i.b)("li",{parentName:"ol"},'Click "Publish" and enter your email address in the dialogue box.'),Object(i.b)("li",{parentName:"ol"},'Click the "Published Data" tab under "Form Management" and select your form\nto view the status of your publisher. You can also now check your OpenFn\ninbox to see ODK submissions arrive.')),Object(i.b)("h2",{id:"onaio"},"Ona.io"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"To push data from Ona.io, click on the drop-down menu next to a specific form\nand select ",Object(i.b)("inlineCode",{parentName:"li"},"Settings"),"."),Object(i.b)("li",{parentName:"ol"},"On the left-side menu, select ",Object(i.b)("inlineCode",{parentName:"li"},"Webhooks"),"."),Object(i.b)("li",{parentName:"ol"},"Paste your OpenFn inbox URL into the URL input field."),Object(i.b)("li",{parentName:"ol"},'Click "Add webhook".'),Object(i.b)("li",{parentName:"ol"},"Ensure that the webhook is now listed with the ",Object(i.b)("inlineCode",{parentName:"li"},"JSON")," tag, indicating that it\nwill forward data as JSON."),Object(i.b)("li",{parentName:"ol"},"Check to see that, once a form is submitted, it is forwarded to your OpenFn\ninbox.")),Object(i.b)("h2",{id:"community-health-toolkit"},"Community Health Toolkit"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"To push data from CHT applications to OpenFn, leverage the\n",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.communityhealthtoolkit.org/apps/reference/app-settings/outbound/"}),"Outbound Push"),"\nfeature to forward specified data to your OpenFn project."),Object(i.b)("li",{parentName:"ol"},"When definining the\n",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.communityhealthtoolkit.org/apps/reference/app-settings/outbound/#destination"}),Object(i.b)("inlineCode",{parentName:"a"},"destination")),",\nspecify your OpenFn inbox URL as the ",Object(i.b)("inlineCode",{parentName:"li"},"baseURL"),". No ",Object(i.b)("inlineCode",{parentName:"li"},"auth")," parameters are\nrequired, unless you have configured Inbox Security on your OpenFn project."),Object(i.b)("li",{parentName:"ol"},"Define the data to forward to OpenFn in the\n",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.communityhealthtoolkit.org/apps/reference/app-settings/outbound/#mapping"}),Object(i.b)("inlineCode",{parentName:"a"},"mapping")),'\nproperty. This will structure the payload that is sent to your OpenFn Inbox\nas a "Message".')),Object(i.b)("p",null,"To send data ",Object(i.b)("em",{parentName:"p"},"to")," CHT applications, check out the\n",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.communityhealthtoolkit.org/apps/reference/api/"}),"CHT API"),"."),Object(i.b)("h2",{id:"google-formsgoogle-sheets"},"Google Forms/Google Sheets"),Object(i.b)("p",null,"You can send data to OpenFn whenever a new row is added to a Google Sheet, for\nexample when a new submission is made to a Google Form. Below is some sample\ncode you may add to your Google Sheet to make it push data to OpenFn whenever\nnew rows are added."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"function sendToOpenFn(e) {\n  var payload = JSON.stringify(e);\n  var url = 'https://www.openfn.org/inbox/your-id-here';\n  var options = {\n    method: 'post',\n    contentType: 'application/json',\n    payload: payload,\n  };\n  var response = UrlFetchApp.fetch(url, options);\n}\n\nfunction isDate(v) {\n  if (Object.prototype.toString.call(v) === '[object Date]') {\n    if (isNaN(v.getTime())) {\n      return false;\n    } else {\n      return true;\n    }\n  } else {\n    return false;\n  }\n}\n\nfunction isNumber(v) {\n  if (Object.prototype.toString.call(v) === '[object Number]') {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction getReportData() {\n  var bookReportData = { formId: 'bookReport', data: [] };\n  var data = SpreadsheetApp.getActiveSheet().getDataRange().getValues();\n\n  var pageCount = 0;\n  var bookRating = 0;\n\n  for (i in data) {\n    if (isDate(data[i][0])) {\n      //  ignore header line\n      if (isNumber(data[i][3])) {\n        pageCount = data[i][3];\n      }\n\n      if (isNumber(data[i][6])) {\n        bookRating = data[i][6];\n      }\n\n      bookReportData.data.push({\n        Timestamp: data[i][0],\n        Title: data[i][1],\n        Author: data[i][2],\n        NumberOfPages: pageCount,\n        Summary: data[i][4],\n        Protagonist: data[i][5],\n        Rating: bookRating,\n        EmailTeacher: data[i][7],\n        EmailStudent: data[i][8],\n        SendStatus: data[i][9],\n      });\n    }\n  }\n\n  //  Logger.log(bookReportData);\n\n  sendToOpenFn(bookReportData);\n}\n")))}p.isMDXComponent=!0}}]);